{
  "meta": {
    "version": "1.0",
    "generatedAt": "2026-02-06T10:10:00Z",
    "source": "manual-regression",
    "description": "Regression scenarios for geo mismatch in multi-turn sourcing"
  },
  "scenarios": [
    {
      "id": "R001",
      "title": "Молоко в Бресте: запрет на дрейф в Минск",
      "personaGoal": "Закупщик ищет поставщиков молока в Бресте, проверяет устойчивость к geo-correction",
      "tags": ["regression", "geo", "sourcing", "multi_turn"],
      "turns": [
        {
          "user": "Где можно купить тонну молока в Бресте?",
          "checks": [
            { "id": "R001.T1.C1", "type": "not_stub", "description": "Ответ не должен быть stub" },
            { "id": "R001.T1.C2", "type": "includes_any", "patterns": ["брест", "brest"], "description": "Должна учитываться локация Брест" },
            { "id": "R001.T1.C3", "type": "excludes_all", "patterns": ["поликлиник", "больниц", "медицинск"], "description": "Не должно уходить в медицинские нерелевантные компании" }
          ]
        },
        {
          "user": "Я указал Брест - в ответе Минск? Почему? В Бресте есть компании которые продают молоко",
          "checks": [
            { "id": "R001.T2.C1", "type": "not_stub", "description": "Ответ не должен быть stub" },
            { "id": "R001.T2.C2", "type": "includes_any", "patterns": ["брест", "brest"], "description": "Ассистент должен зафиксировать Брест" },
            { "id": "R001.T2.C3", "type": "excludes_all", "patterns": ["локация из запроса:\\s*минск", "фокус по локации:\\s*минск"], "description": "Нельзя переопределять локацию на Минск" }
          ]
        },
        {
          "user": "Где список поставщиков?",
          "checks": [
            { "id": "R001.T3.C1", "type": "not_stub", "description": "Ответ не должен быть stub" },
            { "id": "R001.T3.C2", "type": "includes_any", "patterns": ["/company/", "рубрик", "не подставляю"], "description": "Должен быть список кандидатов или полезный fallback без галлюцинаций" },
            { "id": "R001.T3.C3", "type": "excludes_all", "patterns": ["поликлиник", "больниц", "медицинск"], "description": "Без нерелевантной медицины" }
          ]
        },
        {
          "user": "Указана компания которая продает запчасти в Минске опять!!!",
          "checks": [
            { "id": "R001.T4.C1", "type": "not_stub", "description": "Ответ не должен быть stub" },
            { "id": "R001.T4.C2", "type": "includes_any", "patterns": ["брест", "локаци"], "description": "Должна быть гео-коррекция и удержание контекста" },
            { "id": "R001.T4.C3", "type": "not_refusal_only", "description": "Не отказ, а практичные next steps" }
          ]
        }
      ]
    },
    {
      "id": "R002",
      "title": "Картошка в Витебске: не подставлять нерелевантные карточки",
      "personaGoal": "Закупщик ищет тонну картошки, ожидает либо релевантный shortlist, либо честный fallback без случайных компаний",
      "tags": ["regression", "geo", "sourcing", "multi_turn", "relevance"],
      "turns": [
        {
          "user": "Где купить тонну картошки в витебске?",
          "checks": [
            { "id": "R002.T1.C1", "type": "not_stub", "description": "Ответ не должен быть stub" },
            { "id": "R002.T1.C2", "type": "includes_any", "patterns": ["витеб", "vitebsk"], "description": "Должна фиксироваться локация Витебск" },
            {
              "id": "R002.T1.C3",
              "type": "any_of",
              "description": "Нужен shortlist из каталога или честный практичный fallback",
              "checks": [
                { "type": "company_path_min_count", "min": 1, "description": "Есть хотя бы одна карточка /company/..." },
                { "type": "includes_any", "patterns": ["не нашлось", "не подставляю", "рубрик", "поисковые формулировки"], "description": "Есть полезный fallback без выдумывания" }
              ]
            }
          ]
        },
        {
          "user": "Любую картошку. Где купить?",
          "checks": [
            { "id": "R002.T2.C1", "type": "not_stub", "description": "Ответ не должен быть stub" },
            { "id": "R002.T2.C2", "type": "includes_any", "patterns": ["витеб", "локаци"], "description": "Должно сохраняться гео-уточнение из истории" },
            { "id": "R002.T2.C3", "type": "excludes_all", "patterns": ["не по теме", "автолайт", "жалюзи", "электрооборуд"], "description": "Не показывать явно нерелевантные компании как candidates" }
          ]
        }
      ]
    },
    {
      "id": "R003",
      "title": "Молоко в Витебске: не подставлять нерелевантные компании",
      "personaGoal": "Закупщик ищет молоко оптом в Витебске и не хочет видеть нерелевантные компании в first-pass",
      "tags": ["regression", "geo", "sourcing", "relevance"],
      "turns": [
        {
          "user": "Где можно купить тонну молока в Витебске?",
          "checks": [
            { "id": "R003.T1.C1", "type": "not_stub", "description": "Ответ не должен быть stub" },
            { "id": "R003.T1.C2", "type": "includes_any", "patterns": ["витеб", "vitebsk"], "description": "Должна учитываться локация Витебск" },
            {
              "id": "R003.T1.C3",
              "type": "excludes_all",
              "patterns": ["электротех", "стекл", "мебел", "центр[ы]?\\s+занятост"],
              "description": "Не показывать явно нерелевантные категории как кандидатов"
            }
          ]
        }
      ]
    }
  ]
}
