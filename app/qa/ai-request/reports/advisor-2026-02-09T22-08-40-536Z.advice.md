# Advisor Report — advisor-2026-02-09T22-08-40-536Z

- Generated: 2026-02-09T22:11:45.570Z
- QA report: /home/mlweb/biznesinfo-develop.lucheestiy.com/app/qa/ai-request/reports/latest.json
- Judge report: /home/mlweb/biznesinfo-develop.lucheestiy.com/app/qa/ai-request/reports/latest.usefulness.json
- Focus scenarios: 1
- Advisors: gemini, kimi, minimax

## Focus Scenarios

- UV013 (pass, usefulness n/a): Deep website-scan: внутренняя навигация сайта (контакты/о компании/продукция)

## Consensus

- Top areas:
  - prompt: 5
  - retrieval: 3
  - template: 3
  - guardrails: 2
  - geo: 1
  - ranking: 1
  - ui: 1
- Recurring recommendations:
  - усилить фильтрацию результатов поиска по категориям бизнеса/производства (1)
  - внедрить явные инструкции в промпт для обработки случаев 'нет результатов' (1)
  - улучшить структуру ответа для 'глубокого сканирования сайта' (1)
  - expand category_keywords with manufacturing and services (1)
  - add explicit low-results branch in system prompt (1)
  - fix template variable substitution pipeline (1)
  - implement district/address-aware search fallback (1)
  - add explicit ranking criteria disclosure (1)
  - add relevance validator before returning candidates (1)
  - fix context continuity on topic switchback (1)
  - add 'no results' explicit handling with actionable next steps (1)
  - add explicit 'admit inability' instruction for zero-result vendor searches (1)

## gemini

- Summary: The AI assistant demonstrates a critical failure in identifying relevant businesses based on specific criteria (e.g., 'shoe manufacturers in Minsk'), leading to significantly low usefulness scores. The current fallback mechanism provides irrelevant information rather than acknowledging limitations or suggesting alternative search strategies. This indicates weaknesses in either the retrieval system's ability to filter by business type, the prompt engineering for detailed classification, or the lack of a robust 'no results' handling strategy.

### Priority Plan

- P0 — Улучшить точность идентификации компаний по типу бизнеса
  why: Основная проблема заключается в том, что помощник предоставляет нерелевантные компании (не производители обуви), даже после уточнения. Это приводит к нулевой полезности от судьи.
  impact: Значительно повысит полезность ответов, сократит количество 'строгих' ошибок и повысит удовлетворенность пользователей за счет предоставления точной информации.
  validate: UV013
- P0 — Внедрить корректную обработку сценариев отсутствия результатов поиска
  why: Вместо того чтобы признать неспособность найти кандидатов, помощник генерирует 'нерелевантный список-заполнитель'. Это подрывает доверие и полезность.
  impact: Улучшит взаимодействие с пользователем при отсутствии прямых совпадений, предлагая конструктивные альтернативы или уточнения, а не вводя в заблуждение.
  validate: UV013

### Recommendations

- [R1] (retrieval, effort L) Усилить фильтрацию результатов поиска по категориям бизнеса/производства
  action: Проверить и скорректировать логику извлечения/фильтрации компаний, чтобы убедиться, что они соответствуют запрашиваемому типу (например, 'производитель обуви'). Это может включать более точное извлечение ключевых слов из запроса пользователя ('мужская классическая обувь'), улучшение поисковых запросов к базе данных компаний, или добавление пост-фильтрации результатов на основе категорий/тегов бизнеса. Возможно, потр…
  hint: app/src/lib/data/company-search.ts (гипотетически); review prompt for `deep website-scan` to ensure clear instruction for business type validation.
  impact: Компании, предлагаемые помощником, будут соответствовать запросам пользователей по типу производства, что значительно повысит релевантность и полезность.
  risk: Средний (требуется глубокий анализ и, возможно, переработка логики поиска)
  validate: UV013
- [R2] (prompt, effort S) Внедрить явные инструкции в промпт для обработки случаев 'нет результатов'
  action: Добавить в системный промпт (или специальный промпт для веб-сканирования) четкие инструкции о том, как действовать, если нет релевантных результатов. Например: 'Если после тщательного поиска ни одна компания не соответствует критериям, четко сообщите пользователю об этом и предложите альтернативные варианты поиска (например, 'хотите расширить поиск на другие регионы или на магазины обуви?'). Ни в коем случае не пред…
  hint: devloop/AI_ASSISTANT_MASTER_PLAN.md (обновить план); app/src/lib/prompt-templates/website-scan.js (гипотетически)
  impact: Помощник будет вести себя более предсказуемо и полезно в случаях отсутствия прямых совпадений, избегая предоставления неверной информации и улучшая пользовательский опыт.
  risk: Низкий (изменения промпта могут быть относительно легко протестированы)
  validate: UV013
- [R3] (template, effort M) Улучшить структуру ответа для 'глубокого сканирования сайта'
  action: Пересмотреть шаблон ответа, чтобы он более явно демонстрировал процесс проверки и статус 'Не подтверждено на главной', как это было запрошено пользователем. Убедиться, что помощник не переходит к 'следующему кандидату', если текущий не прошел проверку, но при этом четко отмечает причину. Это может потребовать более структурированного вывода для каждого кандидата (например, JSON-подобный формат).
  hint: app/src/lib/templates/deep-scan-response.js (гипотетически)
  impact: Увеличит прозрачность работы помощника и позволит пользователю лучше понять ход проверки, что может повысить оценку полезности.
  risk: Низкий (изменения в шаблоне ответа)
  validate: UV013

## kimi

- Summary: Critical pattern: Assistant degrades to generic fallback (category advice, template text) when search returns <3 candidates or geo constraints tighten. Core issues: (1) Missing keyword coverage for niche B2B categories (footwear manufacturing, LED rental, security systems), (2) No graceful degradation path - instead of admitting 'only 1 found, here are 2 alternatives', assistant hallucinates or drops to rubric advice, (3) Template text corruption ('уточняется до уточняется') indicates prompt/template injection issues, (4) Geo refinement (city→district) not triggering re-search. Fix priority: retrieval > prompt engineering > guardrails.

### Priority Plan

- P0 — Fix keyword coverage gaps for high-failure categories
  why: Scenarios UV013, S017, S018, D009 all fail because search cannot find: shoe manufacturers, LED rental, security systems, printed boxes. Current CATEGORY_KEYWORDS only covers food/transport.
  impact: Reduces 'completely wrong results' failures by ~40% (4 of 10 critical failures)
  validate: UV013, S017, S018, D009, UX110
- P0 — Implement graceful degradation for low-result searches
  why: When search returns <3 results, assistant currently hallucinates (S017: tractor parts for LED) or drops to generic rubric advice (MX001: real estate for milk). Need explicit branch: if hits<3, admit shortage + suggest broader search terms + offer to check nea…
  impact: Eliminates 'feltGenericFallback=true' in 60% of failures; improves user trust
  validate: MX001, MX002, UX101, UX107, S016
- P1 — Fix template text corruption / prompt injection
  why: Recurring garbled text 'уточняется до уточняется', 'сформируй rfq' appearing in output indicates template variables not being replaced or prompt boundary issues.
  impact: Eliminates quality degradation signals in D001, D003, MX004, MX005
  validate: D001, D003, MX004, MX005
- P1 — Enable geo refinement re-search (district level)
  why: User specifies 'Малиновка', 'Уручье', 'Советский район', 'Колодищи' - assistant repeats same city-level results without re-searching. Location filter is binary (city match), not hierarchical.
  impact: Improves usefulness score in 5 scenarios (D001, UX107, S019, S020, MX004)
  validate: D001, UX107, S019, S020, MX004
- P2 — Add RFQ template validation layer
  why: RFQ outputs contain placeholders ('уточняется') instead of resolved values from conversation context. Need post-generation validation to ensure placeholders are filled or removed.
  impact: Improves template task completion rate from current ~50% to >90%
  validate: MX001, MX004, MX005, UV001, UV004

### Recommendations

- [R1] (retrieval, effort S) Expand CATEGORY_KEYWORDS with manufacturing and services
  action: Add entries for: обувная_промышленность=['производство обуви','обувная фабрика','обувь оптом'], event_equipment=['аренда led','экраны прокат','event оборудование'], security_systems=['охранные системы','сигнализация','видеонаблюдение установка'], packaging=['коробки производство','упаковка картон','печать на коробках']. Also add footwear to PRODUCT_INDICATORS in keywords.ts.
  hint: src/lib/biznesinfo/keywords.ts lines 63-74 add new category mappings; verify search.ts lines 33-105 include new category filters
  impact: Enables finding shoe manufacturers, LED rental, security installers - fixes 4 critical failures
  risk: May increase false positives if keywords too broad; test with negative queries
  validate: UV013, S017, S018, D009
- [R2] (prompt, effort S) Add explicit low-results branch in system prompt
  action: When search returns <3 results, assistant MUST: (1) State exact count found, (2) Admit if zero/insufficient, (3) Suggest 2-3 broader search queries user can try, (4) Offer to check nearby locations. NEVER invent companies or show unrelated categories.
  hint: Modify prompt template in src/app/api/chat/route.ts or wherever system prompt defined; add conditional logic based on search result count
  impact: Eliminates hallucination fallback; improves continuityScore in MX001, MX002, UX101
  risk: Users may be disappointed by 'not found' - but better than wrong info
  validate: MX001, MX002, UX101, UX107, S016
- [R3] (template, effort M) Fix template variable substitution pipeline
  action: Audit template rendering: 'уточняется' and garbled text suggests variable substitution failing. Add validation: if output contains 'уточняется' or repeated phrases like 'уточняется до уточняется', reject and retry with stricter prompt. Replace unfilled placeholders with empty string or explicit '[не указано]'.
  hint: Add post-processing in chat API route; regex check for /уточняется|сформируй rfq/i; implement retry with explicit variable mapping
  impact: Eliminates quality degradation signals; improves perceived competence
  risk: Retry may increase latency; cap at 1 retry
  validate: D001, D003, MX004, MX005
- [R4] (geo, effort M) Implement district/address-aware search fallback
  action: When user mentions district (Малиновка, Уручье, Советский район), extract and use as secondary filter. If exact district match fails, return city results WITH explicit note 'В [district] не найдено, показываю результаты по [city]'. Use address field search for district names.
  hint: src/lib/utils/location.ts add DISTRICT_PATTERNS; modify search.ts line 528-553 to extract district from query and apply as soft filter; meilisearch filter on address field
  impact: Improves geo-constraint handling in 5 scenarios; reduces 'ignored my district' complaints
  risk: Address field may not be normalized; test with various district name variants
  validate: D001, UX107, S019, S020, MX004
- [R5] (ranking, effort S) Add explicit ranking criteria disclosure
  action: When delivering 'top-3' or shortlist, always include 1-sentence rationale per candidate: 'Приоритет: [критерий]'. Criteria: contact completeness, website available, matching keywords count, location proximity. This prevents generic 'риск несоответствия задаче' placeholders.
  hint: Modify ranking prompt section; require structured output with 'candidates[].name', 'candidates[].url', 'candidates[].rationale'
  impact: Improves usefulness score from 2→3 in D004, D006, D007, S019, S020
  risk: May increase response length; acceptable tradeoff
  validate: D004, D006, D007, S019, S020
- [R6] (guardrails, effort M) Add relevance validator before returning candidates
  action: Before presenting candidates to user, verify keyword overlap between query intent and company keywords. If overlap < threshold (e.g., security systems query vs auto cosmetics company = 0 overlap), reject and search again with broader terms. Log mismatches for index improvement.
  hint: Add pre-response check in chat route; use existing keywords.ts functions; fallback to broader search if relevance fails
  impact: Prevents S018 (auto cosmetics for security), S017 (tractor parts for LED), UX110 (restaurant for coffee supplies)
  risk: May increase latency; cache keyword vectors
  validate: S017, S018, UX110, D009
- [R7] (prompt, effort L) Fix context continuity on topic switchback
  action: When user returns to original topic after brief digression (e.g., milk → auto parts → milk), assistant must restore full context of original query including all constraints. Current failure: MX003 Turn 3 returned to milk but lost company specifics.
  hint: Maintain turn history with constraint extraction; on switchback detection, re-inject original constraints into context window
  impact: Improves continuityScore in multi-turn scenarios; prevents 'where were we' failures
  risk: Complex state management; use explicit constraint tracking object
  validate: MX003, MX001, MX002
- [R8] (ui, effort M) Add 'no results' explicit handling with actionable next steps
  action: When MeiliSearch returns 0 hits, return structured response: 'По запросу [X] в [location] не найдено компаний. Попробуйте: (1) [broader term 1], (2) [broader term 2], (3) [nearby location].' Never show unrelated categories or generic 'search in rubrics' advice.
  hint: Modify search.ts meiliSearch function return; add explicit zero-results branch with suggestion generation
  impact: Improves UX101, UX107, S016 zero-result handling
  risk: Suggestion generation requires synonym dictionary
  validate: UX101, UX107, S016, UV011

## minimax

- Summary: Critical failure in vendor lookup fallback: assistant produces wrong shortlists instead of admitting inability. P0 fix needed for `buildRankingFallbackAppendix` to detect when no relevant candidates exist and return honest 'no results' with alternatives instead of hallucinated irrelevant companies. Secondary P1 issue: multi-turn continuity breaks when user clarifies intent (мужская классическая обувь) — lookup context not properly refined.

### Priority Plan

- P0 — Fix vendor shortlist hallucination in fallback mode
  why: Judge reports assistant generated completely wrong shortlist (non-shoe companies) when no shoe manufacturers exist. This is hallucination: presenting irrelevant companies as verified candidates destroys user trust.
  impact: Eliminate generic fallback hallucination; users will receive honest 'no results' with alternatives instead of wrong company lists. Expected 100% reduction in this failure mode.
  validate: UV001.T3, Any vendor search with zero rel…
- P1 — Improve multi-turn vendor lookup context refinement
  why: After user clarification (мужская классическая обувь), assistant failed to update search context. Turn 2 already had 'нет релевантных обувных производителей' but didn't trigger proper alternative flow.
  impact: Better continuity when users refine their request; lookup context will incorporate new terms from clarification messages.
  validate: UV001.T2, Any multi-turn vendor search wi…

### Recommendations

- [R1] (prompt, effort S) Add explicit 'admit inability' instruction for zero-result vendor searches
  action: Add system-level instruction in `buildRankingFallbackAppendix`: when `vendorCandidates.length === 0` AND search is for specific manufacturer/category, return honest admission first before alternatives. Example: 'Не нашёл производителей обуви в Минске по текущему запросу' before suggesting broader searches.
  hint: File: `app/src/app/api/ai/request/route.ts`, function `buildRankingFallbackAppendix`. Add early return block for zero-relevance case with honest admission.
  impact: Users get honest feedback when no results exist, reducing confusion and trust damage from hallucinated shortlists.
  risk: Low — improves honesty, no data exposure
  validate: UV001.T3
- [R2] (retrieval, effort S) Add relevance filter before shortlist generation
  action: Before generating shortlist, verify each candidate's `primary_rubric_name` or `primary_category_name` matches search terms. If none match, skip shortlist generation entirely and return 'no results' flow.
  hint: File: `app/src/app/api/ai/request/route.ts`, in `buildRankingFallbackAppendix` before `rankedRowsPool` assignment. Add filter: `candidates.filter(c => searchTerms.some(term => c.primary_rubric_name?.includes(term) || c.primary_category_nam…
  impact: Prevents presenting irrelevant companies as verified candidates. Zero false positives in shortlist.
  risk: Low — filtering, not generation
  validate: UV001.T3, Any vendor shortlist request
- [R3] (prompt, effort M) Enhance multi-turn context to capture clarification intent
  action: When user adds clarification (e.g., 'мужская классическая обувь'), update `vendorLookupContext.searchText` by appending new terms to existing search terms, not replacing. This preserves geo filter (Минск) while adding product refinement.
  hint: File: `app/src/app/api/ai/request/route.ts`, function detecting clarification intent. Modify to: `searchText = existingSearchText + ' ' + newClarificationTerms` instead of complete replacement.
  impact: Turn 2+ vendor searches will incorporate both location (Минск) and product refinement (мужская классическая обувь), improving result relevance.
  risk: Medium — affects search behavior
  validate: UV001.T2, UV001.T3
- [R4] (template, effort S) Create 'no vendor results' response template
  action: Add dedicated response template for cases when vendor search yields no relevant results. Template should include: (1) honest admission, (2) suggested alternative search terms, (3) suggestion to broaden geographic scope, (4) offer to help with other aspects of sourcing.
  hint: File: `app/src/app/api/ai/request/route.ts`, new function `buildNoVendorResultsReply(params)`. Return structure: admission → alternatives → broadening options → next steps.
  impact: Consistent, helpful response when no vendors found; users receive actionable alternatives instead of filler.
  risk: Low — improves response quality
  validate: UV001.T2, UV001.T3
- [R5] (guardrails, effort S) Add validation: shortlist must match search intent
  action: Before returning shortlist, validate that each listed company has at least one matching term between company's rubric/category and search terms. Log warning and skip shortlist if validation fails.
  hint: File: `app/src/app/api/ai/request/route.ts`, add `validateShortlistRelevance(candidates, searchTerms)` function. Call before returning shortlist in any response mode.
  impact: Runtime guard against hallucinated shortlists; explicit logging for debugging.
  risk: Low — validation only
  validate: UV001.T3, All shortlist-generating scenar…

