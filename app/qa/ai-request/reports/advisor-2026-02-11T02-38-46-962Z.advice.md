# Advisor Report — advisor-2026-02-11T02-38-46-962Z

- Generated: 2026-02-11T02:41:56.140Z
- QA report: /home/mlweb/biznesinfo-develop.lucheestiy.com/app/qa/ai-request/reports/latest.json
- Judge report: /home/mlweb/biznesinfo-develop.lucheestiy.com/app/qa/ai-request/reports/latest.usefulness.json
- Focus scenarios: 17
- Advisors: kimi, minimax

## Focus Scenarios

- UV012 (pass, usefulness 1/5): Проверка по сайтам компаний: источник + контакты + честная пометка подтверждения
- UV013 (pass, usefulness 1/5): Deep website-scan: внутренняя навигация сайта (контакты/о компании/продукция)
- UV001 (pass, usefulness 1.5/5): Производители обуви в Минске: уточнение типа + shortlist + шаблон контакта
- UV005 (pass, usefulness 1.5/5): Экспортеры пищевой промышленности: сегментация по рынкам и продукту
- UV011 (pass, usefulness 1.5/5): No-results ветка: сверхузкий запрос на производителей обуви
- UV004 (pass, usefulness 2/5): Белорусские соковыжималки: заводы -> OEM/ODM -> shortlist -> RFQ
- UV008 (pass, usefulness 2/5): Белорусский минитрактор: покупка + критерии + сравнение
- UV014 (pass, usefulness 2/5): Reverse-buyer вариативный: пищевая тара -> целевые сегменты -> shortlist без общих советов
- UV002 (pass, usefulness 3/5): Заводы муки: Беларусь -> качество -> экспортные документы -> shortlist
- UV007 (pass, usefulness 3/5): Найти потенциальных заказчиков моей продукции: reverse поиск + shortlist
- UV009 (pass, usefulness 3/5): Стоматология с микроскопом в Минске: сложный consumer кейс + полезный fallback
- UV015 (pass, usefulness 3/5): Вариант по минитракторам: покупка -> сравнение условий -> запрос для звонка
- UV003 (pass, usefulness 4/5): Где поблизости вкусно поесть: consumer запрос -> b2b переформулировка
- UV006 (pass, usefulness 4/5): Лес на экспорт: условия качества + логистика + RFQ
- UV016 (pass, usefulness 4/5): Вариативный экспорт муки: shortlist + документная проверка + шаблон запроса
- UV017 (pass, usefulness 4/5): Свекла 500 кг в Минске: защита от нерелевантных "не-поставщиков"
- UV010 (pass, usefulness 4.5/5): Не помню точный бренд молочной компании: гипотезы + проверка + уточнение

## Consensus

- Top areas:
  - prompt: 4
  - guardrails: 2
  - retrieval: 1
  - ranking: 1
  - template: 1
- Recurring recommendations:
  - relax strictintent hard-stop in refineconcreteshortlistcandidates (1)
  - inject forced shortlist appendix before ranking fallback (1)
  - add commodity-domain validation to no-results fallback (1)
  - preserve history candidates in continuityshortlistforappend (1)
  - fix truncated response in document checklist requests (1)
  - add 'company count enforcement' to shortlist prompts (1)
  - add cross-category validation for food requests (1)
  - add 'deliverable confirmation' step (1)
  - add 'criteria echo' before each multi-turn response (1)

## kimi

- Summary: Biznesinfo assistant suffers from systematic failures in multi-turn sourcing scenarios: cyclic refusal patterns (UV012/UV013), generic criteria fallback instead of concrete shortlists (UV001/UV002), and context loss between turns (UV005/UV014). Root cause: over-restrictive candidate filtering in refineConcreteShortlistCandidates() and insufficient continuity enforcement in postProcessAssistantReply(). Fixable with 3 small PRs.

### Priority Plan

- P0 — Fix cyclic refusal in website-scan scenarios
  why: UV012 and UV013 both scored usefulness=1 - assistant repeats 'нет самих 3 компаний' 3x without providing candidates. This is a hard failure in the website-scan flow.
  impact: Eliminates 2 of 5 lowest-scoring scenarios; fixes core UX loop where user explicitly asks for companies to check.
  validate: UV012, UV013
- P0 — Enforce concrete shortlist output in ranking mode
  why: UV001, UV002, UV004 all fail when user asks for 'shortlist' - assistant returns generic criteria instead of /company/ links. The buildRankingFallbackAppendix() triggers too aggressively.
  impact: Fixes 3 high-frequency failure patterns; ensures continuity of concrete company references across turns.
  validate: UV001, UV002, UV004, UV014
- P1 — Add hallucination guard for no-results scenarios
  why: UV011 shows assistant listing construction materials companies for footwear query instead of honest 'no results' fallback.
  impact: Prevents misleading outputs; maintains trust in narrow/specialized queries.
  validate: UV011

### Recommendations

- [R1] (retrieval, effort S) Relax strictIntent hard-stop in refineConcreteShortlistCandidates
  action: Remove or soften lines 1976-1977 in route.ts: `if (strictIntent && ranked.length === 0) return []`. When strictIntent=true but ranked=[], fall back to base pool filtered by geo instead of returning empty. This causes the 'нет самих 3 компаний' loop.
  hint: app/src/app/api/ai/request/route.ts:1976-1977 - change `return []` to `pool = base.filter(c => companyMatchesGeoScope(c, {region, city}))`
  impact: UV012/UV013 will return candidates for website-scan instead of empty refusal
  risk: Low - geo-scoped fallback is safe; maintains relevance
  validate: UV012, UV013
- [R2] (prompt, effort S) Inject forced shortlist appendix before ranking fallback
  action: In postProcessAssistantReply(), when mode.rankingRequested=true AND continuityCandidates.length>0, prepend concrete shortlist before any generic ranking text. Current code at line 2788 only appends fallback if no company links detected - move this earlier.
  hint: app/src/app/api/ai/request/route.ts:2678-2829 - insert `out = buildForcedShortlistAppendix({candidates: rankingCandidates, message})` at start of ranking block, before any fallback logic
  impact: UV001/UV002/UV004 will show /company/ links instead of criteria-only output
  risk: Low - forced shortlist uses verified candidates only
  validate: UV001, UV002, UV004
- [R3] (guardrails, effort S) Add commodity-domain validation to no-results fallback
  action: In buildGenericNoResultsCriteriaGuidance() and related fallbacks, check if commodityTag is set but no commodity-aligned candidates exist. If so, emit honest 'no results' message instead of generic criteria or unrelated companies.
  hint: app/src/app/api/ai/request/route.ts:747-764 - add early return if commodityTag && candidates.filter(c=>candidateMatchesCoreCommodity(c, commodityTag)).length===0
  impact: UV011 will honestly report no footwear manufacturers instead of hallucinating construction companies
  risk: Low - only affects true no-results cases
  validate: UV011
- [R4] (ranking, effort M) Preserve history candidates in continuityShortlistForAppend
  action: UV014 shows context loss - turn 2 had good candidates but turn 3 degraded to placeholders. Ensure historyVendorCandidates are merged into continuityShortlistForAppend even when fresh lookup returns empty.
  hint: app/src/app/api/ai/request/route.ts:2368-2377 - expand logic to always include historyOnlyCandidatesRaw when lockToHistoryCandidates=true, regardless of fresh lookup results
  impact: UV014 maintains concrete companies across 'без общих советов' turn
  risk: Low - history candidates already validated in prior turns
  validate: UV014
- [R5] (template, effort M) Fix truncated response in document checklist requests
  action: UV016 turn 3 was truncated mid-response. Add output length validation and chunking for document checklist + template combo requests.
  hint: app/src/app/api/ai/request/route.ts:2483-2490 - split template and documents into separate messages if combined length exceeds threshold, or prioritize template blocks over document list
  impact: UV016 delivers complete 5-document checklist instead of truncation
  risk: Low - formatting change only
  validate: UV016

## minimax

- Summary: The assistant shows 100% strict pass rate but only 47% useful rate. Core problem: generic fallbacks, hallucinated companies, and context loss in multi-turn flows. Fix prompts to enforce 'company-first' behavior and eliminate empty placeholders.

### Priority Plan

- P0 — Enforce 'No Empty Placeholders' Rule
  why: UV014 and UV001 fail because assistant returns '/company/belmilk' or empty 'Профиль:' instead of real company names. This is the single most common failure pattern.
  impact: Eliminate placeholder responses; forcing real company names or explicit 'no data' answers.
  validate: UV014, UV001
- P0 — Add 'Must Name 3 Companies' Constraint
  why: UV012, UV013, UV011 repeatedly claim 'no companies found' without ever listing candidates. Prompt should force at least 3 named candidates even if imperfect.
  impact: Reduce hallucinated 'no results' claims; ensure users get actionable starting points.
  validate: UV012, UV013, UV011
- P1 — Fix Company Type Guardrails for Food Export
  why: UV005 recommended livestock farms (Agrostroy SPF) for dairy/confectionery export. Cross-category hallucination is severe.
  impact: Prevent recommending cement factories for food, livestock farms for dairy.
  validate: UV005
- P1 — Add 'Deliverable Checklist' to Prompts
  why: UV009, UV001 fail to deliver requested outputs (call script, RFQ template). Prompt should explicitly require confirmation of deliverable type before guidance.
  impact: Ensure users get requested formats (script/template) not generic advice.
  validate: UV009, UV001
- P2 — Add Context Retention Checkpoint
  why: UV002, UV014 lose criteria from earlier turns. Assistant should summarize remembered constraints before each response.
  impact: Prevent continuity breaks in multi-turn flows.
  validate: UV002, UV014, UV008

### Recommendations

- [R1] (prompt, effort S) Add 'Company Count Enforcement' to Shortlist Prompts
  action: Add to all shortlist templates: 'YOU MUST list at least 3 company names. If no confirmed companies exist, explicitly state: "No verified companies found for X. Candidates based on keyword matching: [name 1], [name 2], [name 3]." Never use placeholder links like /company/id.'
  hint: Edit shortlist templates in app/src/lib/prompts/ or equivalent. Search for 'shortlist' pattern in prompt files.
  impact: Eliminate empty placeholders; force real names or honest 'no verified data' answers.
  risk: Low - only changes output format
  validate: UV014, UV001, UV013
- [R2] (guardrails, effort M) Add Cross-Category Validation for Food Requests
  action: Before suggesting companies for food/dairy export requests, validate: is this company a manufacturer (not farm, not retail)? Add category blacklist for food requests: farms, retail, construction, automotive.
  hint: Add validation function in app/src/lib/utils/location.ts or new guardrails file. Call before company list generation.
  impact: Prevent recommending livestock farms for dairy exports, cement factories for food.
  risk: Low - filtering only
  validate: UV005
- [R3] (prompt, effort M) Add 'Deliverable Confirmation' Step
  action: For any user request, first identify deliverable type (template/script/list/advice). If user asks for 'сделай скрипт' or 'сделай шаблон', assistant must output that format first, THEN add context. Never lead with 'guidance' when specific format requested.
  hint: Modify assistant response logic to parse intent type. Search for 'script' or 'template' keywords in user requests.
  impact: UV009 would deliver call script; UV001 would deliver RFQ template.
  risk: Medium - changes response structure
  validate: UV009, UV001, UV004
- [R4] (prompt, effort S) Add 'Criteria Echo' Before Each Multi-Turn Response
  action: At start of each turn 2+ response, include: 'Помню критерии: [list from turn 1]. Корректировки: [if any]. Кандидаты по этим критериям:' This forces context retention verification.
  hint: Add to multi-turn prompt template. Search for 'turn 2' or 'multi_turn' patterns.
  impact: Prevent context loss in UV002, UV014, UV008.
  risk: Low - adds structure
  validate: UV002, UV014, UV008

