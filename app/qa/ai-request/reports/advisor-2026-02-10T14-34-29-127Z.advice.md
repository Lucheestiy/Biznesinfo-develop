# Advisor Report — advisor-2026-02-10T14-34-29-127Z

- Generated: 2026-02-10T14:39:13.472Z
- QA report: /home/mlweb/biznesinfo-develop.lucheestiy.com/app/qa/ai-request/reports/latest.json
- Judge report: /home/mlweb/biznesinfo-develop.lucheestiy.com/app/qa/ai-request/reports/latest.usefulness.json
- Focus scenarios: 17
- Advisors: kimi, minimax

## Focus Scenarios

- UV017 (pass, usefulness 1/5): Свекла 500 кг в Минске: защита от нерелевантных "не-поставщиков"
- UV013 (pass, usefulness 1.5/5): Deep website-scan: внутренняя навигация сайта (контакты/о компании/продукция)
- UV015 (pass, usefulness 1.5/5): Вариант по минитракторам: покупка -> сравнение условий -> запрос для звонка
- UV001 (pass, usefulness 2/5): Производители обуви в Минске: уточнение типа + shortlist + шаблон контакта
- UV004 (pass, usefulness 2/5): Белорусские соковыжималки: заводы -> OEM/ODM -> shortlist -> RFQ
- UV008 (pass, usefulness 2/5): Белорусский минитрактор: покупка + критерии + сравнение
- UV012 (pass, usefulness 2/5): Проверка по сайтам компаний: источник + контакты + честная пометка подтверждения
- UV005 (pass, usefulness 2.5/5): Экспортеры пищевой промышленности: сегментация по рынкам и продукту
- UV007 (pass, usefulness 2.5/5): Найти потенциальных заказчиков моей продукции: reverse поиск + shortlist
- UV014 (pass, usefulness 2.5/5): Reverse-buyer вариативный: пищевая тара -> целевые сегменты -> shortlist без общих советов
- UV002 (pass, usefulness 3/5): Заводы муки: Беларусь -> качество -> экспортные документы -> shortlist
- UV003 (pass, usefulness 3/5): Где поблизости вкусно поесть: consumer запрос -> b2b переформулировка
- UV011 (pass, usefulness 3/5): No-results ветка: сверхузкий запрос на производителей обуви
- UV016 (pass, usefulness 3/5): Вариативный экспорт муки: shortlist + документная проверка + шаблон запроса
- UV010 (pass, usefulness 3.5/5): Не помню точный бренд молочной компании: гипотезы + проверка + уточнение
- UV009 (pass, usefulness 4/5): Стоматология с микроскопом в Минске: сложный consumer кейс + полезный fallback
- UV006 (pass, usefulness 4.5/5): Лес на экспорт: условия качества + логистика + RFQ

## Consensus

- Top areas:
  - retrieval: 3
  - guardrails: 3
  - prompt: 3
  - geo: 2
  - template: 2
  - ranking: 1
- Recurring recommendations:
  - add product category classifier before search (1)
  - implement retrieval relevance validator (1)
  - add constraint extraction and enforcement to system prompt (1)
  - implement shortlist quality enforcement (1)
  - add geo constraint validation for location queries (1)
  - fix template generation to include specific recipients (1)
  - add keyword expansion for low-recall queries (1)
  - add 'institution type' filter for supplier queries (1)
  - add explicit company name whitelist enforcement in system prompt (1)
  - add context-tracker token to prevent multi-turn drift (1)
  - expand search scope automatically when zero results (1)
  - remove 'резервный слот' from final output format (1)

## kimi

- Summary: The QA analysis reveals a critical pattern: while strict checks pass (100%), usefulness scores are poor (avg 2.47/5, usefulRate 47%). The core issue is a disconnect between retrieval and response generation. The search system (Meilisearch) returns results, but the AI fails to: (1) map user intent to correct search queries, (2) filter/rank results by relevance, (3) maintain context across turns. Worst failures: UV017 (beet suppliers) returned a college and auto parts; UV004 (juicers) returned tire/asphalt factories; UV013 (website scan) never provided companies to scan. The AI defaults to 'teaching how to search' instead of 'doing the search'.

### Priority Plan

- P0 — Fix category-to-query mapping for product sourcing queries
  why: UV017, UV004, UV002 show the AI cannot map product queries (beet, juicers, flour) to correct search terms. Current system likely uses naive keyword matching without product category ontology.
  impact: Eliminate 60% of 'completely wrong category' hallucinations. UV017, UV004, UV002 would become useful.
  validate: UV017, UV004, UV002, UV003
- P0 — Add retrieval-result validation layer before response generation
  why: The AI returns results without checking if they match the query category. UV017 returned a college for beet; UV004 returned tire factory for juicers. Need a relevance validator.
  impact: Prevent embarrassing mismatches. Force honest 'no results' fallback instead of wrong-category results.
  validate: UV017, UV004, UV011, UV003
- P1 — Implement multi-turn context memory for constraints
  why: UV001, UV013, UV014 show the AI forgets or ignores constraints from previous turns (manufacturer vs retail, specific product types, 'no generic advice' instructions).
  impact: Improve continuityScore from 2 to 4. Reduce generic fallback rate from 47% to <20%.
  validate: UV001, UV013, UV014, UV008
- P1 — Add company shortlist minimum-fill enforcement
  why: UV005, UV007 show placeholder text ('резервный слот') instead of actual companies. Better to return 2 real companies than 1 real + 4 placeholders.
  impact: Eliminate placeholder anti-pattern. Force search expansion or honest 'only X found' responses.
  validate: UV005, UV007, UV016
- P2 — Create rubric-to-company verification prompt chain
  why: UV012, UV013 require website verification of companies. Current AI gives methodology instead of executing checks. Need structured tool use for website scanning.
  impact: Enable actual website verification flows. UV012, UV013 become useful instead of generic.
  validate: UV012, UV013, UV010

### Recommendations

- [R1] (retrieval, effort M) Add product category classifier before search
  action: Before calling meiliSearch, classify user intent into a product category from a predefined taxonomy (food/agriculture, machinery/equipment, packaging, textiles, construction, services). Use this to validate retrieved results match the category. Reject results whose primary_rubric_name doesn't match the classified category.
  hint: src/lib/meilisearch/search.ts: Add categoryClassifier() function. In meiliSearch(), after getting results, filter out companies where primary_rubric_slug doesn't match expected category. Log mismatches for debugging.
  impact: Eliminates UV017-type errors (college for beet). Forces search query reformulation instead of returning wrong-category results.
  risk: May reduce recall for cross-category companies (e.g., conglomerates). Mitigation: allow multi-category matches.
  validate: UV017, UV004, UV002
- [R2] (guardrails, effort S) Implement retrieval relevance validator
  action: Create a post-retrieval validation function that checks if returned companies have keyword overlap with the user query. If <30% of returned companies contain query-related keywords in their keywords/description, reject and trigger 'no results' fallback instead of returning irrelevant companies.
  hint: src/lib/meilisearch/search.ts: Add validateRelevance(results, queryTokens, minThreshold=0.3) function. Called after meiliSearch() before returning to API. If fails, return empty results with 'no_confident_matches' flag.
  impact: Prevents UV004 (juicers→tires) and UV017 (beet→college) type errors. Forces honest no-results response.
  risk: May be too strict for ambiguous queries. Make threshold configurable per query type.
  validate: UV017, UV004, UV011, UV003
- [R3] (prompt, effort S) Add constraint extraction and enforcement to system prompt
  action: Modify AI system prompt to: (1) explicitly list all constraints from conversation history at start of each response, (2) verify response satisfies each constraint, (3) refuse to give generic advice if user explicitly asked for companies. Add 'constraint_check' section to response format.
  hint: Identify where AI prompt is defined (likely external, not in this repo). Add: 'Before responding, list: [Constraints from history]. Check: Does my response satisfy each? If user asked for specific companies and I have none, say "В текущей…
  impact: Reduces generic fallback rate. UV001, UV014 would correctly admit no data instead of giving types/frameworks.
  risk: May increase refusal rate. Acceptable if refusals are honest.
  validate: UV001, UV014, UV013, UV008
- [R4] (ranking, effort M) Implement shortlist quality enforcement
  action: When user requests N companies (e.g., 'top-5', 'shortlist 3-5'), enforce: (1) minimum 80% fill rate (4 real companies for top-5), (2) no placeholder text allowed, (3) if insufficient results, expand search (remove filters, use synonyms) or honestly report 'found only X'. Never use placeholder slots.
  hint: Wherever shortlist generation happens (likely AI response layer): Add check - if requested N=5 and found <4, trigger search expansion with broader terms OR return honest count. Ban placeholder text pattern 'резервный слот'.
  impact: Eliminates UV005, UV007 placeholder anti-pattern. Improves user trust.
  risk: Search expansion may reduce relevance. Mitigation: clearly mark expanded results as 'less precise matches'.
  validate: UV005, UV007, UV016
- [R5] (geo, effort S) Add geo constraint validation for location queries
  action: For queries with city/region constraints, validate that returned companies actually match the location. Current system has city filtering but UV017 still returned wrong-location results. Add post-filter to ensure city field matches requested location.
  hint: src/lib/meilisearch/search.ts: The city filter exists (line 552-554) but may not be strict enough. Add explicit post-filter: results = results.filter(r => normalizeCity(r.city) === normalizeCity(requestedCity)).
  impact: Prevents location mismatches. UV017 (Minsk beet) won't return companies from other cities.
  risk: May filter out valid results with slightly different city naming. Use fuzzy matching.
  validate: UV017, UV001, UV012
- [R6] (template, effort S) Fix template generation to include specific recipients
  action: When generating outreach templates (Subject/Body/WhatsApp), require the AI to either: (1) include specific company name in the template, OR (2) provide a placeholder like '[Название компании из shortlist выше]' with clear instruction to fill from previous turn. Never generate template without recipient context.
  hint: In AI prompt for template generation: add rule 'Template must reference specific company from shortlist. If multiple companies, generate separate template for each OR include placeholder with clear mapping instruction.'
  impact: UV001, UV004 templates become actionable instead of generic. User knows which company to contact.
  risk: Minimal. May increase response length slightly.
  validate: UV001, UV004, UV005, UV017
- [R7] (retrieval, effort M) Add keyword expansion for low-recall queries
  action: When initial search returns <3 results for product queries, automatically expand with synonyms and related terms. Example: 'соковыжималка' → expand to 'бытовая техника', 'кухонные приборы', 'мелкая бытовая техника'. Use keyword taxonomy or LLM-based expansion.
  hint: src/lib/meilisearch/search.ts: In meiliSearch(), if results.length < 3 and query is product-type, call expandKeywords(query) which returns array of related terms. Re-run search with OR logic.
  impact: Improves recall for niche products (UV004 juicers, UV008 minitractors). Reduces 'no results' scenarios.
  risk: May introduce irrelevant results. Use with relevance validator (R2).
  validate: UV004, UV008, UV011
- [R8] (guardrails, effort S) Add 'institution type' filter for supplier queries
  action: For sourcing queries (buying products, finding suppliers), automatically filter out educational institutions, medical facilities, government offices. These should never appear in B2B supplier shortlists.
  hint: src/lib/meilisearch/search.ts: Add exclusion filter for rubrics containing 'образован', 'медицин', 'государствен', 'администрац' when query intent is 'supplier_sourcing'.
  impact: Prevents UV017-type error (college for beet). Prevents hospitals/schools appearing in supplier results.
  risk: May exclude legitimate B2B suppliers that happen to have educational divisions. Rare case.
  validate: UV017, UV003, UV110

## minimax

- Summary: Biznesinfo assistant shows 100% strict pass rate but only 47-59% usefulness due to three systemic failures: (1) LLM hallucinates irrelevant company names when catalog returns sparse results (auto dealers for juicers, polytechnic college for beets), (2) fallback to generic 'types of candidates' instead of concrete companies after multiple turns, (3) context drift in multi-turn conversations (minitractor → dairy producer). Fix requires: stronger anti-hallucination guardrails, mandatory catalog grounding, and explicit context continuity enforcement.

### Priority Plan

- P0 — Add mandatory catalog grounding for ALL company name generation
  why: 47% of judge issues cite fabricated company names not in catalog (НИИЭВМ for juicers, auto centers for beet suppliers). Current prompt rule 'Do NOT fabricate' is ignored by LLM when catalog returns few results.
  impact: Reduce hallucinated company mentions by 80%+; improve usefulness scores from 2.5→3.5 for scenarios UV004, UV008, UV017
  validate: UV004, UV008, UV017, UV003
- P0 — Eliminate 'Резервный слот' placeholder pattern
  why: Placeholders like 'в текущем фильтре нет подтвержденной карточки (не выдумываю компанию)' are appearing in final output, signaling assistant failure transparently but still lowering trust. Users see empty slots as inability to deliver.
  impact: Cleaner output; reduces 'failed to deliver promised top-5' complaints; improves perceived competence
  validate: UV005, UV007
- P1 — Enforce strict context continuity for multi-turn sourcing flows
  why: UV015 (minitractors) and UV013 (website scan) show complete context loss—assistant switched to unrelated topics (dairy producer, generic advice). LLM needs explicit session-state enforcement.
  impact: Prevent off-topic drifts in complex 3+ turn conversations; improve avg usefulness from 2.0→2.8 for multi-turn variants
  validate: UV013, UV015, UV012
- P1 — Replace generic 'types of candidates' fallback with 'no results + alternative query'
  why: Multiple scenarios (UV001, UV002, UV011, UV016) show assistant responding with abstract categories ('региональные мелькомбинаты', 'молочные комбинаты') instead of concrete names when user explicitly requested 3-5 companies.
  impact: Eliminate generic fallbacks; direct users to next actionable step (expand query, try neighboring rubrics, manual verification)
  validate: UV001, UV002, UV011, UV016

### Recommendations

- [R1] (guardrails, effort S) Add explicit company name whitelist enforcement in system prompt
  action: Replace weak 'Do NOT fabricate' with hard constraint: 'OUTPUT ONLY company names that appear in the Vendor candidates block above. If no candidates match the user's request, respond: "No matching companies found in catalog. Try broadening your search (other rubrics, larger region)."'
  hint: route.ts: buildAssistantSystemPrompt() - strengthen rule around line with 'Do NOT fabricate facts about specific companies'
  impact: Blocks hallucinations like НИИЭВМ, medical centers, auto dealers from appearing in final output
  risk: Low - makes assistant more honest when no data exists
  validate: UV004, UV008, UV017, UV003
- [R2] (prompt, effort M) Add context-tracker token to prevent multi-turn drift
  action: At start of assistant turn, inject explicit context reminder: 'Current sourcing goal: [product/category from Turn 1]. Previous turns focused on: [list]. Stay on topic unless user explicitly redirects.'
  hint: route.ts: buildAssistantPrompt() - add new context tracking prompt block, similar to rubricHints
  impact: Prevents minitractor→dairy drift; keeps UV015 on track
  risk: Low - adds clarity, reduces drift
  validate: UV015, UV013, UV012
- [R3] (retrieval, effort M) Expand search scope automatically when zero results
  action: When biznesinfoSearch returns <2 candidates, auto-expand: (a) neighboring rubrics, (b) relax city→region, (c) fallback to 'similar products' before answering. Return expanded results in vendorCandidates block.
  hint: route.ts: vendor candidate selection logic - enhance relaxedVendorCandidateSelection() to be more aggressive; add 'expanded_search_results' flag to prompt
  impact: Fewer empty shortlists; more concrete options presented to users
  risk: Medium - may return less relevant results; needs relevance threshold
  validate: UV011, UV005
- [R4] (template, effort S) Remove 'Резервный слот' from final output format
  action: Modify buildForcedShortlistAppendix() to return empty string instead of placeholder rows when insufficient candidates. Replace with: 'Found X of Y requested companies. No additional matches in current filters.'
  hint: route.ts: buildForcedShortlistAppendix() - change placeholder generation to concise honesty message
  impact: Cleaner output, no visible empty slots, maintains trust
  risk: Low - improves transparency
  validate: UV005, UV007
- [R5] (prompt, effort S) Ban 'типы кандидатов' / category-only responses
  action: Add prompt rule: 'Never respond with only categories/types (e.g., "молочные комбинаты", "региональные мелькомбинаты") when user asks for specific companies. Either provide actual /company/... links OR explain no results + suggest alternative queries.'
  hint: route.ts: buildAssistantSystemPrompt() - add explicit category-only response prohibition
  impact: Eliminates generic 'types' responses that scored 1-2 usefulness
  risk: Low - forces concrete responses or honest no-results
  validate: UV001, UV002, UV011, UV016
- [R6] (geo, effort M) Add geographic relevance scorer before LLM generation
  action: Before showing vendorCandidates to LLM, filter out companies where (a) primary_rubric doesn't match product keyword within 1-hop taxonomy, OR (b) city/region is >100km from requested location. Return only geo+category-aligned results.
  hint: route.ts: vendorCandidates filtering - add candidateMatchesCoreCommodity() check with geographic radius; route to fallback if zero matches
  impact: Prevents 'medical center for beet supplier' level irrelevance
  risk: Medium - may filter valid cross-category matches; needs fallback logic
  validate: UV017, UV004, UV003

