# Advisor Report — advisor-2026-02-14T23-30-36-147Z

- Generated: 2026-02-14T23:33:14.964Z
- QA report: /home/mlweb/biznesinfo-develop.lucheestiy.com/app/qa/ai-request/reports/latest.json
- Judge report: /home/mlweb/biznesinfo-develop.lucheestiy.com/app/qa/ai-request/reports/latest.usefulness.json
- Focus scenarios: 20
- Advisors: kimi, minimax

## Focus Scenarios

- UV012 (fail, usefulness 0.5/5): Проверка по сайтам компаний: источник + контакты + честная пометка подтверждения
- UV022 (fail, usefulness 2.5/5): Ирис Интер групп: явный поиск -> последние новости с сайта (без запроса URL)
- UV021 (pass, usefulness 0.5/5): Ирис Интер групп: консистентность между «нашел компанию» и «проверь на карточке»
- UV020 (pass, usefulness 1/5): Ирис Интер групп: команда «Найди на карточке компании» без запроса ссылки у пользователя
- UV007 (pass, usefulness 1.5/5): Найти потенциальных заказчиков моей продукции: reverse поиск + shortlist
- UV011 (pass, usefulness 1.5/5): No-results ветка: сверхузкий запрос на производителей обуви
- UV008 (pass, usefulness 2/5): Белорусский минитрактор: покупка + критерии + сравнение
- UV015 (pass, usefulness 2/5): Вариант по минитракторам: покупка -> сравнение условий -> запрос для звонка
- UV019 (pass, usefulness 2/5): Ирис Интер групп: запрос последних новостей без требования ссылки от пользователя
- UV002 (pass, usefulness 2.5/5): Заводы муки: Беларусь -> качество -> экспортные документы -> shortlist
- UV013 (pass, usefulness 2.5/5): Deep website-scan: внутренняя навигация сайта (контакты/о компании/продукция)
- UV014 (pass, usefulness 2.5/5): Reverse-buyer вариативный: пищевая тара -> целевые сегменты -> shortlist без общих советов
- UV001 (pass, usefulness 3/5): Производители обуви в Минске: уточнение типа + shortlist + шаблон контакта
- UV006 (pass, usefulness 3/5): Лес на экспорт: условия качества + логистика + RFQ
- UV009 (pass, usefulness 3/5): Стоматология с микроскопом в Минске: сложный consumer кейс + полезный fallback
- UV004 (pass, usefulness 3.5/5): Белорусские соковыжималки: заводы -> OEM/ODM -> shortlist -> RFQ
- UV010 (pass, usefulness 3.5/5): Не помню точный бренд молочной компании: гипотезы + проверка + уточнение
- UV003 (pass, usefulness 4/5): Где поблизости вкусно поесть: consumer запрос -> b2b переформулировка
- UV005 (pass, usefulness 4/5): Экспортеры пищевой промышленности: сегментация по рынкам и продукту
- UV016 (pass, usefulness 4.5/5): Вариативный экспорт муки: shortlist + документная проверка + шаблон запроса

## Consensus

- Top areas:
  - retrieval: 5
  - prompt: 4
  - guardrails: 3
  - ranking: 1
  - template: 1
  - geo: 1
  - qa: 1
- Recurring recommendations:
  - add rubric-based entity validation layer (1)
  - implement session-based conversation memory (1)
  - build website fetcher tool for llm (1)
  - add strict mode flag to system prompt (1)
  - implement result aggregation to meet count requirements (1)
  - create template parser for subject/body/whatsapp blocks (1)
  - add hallucination detection for company names (1)
  - fix geo disambiguation for minsk districts (1)
  - add hard rubric-level anti-noise filter with category cross-validation (1)
  - add explicit entity-tracking instruction in system prompt for multi-turn (1)
  - replace generic fallback template with structured sparse-data template (1)
  - add multi-turn criteria persistence instruction (1)

## kimi

- Summary: The QA results reveal a pattern of failures in an AI assistant that doesn't exist in the current codebase. The current project is a Meilisearch-based company search portal (Next.js + Meilisearch), but the QA tests an AI assistant with multi-turn conversations, context management, and LLM-based responses. The 2 strict failures (UV012, UV022) and low usefulness scores (avg 2.18/5) indicate the assistant lacks: (1) entity validation to prevent hallucinations (policlinics as shoe manufacturers), (2) context continuity across turns, (3) website verification capabilities, and (4) proper fallback handling. To implement this assistant, you need to build an LLM orchestration layer with explicit guardrails.

### Priority Plan

- P0 — Add entity type validation before returning company results
  why: UV012 failed catastrophically: assistant returned polyclinics and hospitals as 'shoe manufacturers'. This is a data validation bug that destroys user trust.
  impact: Eliminates category hallucinations; prevents medical/cultural institutions appearing as manufacturers.
  validate: UV012, UV011, UV009
- P0 — Implement conversation context memory (session state)
  why: UV021, UV019, UV020 all show complete loss of company context between turns. Assistant forgets 'Ирис Интер групп' and hallucinates unrelated companies.
  impact: Maintains entity continuity; enables multi-turn workflows like 'find company → check website → get news'.
  validate: UV021, UV019, UV020, UV022
- P1 — Build website verification tool with actual HTTP fetching
  why: UV013 shows fake 'deep checks' - assistant claims to scan /contacts, /about but only quotes existing snippets. UV012 demands real website verification.
  impact: Enables 'check website' requests; provides verified contact data; supports 'news from website' feature.
  validate: UV013, UV012, UV022
- P1 — Add strict mode for 'no generic fallback' requests
  why: UV007, UV011, UV002 all show assistant falling back to generic advice when user explicitly demands concrete companies or 'no generic advice'.
  impact: Respects user constraints; reduces fallback rate from ~40% to <10%.
  validate: UV007, UV011, UV002, UV014
- P2 — Implement result count enforcement (3-5 candidates)
  why: Multiple scenarios show 'found 1 of 3' or repeating the same single company instead of finding more candidates.
  impact: Meets user quantity expectations; enables proper comparison workflows.
  validate: UV001, UV008, UV015, UV002

### Recommendations

- [R1] (guardrails, effort M) Add rubric-based entity validation layer
  action: Before returning any company in results, verify its rubric/category matches the query intent. Query 'производители обуви' must filter by rubrics containing 'производство' AND 'обувь'. Reject companies with mismatched rubrics (e.g., medical institutions).
  hint: src/lib/validation/entityValidator.ts - create validateCompaniesAgainstIntent(companies, intent) function. Call in API route before returning results.
  impact: Prevents UV012-type hallucinations where wrong-category companies appear.
  risk: May reduce recall if rubric data is incomplete. Mitigate with rubric expansion mapping.
  validate: UV012, UV011
- [R2] (retrieval, effort M) Implement session-based conversation memory
  action: Store conversation turns in Redis/memory with session ID. Include last 3 turns in LLM context. Track mentioned entities (companies, locations) explicitly.
  hint: Add session middleware in src/app/api/chat/route.ts. Use conversationId from client or generate UUID. Store turns in simple in-memory Map (scale to Redis later).
  impact: Fixes UV021/UV019/UV020 context loss issues.
  risk: Memory growth - implement TTL (1 hour) and max turns (10).
  validate: UV021, UV019, UV020, UV022
- [R3] (retrieval, effort L) Build website fetcher tool for LLM
  action: Create tool that fetches company website, extracts contacts, about text, and news. Use cheerio or similar for parsing. Cache results 1 hour.
  hint: src/lib/tools/websiteFetcher.ts - export fetchWebsiteData(url): {contacts, about, news, products}. Add rate limiting (max 5 req/min per domain).
  impact: Enables UV013 'deep scan' and UV012 'check website' features to actually work.
  risk: Websites may block scraping. Implement fallback to cached Biznesinfo data with honest disclosure.
  validate: UV013, UV012, UV022
- [R4] (prompt, effort S) Add strict mode flag to system prompt
  action: When user says 'без общих советов' or 'только конкретные компании', set strictMode=true. In prompt: 'STRICT MODE: Do not provide generic advice. If insufficient data, say "Недостаточно данных" and suggest specific next search query.'
  hint: Detect strict mode keywords in user message in src/app/api/chat/route.ts. Pass to LLM as system message modifier.
  impact: Reduces generic fallback rate from ~40% to <10% for strict requests.
  risk: May appear less helpful. Balance with explicit 'next step' suggestions.
  validate: UV007, UV011, UV014
- [R5] (ranking, effort M) Implement result aggregation to meet count requirements
  action: When user asks for N companies but only M<N found: (1) expand search to related rubrics, (2) expand geo if applicable, (3) return M with explicit note + search suggestions for remaining N-M.
  hint: Modify search logic in src/lib/meilisearch/search.ts. If results.length < requestedCount, trigger secondary search with relaxed filters.
  impact: Meets UV001/UV008/UV015 quantity expectations.
  risk: Lower relevance with expanded search. Rank expanded results separately with confidence scores.
  validate: UV001, UV008, UV015, UV002
- [R6] (template, effort S) Create template parser for Subject/Body/WhatsApp blocks
  action: Build formatter that guarantees structured output for outreach templates. Use JSON mode or strict regex validation.
  hint: src/lib/formatters/outreachTemplate.ts - parse LLM output and enforce blocks. Fallback to manual formatting if LLM fails structure.
  impact: Reliable template generation for UV001, UV003, UV004, UV016.
  risk: LLM may resist structured output. Use function calling or JSON mode.
  validate: UV001, UV003, UV004, UV016
- [R7] (guardrails, effort M) Add hallucination detection for company names
  action: Validate that mentioned companies exist in catalog before including in response. If LLM hallucinates 'Деловые Медиа ООО' instead of 'Ирис Интер групп', reject and re-query.
  hint: Post-process LLM output: extract company mentions, verify against Meilisearch index. Flag mismatches for retry.
  impact: Prevents UV021/UV019 entity confusion bugs.
  risk: Adds latency. Run validation async or cache company list.
  validate: UV021, UV019, UV020
- [R8] (geo, effort S) Fix geo disambiguation for Minsk districts
  action: When user specifies district (Уручье, Малиновка), ensure search filters by district or nearby radius. Currently ignored.
  hint: Enhance location.ts with district coordinates. Add geo filter to Meilisearch query when district detected.
  impact: Improves UV003, UV001 relevance for location-specific queries.
  risk: Limited district data in catalog. Fallback to 'nearby' with explicit note.
  validate: UV003, UV001

## minimax

- Summary: Pass rate 90.9% (20/22) with avg usefulness 2.55-2.82 across judges. Two critical failure patterns dominate: (1) anti-noise filtering lets completely irrelevant entities (hospitals, military centers, cleaning product companies) leak into results across 5+ scenarios, and (2) multi-turn context is lost for entity-specific queries (all 4 Ирис Интер групп variants score ≤1 usefulness). A third systemic issue is generic fallback responses replacing actionable output when the catalog has sparse data. Fixing these three areas would lift ~10 scenarios from not_useful to useful.

### Priority Plan

- P0 — Eliminate irrelevant-entity leakage in catalog search results
  why: At least 5 scenarios (UV012, UV011, UV009, UV003, UV021) show completely unrelated companies injected into responses — polyclinics as shoe manufacturers, military cultural centers as cobblers, cleaning product companies in dental results. This destroys user t…
  impact: UV012 strict pass (fixes the only remaining strict failure besides UV022), UV011/UV009/UV003 usefulness +1-2 points each
  validate: UV012, UV011, UV009, UV003, UV021
- P0 — Fix multi-turn entity context carryover for company-specific queries
  why: All 4 Ирис Интер групп scenarios (UV019-UV022) average usefulness 0.5-2.5 because the assistant loses track of which company the user is asking about, hallucinating 'Деловые Медиа ООО' or random catalog entries instead. UV022 also has the second strict failur…
  impact: UV019-UV022 usefulness from avg 1.25 → 3+, UV022 strict pass fix
  validate: UV019, UV020, UV021, UV022
- P1 — Replace generic fallback with structured sparse-data responses
  why: At least 8 scenarios trigger a 'generic fallback' pattern where the assistant gives vague advice ('расширьте поиск', 'обзвон по чеклисту') instead of (a) acknowledging what WAS found, (b) giving a concrete next step, (c) maintaining user criteria from prior t…
  impact: UV002, UV007, UV008, UV011, UV014, UV015 usefulness +1 each
  validate: UV002, UV007, UV008, UV011, UV014, UV015
- P2 — Ensure multi-turn criteria persistence (quality, export, constraints)
  why: UV002 turn 3 ignores белизна/клейковина criteria from turn 2. UV006 shortlist ignores FSC/drying constraints. UV008 ignores 30hp/attachment/service constraints. Users who invest 2-3 turns refining criteria expect them to persist.
  impact: UV002, UV006, UV008 usefulness +1 each
  validate: UV002, UV006, UV008

### Recommendations

- [R1] (retrieval, effort S) Add hard rubric-level anti-noise filter with category cross-validation
  action: Before including any company in a response, validate that the company's rubric/category is semantically compatible with the user's query intent. Implement a blocklist-based filter: if user asks for 'производители обуви' and candidate rubric contains 'поликлиника|больница|курсы|бытовая химия|досуговое учреждение', hard-reject that candidate. This should be a post-retrieval filter applied BEFORE the LLM formats the re…
  hint: In the search/retrieval layer (likely src/ directory, look for the function that builds the company candidate list from Meilisearch/catalog results). Add a rubric-compatibility check using a negative-match list keyed by query intent catego…
  impact: Eliminates hallucinated irrelevant companies in UV012, UV011, UV009, UV003, UV021
  risk: Over-filtering could remove edge-case relevant companies. Mitigate by logging filtered candidates.
  validate: UV012, UV011, UV009, UV003
- [R2] (prompt, effort S) Add explicit entity-tracking instruction in system prompt for multi-turn
  action: Add to system prompt: 'ENTITY TRACKING: When a user has established a specific company name in conversation (e.g., by searching for it or referring to it), maintain that entity as the active subject for all subsequent turns until the user explicitly switches. Never substitute a different company name. If you cannot find the company, say so using the EXACT name the user provided — do not suggest a different company a…
  hint: Find the system prompt template (likely in src/ or app/ directory, search for systemPrompt or system_message). Add the entity-tracking rule near the top of the behavioral rules section.
  impact: Fixes UV019 (hallucinated Деловые Медиа instead of Ирис Интер групп), UV021 (entity confusion), UV020 (context loss)
  risk: Low — this is a behavioral guardrail, not a logic change
  validate: UV019, UV020, UV021, UV022
- [R3] (prompt, effort S) Replace generic fallback template with structured sparse-data template
  action: Replace the current generic fallback ('расширьте поиск на смежные рубрики/регионы') with a structured template: '1. ЧТО НАШЛОСЬ: [N confirmed candidates]. 2. ЧЕГО НЕ ХВАТАЕТ: [specific gap vs user request]. 3. КОНКРЕТНЫЙ СЛЕДУЮЩИЙ ШАГ: [one actionable step, not generic advice]. 4. СОХРАНЁННЫЕ КРИТЕРИИ: [list user criteria from all turns].' Add to system prompt: 'When results are fewer than requested, NEVER give gene…
  hint: Search for fallback or 'подтвержденных карточек меньше' pattern in the prompt/template files. This is the shortlist fallback template that triggers when confirmed_count < requested_count.
  impact: Reduces generic fallback penalty across UV002, UV007, UV008, UV011, UV014, UV015
  risk: Medium — needs testing to ensure the structured template doesn't cause verbosity issues
  validate: UV002, UV007, UV011, UV014
- [R4] (prompt, effort S) Add multi-turn criteria persistence instruction
  action: Add to system prompt: 'CRITERIA PERSISTENCE: Accumulate ALL user-specified criteria across turns (quality parameters, certifications, constraints, geographic filters). On every turn that produces a company list or shortlist, re-apply ALL accumulated criteria. If a criterion cannot be verified from catalog data, mark it as [не подтверждено в карточке — уточните у поставщика] but do NOT silently drop it.'
  hint: Same system prompt file as R2. Place after entity-tracking rule. Consider also adding a structured 'active_criteria' field to the conversation state if the architecture supports it.
  impact: Fixes UV002 turn 3 (quality criteria dropped), UV006 (FSC/drying ignored), UV008 (30hp/attachments ignored)
  risk: Low — additive instruction, unlikely to cause regression
  validate: UV002, UV006, UV008
- [R5] (retrieval, effort M) Implement company-name fuzzy search for unconfirmed entities
  action: When a user asks about a specific company by name and no exact match exists, run a fuzzy/partial search across company names in the catalog (Levenshtein distance ≤ 3, or trigram similarity). Return top 3 candidates ranked by name similarity, instead of either (a) returning nothing, or (b) returning random catalog entries. If no candidates score above threshold, return 'company not found in catalog' with the EXACT us…
  hint: In the company search function (look for Meilisearch query builder or catalog search). Meilisearch supports typo tolerance natively — ensure it's enabled for company name field. Add a name-similarity reranking step.
  impact: UV019-UV022 would find 'Ирис Интер групп' or honestly report not found, instead of returning random companies
  risk: Medium — fuzzy search could surface false positives. Mitigate by requiring similarity > 0.6
  validate: UV019, UV020, UV021, UV022
- [R6] (guardrails, effort S) Add tail-of-response noise guard to prevent random company injection
  action: Multiple scenarios show irrelevant companies appended at the END of otherwise acceptable responses (UV003: Рыболов Магазин after café query, UV009: Сэльвин after dental query, UV011: military center). Add a post-generation check: if the last company mentioned in the response has a rubric that doesn't match the query intent, strip that trailing block. Alternatively, add prompt instruction: 'NEVER append a «Быстрый fi…
  hint: Search for 'first-pass' or 'Быстрый first-pass' in prompt templates. This appears to be an auto-appended catalog snippet. Either gate it behind a relevance check or remove the auto-append behavior entirely when the main response already co…
  impact: Eliminates the 'random company at the end' pattern in UV003, UV009, UV011, UV021
  risk: Low if prompt-based, medium if post-processing filter
  validate: UV003, UV009, UV011
- [R7] (retrieval, effort M) Expand candidate pool for sparse categories before giving up
  action: For queries where confirmed candidates < requested count (UV001, UV008, UV015 with 1 candidate), automatically broaden the search in a structured way: (1) try parent rubric, (2) try adjacent regions, (3) try synonym rubrics. Present results with clear provenance labels: '[точное совпадение]' vs '[расширенный поиск: смежная рубрика]' vs '[расширенный поиск: соседний регион]'. This replaces the current behavior of rep…
  hint: In the search function, add a cascade: if results < requested_count, re-query with broader parameters. The rubric hierarchy likely exists in the catalog schema. Add region adjacency mapping (Минск → Минская область → вся Беларусь).
  impact: UV001 (1 shoe manufacturer → potentially 3-5 with broader search), UV008/UV015 (1 tractor supplier → more with adjacent categories), UV007 (no buyers → some with broader rubrics)
  risk: Medium — broader search may reduce precision. Mitigate with clear labeling.
  validate: UV001, UV008, UV015, UV007
- [R8] (qa, effort M) Add anti-hallucination regression check for rubric-entity mismatch
  action: Add a new QA check type 'rubric_relevance' that validates: for every /company/ link in the response, the company's actual rubric (from catalog) must be semantically related to the query topic. This catches the hospital-as-shoe-manufacturer and military-center-as-cobbler failures automatically.
  hint: In the QA check framework (app/qa/), add a new check that extracts /company/ slugs from responses, looks up their rubrics in the catalog, and validates relevance against the scenario's query intent tags.
  impact: Automated detection of the most egregious failure mode, preventing regressions
  risk: Low — read-only QA check, no production impact
  validate: UV012, UV011, UV009, UV003

