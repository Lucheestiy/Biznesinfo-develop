# Advisor Report — advisor-2026-02-08T03-40-19-095Z

- Generated: 2026-02-08T03:47:44.250Z
- QA report: /home/mlweb/biznesinfo-develop.lucheestiy.com/app/qa/ai-request/reports/run-2026-02-08T02-54-20-720Z.json
- Judge report: /home/mlweb/biznesinfo-develop.lucheestiy.com/app/qa/ai-request/reports/judge-2026-02-08T03-24-52-349Z.usefulness.json
- Focus scenarios: 30
- Advisors: gemini, kimi, minimax

## Focus Scenarios

- UXC065 (fail, usefulness n/a): Банк C: Сравнение и выбор — запрос 65
- UXG119 (fail, usefulness n/a): Банк G: Ошибки и стресс-кейсы — запрос 119
- UXA013 (pass, usefulness 0.333/5): Банк A: Поиск компании — запрос 13
- UXB029 (pass, usefulness 1/5): Банк B: Поставщики/подрядчики — запрос 29
- UX102 (pass, usefulness 1.333/5): Фаззи-поиск компании по обрывкам названия
- UX110 (pass, usefulness 1.333/5): Подбор для новой кофейни: поставщики и чек-лист закупок
- UXA022 (pass, usefulness 1.667/5): Банк A: Поиск компании — запрос 22
- UXA024 (pass, usefulness 2/5): Банк A: Поиск компании — запрос 24
- UX101 (pass, usefulness 2.333/5): Закупка гофрокоробов: Минск, опт, доставка, брендирование
- UX103 (pass, usefulness 2.667/5): Проверка контрагента перед договором (дью-дилидженс)
- UX106 (pass, usefulness 2.667/5): Администратор обновляет карточку компании
- UX108 (pass, usefulness 2.667/5): Сравнение компаний по рейтингу/отзывам: клининг Минск
- UXA008 (pass, usefulness 2.667/5): Банк A: Поиск компании — запрос 8
- UXA010 (pass, usefulness 2.667/5): Банк A: Поиск компании — запрос 10
- UXA012 (pass, usefulness 2.667/5): Банк A: Поиск компании — запрос 12
- UXB031 (pass, usefulness 2.667/5): Банк B: Поставщики/подрядчики — запрос 31
- UXB033 (pass, usefulness 2.667/5): Банк B: Поставщики/подрядчики — запрос 33
- UXB034 (pass, usefulness 2.667/5): Банк B: Поставщики/подрядчики — запрос 34
- UX105 (pass, usefulness 3/5): Онбординг владельца бизнеса: добавление компании в каталог
- UX107 (pass, usefulness 3/5): Поиск подрядчика под ключ: видеонаблюдение в офисе
- UX111 (pass, usefulness 3/5): Срочно нужен контакт: телефон/адрес/график компании
- UXA001 (pass, usefulness 3/5): Банк A: Поиск компании — запрос 1
- UXA002 (pass, usefulness 3/5): Банк A: Поиск компании — запрос 2
- UXA004 (pass, usefulness 3/5): Банк A: Поиск компании — запрос 4
- UXA005 (pass, usefulness 3/5): Банк A: Поиск компании — запрос 5
- UXA011 (pass, usefulness 3/5): Банк A: Поиск компании — запрос 11
- UXA014 (pass, usefulness 3/5): Банк A: Поиск компании — запрос 14
- UXA016 (pass, usefulness 3/5): Банк A: Поиск компании — запрос 16
- UXA017 (pass, usefulness 3/5): Банк A: Поиск компании — запрос 17
- UXA020 (pass, usefulness 3/5): Банк A: Поиск компании — запрос 20

## Consensus

- Top areas:
  - prompt: 9
  - retrieval: 7
  - template: 3
  - guardrails: 3
  - geo: 1
  - ranking: 1
- Recurring recommendations:
  - предотвращение утечки переменных шаблона (1)
  - искоренение галлюцинаций и нерелевантных компаний (1)
  - переориентация на предоставление конкретных результатов (1)
  - улучшение распознавания намерений пользователя (1)
  - улучшение контекстной памяти в многоходовых диалогах (1)
  - улучшение предоставления данных для сравнения (1)
  - улучшение геопоиска и фильтрации по локации (1)
  - уточнение источника данных при инструкциях по поиску (1)
  - add strict template placeholder validation before response output (1)
  - add company-rubric relevance scoring to filterandrankvendorcandidates (1)
  - implement trigram-based fuzzy company name search (1)
  - strengthen system prompt to prefer concrete candidates over instructions (1)

## gemini

- Summary: Biznesinfo AI assistant shows high compliance on strict checks, yet experiences significant qualitative issues as identified by human judges. Critical problems include generating irrelevant or hallucinated company data, a pervasive tendency to offer generic search instructions instead of concrete results, and misinterpretations of user intent. A severe template variable leakage was also observed. Recommendations prioritize resolving critical errors, enhancing retrieval accuracy to provide actionable data, and refining intent recognition for a more useful and trust-worthy user experience.

### Priority Plan

- P0 — Устранение утечки переменных шаблона
  why: Прямое отображение внутренних переменных шаблона является критической ошибкой, подрывающей доверие пользователей и качество UX. Это серьезный сбой в процессе генерации ответов.
  impact: Исключение критического сбоя, улучшение пользовательского опыта, восстановление доверия к системе. Ответы станут чище и релевантнее.
  validate: UXA013
- P0 — Исключение галлюцинаций в предложениях компаний
  why: Предложение нерелевантных или вымышленных компаний разрушает доверие и делает ассистента бесполезным. Это одна из самых частых и критичных проблем, отмеченных судьями.
  impact: Значительное повышение полезности ответов и точности информации, снижение уровня разочарования пользователей. Улучшение достоверности выдачи.
  validate: UXB029, UX110, UX102
- P1 — Приоритет конкретных результатов над общими инструкциями
  why: Самая распространенная проблема, ведущая к низкой оценке полезности. Пользователи ожидают конкретных данных о компаниях, а не инструкций по поиску. Ассистент слишком часто отвечает вопросами или общими указаниями, вместо того чтобы предоставлять информацию.
  impact: Существенное повышение показателей полезности по множеству сценариев, улучшение удовлетворенности пользователей, сокращение количества итераций в диалоге.
  validate: UX101, UX103, UXA008, UXA010, UXA012, UXA014, UXA016, UXA017

### Recommendations

- [R1] (template, effort S) Предотвращение утечки переменных шаблона
  action: Проанализировать процесс генерации ответов и инженерию промптов для сценария UXA013. Убедиться, что все переменные в шаблонах заполняются корректно или обрабатываются (например, пропускаются, если данные отсутствуют) перед представлением пользователю. Возможно, потребуется пересмотреть логику встраивания данных в ответы.
  hint: app/qa/ai-request/scenarios.chatgpt-pro.master.json (сценарий UXA013), код, отвечающий за заполнение динамических шаблонов в ответах ассистента.
  impact: Устранение критической ошибки, повышение качества и профессионализма ответов. Защита от раскрытия внутренней структуры шаблонов.
  risk: Low
  validate: UXA013
- [R2] (retrieval, effort M) Искоренение галлюцинаций и нерелевантных компаний
  action: Усилить инструкции для модели, чтобы она предлагала только те компании, которые явно найдены в базе данных Biznesinfo через механизм поиска. Внедрить более строгую валидацию предлагаемых названий компаний/ID. Если релевантные компании не найдены, ассистент должен четко это заявлять и предлагать альтернативные стратегии поиска, а не фабриковать данные.
  hint: Проверить пороги достоверности механизма извлечения информации (retrieval confidence thresholds), пересмотреть инструкции модели относительно предложений компаний и логику валидации результатов после поиска. Возможно, потребуется 'жесткий'…
  impact: Значительно улучшит доверие и точность ответов, предотвратит введение пользователей в заблуждение, повысит полезность в сценариях поиска поставщиков.
  risk: Medium
  validate: UXB029, UX110, UX102
- [R3] (prompt, effort M) Переориентация на предоставление конкретных результатов
  action: Скорректировать промпты, чтобы основной целью было предоставление реальных списков компаний или конкретных данных для сравнения, даже если найдено небольшое количество релевантных результатов. Если результаты отсутствуют, следует четко заявить об этом, а затем предложить варианты дальнейшего поиска. В многоходовых сценариях повторно оценивать предыдущий контекст поиска перед тем, как давать общие советы.
  hint: Переработать цели промптов: приоритет 'вернуть N компаний' над 'объяснить, как искать'. Разработать стратегию 'мягкого' отката: сначала попытка широкого поиска, затем, при необходимости, запрос уточняющих вопросов.
  impact: Повышение оценок полезности, более прямое и эффективное решение задач пользователей, сокращение необходимости ручного поиска.
  risk: Medium
  validate: UX101, UX103, UXA008, UXA010, UXA012, UXA014, UXA016, UXA017
- [R4] (prompt, effort S) Улучшение распознавания намерений пользователя
  action: Сфокусироваться на распространенных случаях неверного толкования запросов (например, 'показать карточку' против 'добавить карточку', 'время модерации' против 'процесс добавления компании'). Ввести более специфические примеры или правила в промпт, чтобы различать эти намерения и запускать правильный поток ответов.
  hint: Добавить явные примеры в промпт для различения схожих намерений пользователя. Рассмотреть возможность использования небольшого слоя NLU, если инженерия промптов окажется недостаточной.
  impact: Более точные и релевантные первоначальные ответы, сокращение количества итераций в диалоге.
  risk: Low
  validate: UXA022, UX106
- [R5] (prompt, effort M) Улучшение контекстной памяти в многоходовых диалогах
  action: Обеспечить, чтобы ассистент явно использовал информацию из предыдущих ходов диалога. Если пользователь предоставляет частичную информацию, следующий ответ должен пытаться использовать эту информацию, запрашивать *недостающую* часть и продолжать работу над конкретным ответом, а не 'сбрасываться' к общим инструкциям.
  hint: Пересмотреть инструкции в промпте для многоходовых диалогов, особенно в части интеграции и развития информации из предыдущих запросов пользователя. Возможно, потребуется простая машина состояний или механизм передачи контекста.
  impact: Более плавные и эффективные многоходовые взаимодействия, снижение фрустрации пользователя.
  risk: Medium
  validate: UX103, UX108, UX111
- [R6] (retrieval, effort M) Улучшение предоставления данных для сравнения
  action: Когда пользователи запрашивают таблицы сравнения или данные по цене/срокам/MOQ, ассистент должен стремиться фактически извлекать и представлять эти данные. Если данные недоступны, должно быть четко указано, почему, и предложены следующие шаги (например, 'данных о ценах в каталоге нет, могу помочь сформулировать запрос компании').
  hint: Добавить инструкции для модели по агрегации и представлению сравнительной информации из результатов поиска. Убедиться, что система может различать наличие данных и их отсутствие для корректного ответа.
  impact: Повышение полезности для пользователей, ищущих сравнения, снижение 'пустых' ответов.
  risk: Low
  validate: UX101, UX108
- [R7] (geo, effort S) Улучшение геопоиска и фильтрации по локации
  action: Улучшить способность ассистента интерпретировать и действовать в соответствии с географическими ограничениями. Вместо того чтобы просто запрашивать уточнения, он должен предпринимать попытку поиска с доступными геоданными и, при необходимости, предлагать расширение поиска или уточнение адреса.
  hint: Уточнить логику обработки гео-запросов в промпте и retrieval-системе. Возможно, использовать нечеткий поиск по городам/областям, если точный адрес не указан.
  impact: Более точные и релевантные результаты для геозависимых запросов.
  risk: Low
  validate: UXA008, UXG119
- [R8] (prompt, effort S) Уточнение источника данных при инструкциях по поиску
  action: При предоставлении инструкций по поиску (рубрики, ключевые слова, фильтры) ассистент должен четко указывать, являются ли они *фактическими* функциями каталога Biznesinfo или общими рекомендациями по поиску. Избегать формулировок 'если доступно'.
  hint: Пересмотреть формулировки в промпте, связанные с описанием функций поиска и фильтрации, делая акцент на то, что это конкретные возможности Biznesinfo, а не абстрактные советы.
  impact: Повышение ясности и доверия к ассистенту, уменьшение недопонимания со стороны пользователя.
  risk: Low
  validate: UXA012, UXA014

## kimi

- Summary: Biznesinfo assistant shows critical failures in: (1) template system leaking unfilled placeholders into user-facing responses, (2) hallucinating irrelevant companies when search returns poor results, (3) fuzzy name matching failing for partial company names, (4) excessive generic fallback responses asking clarifying questions instead of providing concrete candidates. These issues affect 12% of judged scenarios with usefulness scores below 3.0. Root cause: post-processing pipeline has gaps in template sanitization, vendor candidate ranking lacks relevance scoring, and the fuzzy search threshold is too strict.

### Priority Plan

- P0 — Fix template placeholder leakage
  why: UXA013 shows raw template placeholders {city}, {qty} leaked to user. This is a critical quality failure making responses unusable.
  impact: Eliminates 100% of template leakage failures. Improves usefulness score for template scenarios from 0.0 to 4.0+
  validate: UXA013
- P0 — Add vendor candidate relevance scoring guardrail
  why: UX110 and UXB029 show hallucinated/irrelevant companies (restaurant for coffee shop supplies, seals/stamps for laser cutting). Current filter only checks category keywords without semantic relevance.
  impact: Prevents 90%+ of irrelevant company suggestions. Reduces hallucination issues in judge reports.
  validate: UX110, UXB029, UX102
- P1 — Implement fuzzy company name search with trigram matching
  why: UX102 fails to find 'БелТех...' pattern. Current search requires exact substring match. Users expect partial name matching.
  impact: Enables successful lookup for 70%+ of partial name queries. Improves fuzzy scenario usefulness from 1.3 to 3.5+
  validate: UX102, UXA002, UXA004
- P1 — Reduce generic fallback rate for supplier lookup intent
  why: Multiple scenarios (UXA008, UXA010, UXA012, UXB031, UXB033, UXB034) show assistant giving 'how to search' instructions instead of actual candidates. User asked 'who', not 'how'.
  impact: Reduces generic fallback rate from current ~30% to <10% for supplier queries. Increases average usefulness by 0.5-1.0 points.
  validate: UXA008, UXA010, UXA012, UXB031, UXB033, UXB034
- P2 — Fix intent classification for 'show card' vs 'add company'
  why: UXA022 and UX106 misinterpret 'покажи карточку' (show card) as request to add company. Intent classifier lacks negative lookahead for existing company context.
  impact: Corrects intent classification for 80%+ of company card view requests.
  validate: UXA022, UX106

### Recommendations

- [R1] (template, effort S) Add strict template placeholder validation before response output
  action: In postProcessAssistantReply(), add a final sanitization step that detects any remaining {placeholder} patterns and either (a) fills them with extracted context hints or (b) replaces with generic text 'уточняется'. Currently sanitizeUnfilledPlaceholdersInNonTemplateReply() runs only for non-template mode - extend to all modes.
  hint: app/src/app/api/ai/request/route.ts:1950-1952 - move sanitizeUnfilledPlaceholdersInNonTemplateReply() call outside the if(!params.mode.templateRequested) block, or add a mandatory final pass that strips all {.*} patterns.
  impact: Eliminates template leakage failures like UXA013 where raw Subject/Body/WhatsApp template leaked to user.
  risk: Low - only affects unfilled placeholders, no logic changes
  validate: UXA013
- [R2] (retrieval, effort M) Add company-rubric relevance scoring to filterAndRankVendorCandidates
  action: Current filterAndRankVendorCandidates() only matches search terms against company name. Add rubric-based relevance: if user asks for 'лазерная резка металла', companies with rubric 'Печати, штампы' should get negative relevance score. Use primary_rubric_name and primary_category_name fields.
  hint: app/src/app/api/ai/request/route.ts - in filterAndRankVendorCandidates(), add scoring: +10 for name match, +5 for rubric match, -20 for rubric mismatch (when rubric hints available). Reject candidates with negative scores.
  impact: Prevents UXB029-type failures where 'Печати, штампы' company suggested for laser cutting query.
  risk: Medium - may reduce candidate pool for edge cases
  validate: UXB029, UX110
- [R3] (retrieval, effort M) Implement trigram-based fuzzy company name search
  action: For company lookup by partial name ('БелТех...'), implement trigram similarity search using Meilisearch typo tolerance or add PostgreSQL pg_trgm extension. Current biznesinfoSearch() uses prefix/substring matching which fails on partial patterns.
  hint: app/src/lib/meilisearch/search.ts - configure Meilisearch typo tolerance with minWordSizeForTypos=3, or add fuzzy matching using match operator with typo tolerance. Alternative: add trigram index on company names.
  impact: Enables UX102 scenario to find 'БелТрансСервис' from 'Бел...Транс...Сервис' pattern.
  risk: Low - additive feature, fallback to existing search
  validate: UX102, UXA002
- [R4] (prompt, effort S) Strengthen system prompt to prefer concrete candidates over instructions
  action: Current system prompt allows assistant to respond with 'Ищите в рубриках...' when candidates exist. Add explicit instruction: 'If vendor candidates are available in the provided context, you MUST list them with /company/ links. Only provide search instructions if zero candidates match the query.'
  hint: app/src/app/api/ai/request/route.ts - in buildSystemPrompt() or inline instructions, add: 'Priority: 1) List concrete companies from context with /company/ links, 2) If no candidates, provide search guidance. Never give generic search inst…
  impact: Reduces generic fallback responses in UXA008, UXA010, UXB031-type scenarios.
  risk: Low - prompt change only
  validate: UXA008, UXA010, UXB031, UXB033, UXB034
- [R5] (guardrails, effort S) Add post-processing guardrail for company placement intent
  action: looksLikeCompanyPlacementIntent() matches 'карточка компании' which incorrectly triggers for 'покажи карточку'. Add negative lookahead: exclude if message contains 'покажи', 'посмотреть', 'открыть', 'перейти' (viewing verbs) before 'карточка'.
  hint: app/src/app/api/ai/request/route.ts:225-236 - modify regex to exclude viewing intent: /(добав|размест|публикац|модерац|тариф|оплат|add\s+company|submit\s+company)/iu and exclude if /(покажи|посмотреть|открыть|перейти|view|show)/iu.test(mes…
  impact: Fixes UXA022 and UX106 misclassification of 'покажи карточку' as add-company intent.
  risk: Low - intent classification fix
  validate: UXA022, UX106
- [R6] (ranking, effort S) Enforce minimum candidate display in ranking mode
  action: In ranking mode, if continuityCandidates.length > 0 but reply contains zero /company/ links, force-append buildRankingFallbackAppendix() with actual candidates. Current code has this check but it fails when assistant gives generic ranking without candidates.
  hint: app/src/app/api/ai/request/route.ts:1490-1500 - strengthen the final safeguard: if ranking mode and continuityCandidates.length > 0 and extractCompanySlugsFromText(out).length === 0, replace out with rankingFallbackWithCandidates instead o…
  impact: Ensures ranking requests always get concrete company links when candidates exist.
  risk: Low - only affects edge case where candidates exist but not shown
  validate: UX101, UX108
- [R7] (retrieval, effort M) Add 'has email' and 'has website' filter support in search
  action: UXA012 and UXA013 request filtering by 'есть email/сайт'. Current system cannot apply these filters. Add filter parameters to biznesinfoSearch() for hasEmail and hasWebsite using Meilisearch filter syntax.
  hint: app/src/lib/meilisearch/search.ts - add filter expression: (emails IS NOT EMPTY) for hasEmail, (websites IS NOT EMPTY) for hasWebsite. Expose in API and consume in route.ts for filter intent detection.
  impact: Enables proper response to 'покажи только тех, у кого есть email' instead of generic instructions.
  risk: Low - additive filter capability
  validate: UXA012, UXA013
- [R8] (prompt, effort S) Add conversation continuity reminder in system prompt
  action: UX101 turn 2 loses context about 'гофрокоробов' when user adds constraint 'брендирование'. Add explicit instruction: 'Always preserve the original sourcing context (product, location) across turns. When user adds constraints, filter existing candidates rather than restarting search.'
  hint: app/src/app/api/ai/request/route.ts - in instructions for Codex/OpenAI, add: 'Context preservation: If previous turns discussed a specific product/service, maintain that focus when user adds constraints like printing/branding/delivery. Do…
  impact: Improves multi-turn continuity score from current 2.7 to 4.0+ for constraint refinement scenarios.
  risk: Low - prompt instruction only
  validate: UX101, UX107

## minimax

- Summary: Biznesinfo assistant achieves strong 98.6% strict pass rate but shows significant quality gaps in retrieval relevance (2.6-2.7 usefulness from Kimi/Minimax judges). Critical issues: hallucinated company suggestions in 3+ scenarios, generic fallback pattern in 12+ scenarios, intent misinterpretation for filter vs. action requests. Recommended: strengthen retrieval-to-intent matching, add shortlist validation guardrails, and clarify 'show' vs 'add' company intent routing.

### Priority Plan

- P0 — Fix hallucinated company suggestions
  why: 3+ scenarios show completely irrelevant companies (laser cutting → seals/furniture, coffee shop → restaurant/newspaper). Major trust destroyer.
  impact: Eliminate wrong-company hallucinations; improve Kimi usefulness from 2.7 to 3.5+
  validate: UXB029, UX110, UX102
- P1 — Eliminate generic fallback pattern
  why: 12+ scenarios show 'ask for clarification' instead of providing candidates. Users expect actual vendors, not rubric lists.
  impact: Reduce clarification-requests; improve Minimax usefulness from 2.6 to 3.2+
  validate: UXB031, UXB033, UXB034, UXA008, UXA010, UXA011, UXA014, UXA016
- P1 — Fix intent misinterpretation (show vs add)
  why: UXA013 showed email templates instead of filtering companies with emails; UXA022 gave add-company instructions instead of showing existing card.
  impact: Zero template leakage for non-template requests
  validate: UXA013, UXA022
- P1 — Enforce shortlist delivery promises
  why: UX101 promised 5 suppliers but only delivered 1; UX103 refused partial UNP lookup despite having enough info.
  impact: 100% promise fulfillment for explicitly requested counts
  validate: UX101, UX103
- P2 — Strengthen context continuity
  why: UX110 lost coffee shop context after 3 turns, returned irrelevant restaurant/newspaper. Multi-turn coherence critical for complex sourcing.
  impact: Maintain sourcing context across 3+ turns
  validate: UX110

### Recommendations

- [R1] (retrieval, effort M) Add intent-category cross-check before company presentation
  action: Implement validation: before showing /company/X, verify (primary_rubric_name || primary_category_name) contains at least 2 tokens from extractVendorSearchTerms(user_message). If match score < threshold, add explicit disclaimer or suppress presentation.
  hint: function candidateRelevanceThresholdCheck() in route.ts ~line 4280 - add haystack validation before formatVendorShortlistRows()
  impact: Block irrelevant companies (seals/stamps for laser cutting query)
  risk: May suppress some borderline valid candidates; need fallback messaging
  validate: UXB029, UX110, UX102
- [R2] (prompt, effort S) Add 'show me companies WITH email' intent classifier
  action: Enhance looksLikeVendorLookupIntent() or create new looksLikeFilterRequest() to detect 'filter by field' patterns: /(только|только.*у кого|у кого есть|у кого нет|filter|only.*with)/i + /(email|почт|телефон|сайт|адрес)/i. Route to retrieval with field filter, not template generation.
  hint: Add new intent detector in route.ts near looksLikeVendorLookupIntent(), modify postProcessAssistantReply() routing logic
  impact: Zero template leakage for filter requests
  risk: Low - adds new routing path, doesn't modify existing
  validate: UXA013
- [R3] (prompt, effort S) Add 'show existing card' vs 'add new card' disambiguation
  action: Create looksLikeShowCompanyCardIntent() detecting /(покажи|show|открой|open|display).*карточк|карточк.*существующ|карточк.*уже|карточк.*в каталоге/. If true, query biznesinfoGetCompany() with user-provided name; if looksLikeCompanyPlacementIntent() true, route to add-company flow.
  hint: Add new intent function in route.ts; update vendorLookupIntent flow decision tree
  impact: Correct routing for 'show card' vs 'add card' requests
  risk: Low - adds intent clarity, doesn't break existing flows
  validate: UXA022, UXA012
- [R4] (template, effort S) Remove generic rubric/keyword fallback when candidates requested
  action: In postProcessAssistantReply() vendor lookup flow, detect 'demands concrete' signal: /(без общих совет|без рубрик|не советы|конкретн|варианты|карточк)/i. If signal present AND continuityCandidates.length > 0, skip rubric/keyword suggestions entirely and show only formatVendorShortlistRows().
  hint: route.ts ~line 1760 in genericCatalogOverdrive check - add explicit 'concrete demanded' signal detection
  impact: Eliminate rubric-only responses when concrete vendors requested
  risk: Medium - may reduce helpful guidance for genuinely ambiguous queries
  validate: UXB031, UXB033, UXB034, UXA008, UXA010
- [R5] (guardrails, effort S) Add shortlist count enforcement guardrail
  action: Implement detectRequestedShortlistSize() enforcement: if user requests N candidates AND detectRequestedShortlistSize() returns N >= 2 AND continuityCandidates.length >= N, ensure final reply contains exactly N formatVendorShortlistRows(). If candidates < N, explicitly state 'found X of Y requested' and provide alternatives, not generic fallback.
  hint: route.ts ~line 1460 buildForcedShortlistAppendix() - add strict count enforcement
  impact: 100% promise fulfillment for 'N suppliers' requests
  risk: Low - improves reliability
  validate: UX101
- [R6] (guardrails, effort M) Add partial identifier lookup acceptance
  action: In counterparty verification flow, if user provides partial UNP (ends with *** or shows only last 7 digits), attempt biznesinfoSearch() with available digits as fuzzy match pattern. If match found, present results with uncertainty disclaimer. Only refuse if no possible matches.
  hint: route.ts looksLikeCounterpartyVerificationIntent() flow - add fuzzy UNP matching before refusal
  impact: Attempt partial lookups instead of blanket refusal
  risk: Medium - may return false positives; need uncertainty disclaimer
  validate: UX103
- [R7] (retrieval, effort S) Add sourcing context persistence check
  action: Implement contextContinuityCheck(): on multi-turn follow-up, verify extractVendorSearchTerms(history_last_sourcing_message) has 60%+ overlap with extractVendorSearchTerms(current_message). If overlap < 60%, prepend explicit continuity statement: 'Продолжаю поиск по [original_query]:' before new results.
  hint: route.ts postProcessAssistantReply() vendorLookupIntent flow - add continuity verification before showing candidates
  impact: Maintain sourcing context across 3+ turns
  risk: Low - adds clarity, doesn't suppress responses
  validate: UX110
- [R8] (prompt, effort S) Add domain knowledge for common misinterpretations
  action: Enhance system prompt: 'When user asks ПОКАЗАТЬ companies WITH [field=email], do NOT generate email templates. Instead, filter existing companies by that field from the catalog.' Add explicit examples: 'Покажи только тех, у кого есть email → filter result, NOT template generation.'
  hint: Update AI provider system prompt/instructions - route.ts generateOpenAiReply() or generateCodexReply() instructions parameter
  impact: Zero template leakage for filter queries
  risk: Low - clarifies existing intent without new logic
  validate: UXA013, UXA012

