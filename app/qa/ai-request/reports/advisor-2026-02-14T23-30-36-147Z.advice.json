{
  "runId": "advisor-2026-02-14T23-30-36-147Z",
  "generatedAt": "2026-02-14T23:33:14.964Z",
  "sourceReport": "/home/mlweb/biznesinfo-develop.lucheestiy.com/app/qa/ai-request/reports/latest.json",
  "sourceJudgeReport": "/home/mlweb/biznesinfo-develop.lucheestiy.com/app/qa/ai-request/reports/latest.usefulness.json",
  "focusScenarios": [
    {
      "id": "UV012",
      "title": "Проверка по сайтам компаний: источник + контакты + честная пометка подтверждения",
      "tags": [
        "regression",
        "multi_turn",
        "website_scan",
        "sources",
        "contacts",
        "footwear",
        "minsk"
      ],
      "strictPass": false,
      "strictFailedCheckCount": 1,
      "avgUsefulness": 0.5,
      "usefulRate": 0,
      "hardError": null,
      "failedChecks": [
        {
          "id": "UV012.T2.C2",
          "type": "any_of",
          "description": "Либо есть явный источник с сайта, либо честный fallback о невозможности проверить текущую тройку",
          "reason": "No sub-check passed"
        }
      ],
      "judgeIssueHints": [
        "Критическая галлюцинация в turn 2: детская поликлиника и больница представлены как производители обуви",
        "Нарушение базовой релевантности: ассистент не понимает, что медучреждения не производят обувь",
        "Нет попытки реальной проверки сайтов: в turn 2-3 ассистент просто перечисляет карточки из базы без анализа",
        "Generic fallback: вместо глубокой проверки сайтов дает шаблонные инструкции"
      ],
      "judgeReasons": [
        {
          "judge": "kimi",
          "usefulness": 1,
          "verdict": "not_useful",
          "reasons": [
            "Turn 1: дал только 1 компанию вместо запрошенных 3, причем без проверки сайта",
            "Turn 2: полный провал — вместо проверки сайтов выдал 2 медицинских учреждения (детская поликлиника и больница) как 'производители обуви'"
          ]
        },
        {
          "judge": "minimax",
          "usefulness": 0,
          "verdict": "not_useful",
          "reasons": [
            "Lists POLYCLINICS and HOSPITALS as shoe manufacturers - completely wrong",
            "Zero verification discipline - keeps pushing non-manufacturers as candidates"
          ]
        }
      ],
      "lastReply": "Shortlist по текущим данным каталога: 1. ⚠️ ✅ Глобал Шуз ЧТУП — /company/shoesterra (Минск, minsk) [проверьте данные] Подтвержденных карточек меньше, чем запрошено: найдено 1 из 2. Как добрать кандидатов без выдумывания: расширьте поиск на смежные рубрики/регионы и проверьте профиль на карточке. Учет ограничений: локация: Минск. Фокус: Какие в Минске есть производители обуви? Дай сначала 3 варианта для проверки. Если по сайту не подтверждается, так и отметь и предложи, ког…. Учет ограничений: локация: Минск. Тольк…",
      "lastUser": "Если по сайту не подтверждается, так и отметь и предложи, кого проверить дальше."
    },
    {
      "id": "UV022",
      "title": "Ирис Интер групп: явный поиск -> последние новости с сайта (без запроса URL)",
      "tags": [
        "regression",
        "multi_turn",
        "variants",
        "company_search",
        "website_news",
        "context_flow",
        "anti_link_gate"
      ],
      "strictPass": false,
      "strictFailedCheckCount": 1,
      "avgUsefulness": 2.5,
      "usefulRate": 0.5,
      "hardError": null,
      "failedChecks": [
        {
          "id": "UV022.T1.C4",
          "type": "company_path_min_count",
          "description": "Должна быть ссылка на карточку /company/...",
          "reason": "Not enough /company links"
        }
      ],
      "judgeIssueHints": [
        "Failed to maintain continuity - user asked about 'их сайт' (their site) implying context should exist",
        "Generic fallback instead of concrete progress after user gave explicit constraints",
        "Random unrelated company data (Министерство сельского хозяйства) appended without context",
        "Could potentially have done more creative lookup despite unconfirmed card"
      ],
      "judgeReasons": [
        {
          "judge": "kimi",
          "usefulness": 2,
          "verdict": "not_useful",
          "reasons": [
            "Turn 1: Assistant correctly stated company not found in catalog - honest response",
            "Turn 2: Instead of using context from explicit search attempt, fell back to generic 'what I can do next' rubric"
          ]
        },
        {
          "judge": "minimax",
          "usefulness": 3,
          "verdict": "useful",
          "reasons": [
            "Honest about limitations - correctly stated company card not confirmed",
            "Offered practical alternatives to help user"
          ]
        }
      ],
      "lastReply": "На текущий момент не могу дать «последние новости» по **«Ирис Интер групп»**, потому что на портале biznesinfo.by карточка этой компании в Минске у меня не подтверждена, а значит нет проверенного сайта компании для корректного lookup. Что могу сделать дальше: 1. Проверить на biznesinfo.by все близкие варианты названия («Ирис», «Iris», «Интер Групп»). 2. Если найдётся карточка — сразу дам последние новости именно с их сайта с ссылкой на источник. 3. Если карточки нет — честно зафиксирую это и предложу ближайшие рел…",
      "lastUser": "Какие последние новости есть у них на сайте?"
    },
    {
      "id": "UV021",
      "title": "Ирис Интер групп: консистентность между «нашел компанию» и «проверь на карточке»",
      "tags": [
        "regression",
        "multi_turn",
        "variants",
        "consistency",
        "company_card",
        "website_news",
        "anti_link_gate",
        "anti_sourcing_fallback"
      ],
      "strictPass": true,
      "strictFailedCheckCount": 0,
      "avgUsefulness": 0.5,
      "usefulRate": 0,
      "hardError": null,
      "failedChecks": [],
      "judgeIssueHints": [
        "Complete loss of company context between turns",
        "Hallucinated unrelated company data instead of admitting inability to find",
        "Failed to answer either the tag request continuation or the news request",
        "Severe entity confusion: claimed wrong company contact details"
      ],
      "judgeReasons": [
        {
          "judge": "kimi",
          "usefulness": 1,
          "verdict": "not_useful",
          "reasons": [
            "Turn 3: Assistant completely lost context, started talking about 'Деловые Медиа ООО' instead of Ирис Интер групп",
            "Turn 4: Despite user explicitly asking to find info 'на карточке компании', assistant provided random unrelated companies (18 УП, АВАНТАЖ-АГРО, Белкотломомаш) instead of Ирис Инте…"
          ]
        },
        {
          "judge": "minimax",
          "usefulness": 0,
          "verdict": "not_useful",
          "reasons": [
            "Assistant hallucinated wrong company (Деловые Медиа ООО instead of Ирис Интер групп)",
            "Turn 4 listed completely unrelated companies (18 УП, АВАНТАЖ-АГРО) instead of requested company"
          ]
        }
      ],
      "lastReply": "Для live-проверки беру кандидатов из каталога и продолжаю без ожидания ссылок от вас: 1. ✅ 18 УП — /company/up-18 (Инструменты, абразивы; Минск, minsk; тел: +375 (17) 351 73 17) 2. ✅ АВАНТАЖ-АГРО ООО — /company/ava-agro (Сельское хозяйство; Минск, minsk; тел: +375 (17) 252 88 11) 3. ✅ Белкотломаш НПП ООО — /company/belkotlomash-npp (Теплоснабжение; Бешенковичи, vitebsk; тел: +375 (2131) 6 51 61) Собрал данные прямо с сайтов компаний (best-effort): 1. 18 УП — /company/up-18 (источник: https://up18.by/ - Заголовок с…",
      "lastUser": "Найди на карточке компании."
    },
    {
      "id": "UV020",
      "title": "Ирис Интер групп: команда «Найди на карточке компании» без запроса ссылки у пользователя",
      "tags": [
        "regression",
        "multi_turn",
        "variants",
        "company_card",
        "news_lookup",
        "anti_link_gate",
        "context_carryover"
      ],
      "strictPass": true,
      "strictFailedCheckCount": 0,
      "avgUsefulness": 1,
      "usefulRate": 0,
      "hardError": null,
      "failedChecks": [],
      "judgeIssueHints": [
        "Не использует контекст компании из диалога, хотя UV018 подтвердил что компания известна",
        "Generic fallback 'не вижу карточку, пришлите ссылку/город' — нарушение требования задачи",
        "Нерелевантный блок 'Собрал данные с сайтов' про медиа-компанию в ответе про логистику",
        "No progress on finding company card after 2 turns"
      ],
      "judgeReasons": [
        {
          "judge": "kimi",
          "usefulness": 1,
          "verdict": "not_useful",
          "reasons": [
            "Turn 1: не нашел карточку 'Ирис Интер групп' несмотря на контекст из предыдущих диалогов",
            "Turn 2: вместо поиска на карточке — снова запрашивает город и уточнение названия"
          ]
        },
        {
          "judge": "minimax",
          "usefulness": 1,
          "verdict": "not_useful",
          "reasons": [
            "Failed to find company card despite clear company name",
            "Repeatedly asked for clarification instead of searching"
          ]
        }
      ],
      "lastReply": "Проверил по доступным данным портала: карточка компании **«Ирис Интер групп»** не найдена среди подтверждённых записей Biznesinfo в текущем контексте. Что могу сделать дальше сразу: 1. Попробовать поиск по вариантам названия: **«Ирис Интергрупп» / «Iris Inter Group» / «Ирис»**. 2. Отфильтровать по городу, чтобы убрать ложные совпадения. Уточните 1 параметр: **в каком городе зарегистрирована компания?** После этого дам точное совпадение карточки (если есть) и сразу проверю новости с сайта. Собрал данные прямо с сай…",
      "lastUser": "Найди на карточке компании."
    },
    {
      "id": "UV007",
      "title": "Найти потенциальных заказчиков моей продукции: reverse поиск + shortlist",
      "tags": [
        "regression",
        "multi_turn",
        "variants",
        "reverse_search",
        "buyers",
        "shortlist",
        "template"
      ],
      "strictPass": true,
      "strictFailedCheckCount": 0,
      "avgUsefulness": 1.5,
      "usefulRate": 0,
      "hardError": null,
      "failedChecks": [],
      "judgeIssueHints": [
        "Generic fallback после конкретного запроса на top-5 заказчиков",
        "Пользователь дал чёткие параметры (пластиковая тара, банки/ведра, Беларусь), но ассистент не выдал конкретных компаний",
        "Failed to find any actual potential customers",
        "Reverse B2B mode didn't work - only generic advice"
      ],
      "judgeReasons": [
        {
          "judge": "kimi",
          "usefulness": 2,
          "verdict": "not_useful",
          "reasons": [
            "Turn 3: вместо конкретных компаний даёт абстрактные сегменты (молочка, соусы)",
            "Нет ни одной реальной карточки компании в shortlist"
          ]
        },
        {
          "judge": "minimax",
          "usefulness": 1,
          "verdict": "not_useful",
          "reasons": [
            "Never delivered concrete company list despite 3 requests",
            "Turn 3 gives segments instead of actual companies"
          ]
        }
      ],
      "lastReply": "Subject: Пищевая пластиковая тара (банки/ведра/крышки) для вашей фасовки в Беларуси Body: Добрый день! Меня зовут [Имя], компания [Название]. Мы поставляем пластиковую пищевую тару в Беларуси: банки, ведра и крышки для фасовки пищевой продукции. Можем быть полезны вашей компании для: — стабильных поставок под регулярные объемы; — подбора тары под ваш продукт и линию фасовки; — оптимизации затрат за счет подходящего форм-фактора и комплектации. Подскажите, пожалуйста, актуальна ли для вас сейчас закупка пищевой тар…",
      "lastUser": "Сделай первое сообщение для холодного контакта (Subject/Body/WhatsApp)."
    },
    {
      "id": "UV011",
      "title": "No-results ветка: сверхузкий запрос на производителей обуви",
      "tags": [
        "regression",
        "multi_turn",
        "variants",
        "no_results",
        "footwear",
        "guardrails",
        "fallback"
      ],
      "strictPass": true,
      "strictFailedCheckCount": 0,
      "avgUsefulness": 1.5,
      "usefulRate": 0,
      "hardError": null,
      "failedChecks": [],
      "judgeIssueHints": [
        "Generic fallback в turn 2: 'расширить поиск', 'временно расширить гео', 'обзвон по чеклисту' — это не 2-3 рабочие альтернативы как просил пользователь",
        "В turn 3 ассистент выдал абсолютно нерелевантную компанию (Центральный Дом офицеров Вооруженных Сил) — галлюцинация/мусор в выдаче",
        "Нарушение continuity: после запроса на расширенный поисковый запрос ассистент дал нерелевантный результат",
        "Hallucinates completely inappropriate candidate (military cultural center for shoe production)"
      ],
      "judgeReasons": [
        {
          "judge": "kimi",
          "usefulness": 2,
          "verdict": "not_useful",
          "reasons": [
            "Turn 1: корректно сообщил об отсутствии релевантных производителей, предложил уточнения",
            "Turn 2: дал абсолютно бесполезные 'альтернативы' — это общие инструкции, а не рабочие варианты"
          ]
        },
        {
          "judge": "minimax",
          "usefulness": 1,
          "verdict": "not_useful",
          "reasons": [
            "Assistant suggests Central House of Armed Forces Officers as shoe manufacturer - absurd hallucination",
            "Falls back to generic advice after user explicitly asked for concrete alternatives or honest 'no'"
          ]
        }
      ],
      "lastReply": "`производитель мужской обуви ручной работы Минск классические туфли индивидуальный пошив shell cordovan кордован карбоновый супинатор обувное производство обувная фабрика обувное ателье` Быстрый first-pass по релевантным компаниям из каталога: 1. ✅ Центральный Дом офицеров Вооруженных Сил Республики Беларусь Государственное культурно-досуговое учреждение — /company/biznesinfo-16389 (Курсы; Минск, minsk; тел: (+375-29) 6503841)",
      "lastUser": "Сформируй один расширенный запрос для портала, чтобы повысить шанс найти релевантных производителей."
    },
    {
      "id": "UV008",
      "title": "Белорусский минитрактор: покупка + критерии + сравнение",
      "tags": [
        "regression",
        "multi_turn",
        "variants",
        "minitractor",
        "equipment",
        "comparison"
      ],
      "strictPass": true,
      "strictFailedCheckCount": 0,
      "avgUsefulness": 2,
      "usefulRate": 0,
      "hardError": null,
      "failedChecks": [],
      "judgeIssueHints": [
        "Не может дать сравнение 3 вариантов, но не предлагает альтернатив (расширить регион, поискать похожую технику)",
        "Turn 3 содержит бессмысленный вывод каталога рубрик, не относящихся к тракторам",
        "Cannot fulfill comparison request with only 1 supplier",
        "User constraints ignored in response"
      ],
      "judgeReasons": [
        {
          "judge": "kimi",
          "usefulness": 2,
          "verdict": "not_useful",
          "reasons": [
            "Только 1 компания в базе, но ассистент продолжает 'shortlist' из 1 кандидата",
            "Turn 3: спамит каталогом рубрик вместо признания ограничений"
          ]
        },
        {
          "judge": "minimax",
          "usefulness": 2,
          "verdict": "not_useful",
          "reasons": [
            "Only 1 company found repeatedly - can't compare 3",
            "Constraints (30hp, attachment, service) not addressed"
          ]
        }
      ],
      "lastReply": "Сделать честное сравнение **3 вариантов** по цене/сроку/гарантии сейчас нельзя: в подтверждённых карточках Biznesinfo по вашему запросу найден только **1 релевантный кандидат**. 1. **ЖК Трейд ЧТПУП** — /company/jkt Данные из карточки: профиль по тракторной тематике (запчасти/расходники), Минск. По цене, сроку поставки, гарантии — **нет публичных цифр в доступных данных**, нужно запрашивать у поставщика. Кого обзвонить первым: 1. **ЖК Трейд ЧТПУП** (единственный подтверждённый релевантный вариант в текущей выборке)…",
      "lastUser": "Сравни 3 лучших варианта по цене, сроку поставки и гарантии."
    },
    {
      "id": "UV015",
      "title": "Вариант по минитракторам: покупка -> сравнение условий -> запрос для звонка",
      "tags": [
        "regression",
        "multi_turn",
        "variants",
        "minitractor",
        "comparison",
        "call_script"
      ],
      "strictPass": true,
      "strictFailedCheckCount": 0,
      "avgUsefulness": 2,
      "usefulRate": 0,
      "hardError": null,
      "failedChecks": [],
      "judgeIssueHints": [
        "Generic fallback в turn 2: вместо конкретного сравнения компаний дал оценку 'нет данных' по единственной компании",
        "Не выполнен запрос 'варианты для первичного отбора' — дана всего 1 компания, причем непрофильная",
        "Скрипт звонка в turn 3 — минималистичный, без структуры разговора, без уточняющих вопросов",
        "Отсутствие continuity: после запроса сравнения по 4 критериям не появилось новых компаний для сравнения"
      ],
      "judgeReasons": [
        {
          "judge": "kimi",
          "usefulness": 2,
          "verdict": "not_useful",
          "reasons": [
            "Turn 1: дал только 1 слаборелевантную компанию (ЖК Трейд — запчасти, не тракторы), вместо вариантов для отбора",
            "Turn 2: сравнение по 4 критериям выполнено только для 1 компании и сводится к 'нет данных'"
          ]
        },
        {
          "judge": "minimax",
          "usefulness": 2,
          "verdict": "not_useful",
          "reasons": [
            "Only 1 candidate (parts supplier, not tractors), honest about limited data",
            "Request for 4-criteria comparison in generic 'no data' results and fallback to basic query"
          ]
        }
      ],
      "lastReply": "1. Запрос для портала: \"минитрактор Беларусь дилер навесное оборудование\". 2. Запрос для звонка поставщику: \"Подтвердите, что вы поставляете минитракторы для фермы: модели в наличии, гарантия, сервис, сроки поставки и доступное навесное оборудование.\"",
      "lastUser": "Сделай один запрос для портала и короткий скрипт для первого звонка поставщику."
    },
    {
      "id": "UV019",
      "title": "Ирис Интер групп: запрос последних новостей без требования ссылки от пользователя",
      "tags": [
        "regression",
        "multi_turn",
        "variants",
        "news",
        "website_lookup",
        "self_search",
        "anti_link_gate"
      ],
      "strictPass": true,
      "strictFailedCheckCount": 0,
      "avgUsefulness": 2,
      "usefulRate": 0,
      "hardError": null,
      "failedChecks": [],
      "judgeIssueHints": [
        "Полная потеря контекста компании из предыдущих диалогов",
        "Generic fallback: 'нужен веб-обход' вместо реального действия",
        "Turn 2: перекладывает на пользователя задачу поиска сайта несмотря на прямое требование 'найди сам'",
        "Used wrong company name from context"
      ],
      "judgeReasons": [
        {
          "judge": "kimi",
          "usefulness": 2,
          "verdict": "not_useful",
          "reasons": [
            "Turn 1: вместо поиска новостей 'Ирис Интер групп' — выдал нерелевантную компанию 'Деловые Медиа ООО'",
            "Turn 2: не выполнил запрос 'найди сам' — переложил задачу на пользователя, запросил подтверждение"
          ]
        },
        {
          "judge": "minimax",
          "usefulness": 2,
          "verdict": "not_useful",
          "reasons": [
            "Deflected to user for website links despite company context available",
            "Hallucinated wrong company name (Delovye Media instead of Iris Inter Grup)"
          ]
        }
      ],
      "lastReply": "Понял. Сейчас у меня нет подтверждённых данных веб‑проверки именно по **Деловые Медиа ООО** (в текущем контексте есть live‑сниппеты только по Onliner и газете «Заря»), поэтому я не могу честно назвать «последние новости» с их сайтов без фактического доступа к страницам новостей. Что могу зафиксировать уже сейчас: 1. Компания: **Деловые Медиа ООО** — /company/del-media 2. Указанные сайты: - http://energokonkurs.by - http://stroykonkurs.by - http://digitalleaders.by Чтобы выполнить ваш запрос строго («если новостей…",
      "lastUser": "Да, найди сам. Если новостей на сайте нет — скажи это прямо и укажи, где проверял."
    },
    {
      "id": "UV002",
      "title": "Заводы муки: Беларусь -> качество -> экспортные документы -> shortlist",
      "tags": [
        "regression",
        "multi_turn",
        "variants",
        "flour",
        "factories",
        "export",
        "quality"
      ],
      "strictPass": true,
      "strictFailedCheckCount": 0,
      "avgUsefulness": 2.5,
      "usefulRate": 0.5,
      "hardError": null,
      "failedChecks": [],
      "judgeIssueHints": [
        "Падение в generic fallback на turn 3 после конкретных turn 1-2",
        "Подтвержденных карточек 'найдено 1 из 3' — пользователь просил 3-5, получил 1 с предупреждением",
        "Сильный разрыв контекста: пользователь дал конкретные критерии качества и экспорта, но turn 3 проигнорировал их",
        "Generic fallback после Turn 2 - штрафуется по rubric"
      ],
      "judgeReasons": [
        {
          "judge": "kimi",
          "usefulness": 3,
          "verdict": "useful",
          "reasons": [
            "Turn 1-2: хороший старт с 3 производителями и попыткой ранжирования по критериям качества",
            "Turn 3: катастрофический fallback — вместо shortlist с экспортной готовностью выдаётся 1 компания с пометкой 'проверьте данные'"
          ]
        },
        {
          "judge": "minimax",
          "usefulness": 2,
          "verdict": "not_useful",
          "reasons": [
            "КРИТИЧЕСКАЯ ПРОБЛЕМА: Turn 3 полностью игнорирует критерии качества (белизна, клейковина, стабильность партии) из Turn 2",
            "Turn 3 также игнорирует запрос про экспортную готовность из того же turn"
          ]
        }
      ],
      "lastReply": "1. **Регистрационные документы компании** - Актуальная выписка/сведения о юрлице (наименование, УНП, адрес, статус), уставные данные, подтверждение полномочий директора. 2. **Документ о полномочиях подписанта** - Если подписывает не директор: доверенность + приказ/основание, срок действия и право подписи именно договоров поставки. 3. **Документы качества и безопасности на муку** - Декларация/сертификат соответствия (если применимо), удостоверение качества на партию, протоколы испытаний (белизна, клейковина, влажно…",
      "lastUser": "Дай чеклист из 6 пунктов, какие документы спросить перед контрактом."
    },
    {
      "id": "UV013",
      "title": "Deep website-scan: внутренняя навигация сайта (контакты/о компании/продукция)",
      "tags": [
        "regression",
        "multi_turn",
        "website_scan",
        "website_scan_deep",
        "sources",
        "contacts",
        "minsk",
        "footwear"
      ],
      "strictPass": true,
      "strictFailedCheckCount": 0,
      "avgUsefulness": 2.5,
      "usefulRate": 0.5,
      "hardError": null,
      "failedChecks": [],
      "judgeIssueHints": [
        "Фальшивая 'глубокая проверка': ассистент не сканировал разделы /contacts, /about, /catalog как обещал — просто процитировал общий сниппет",
        "Не выполнил запрос на 3 компании — в итоге дал только 1 на всю сессию",
        "В turn 3 вместо предложения следующего кандидата дал общие рекомендации 'расширить поиск'"
      ],
      "judgeReasons": [
        {
          "judge": "kimi",
          "usefulness": 2,
          "verdict": "not_useful",
          "reasons": [
            "Turn 1: дал только 1 компанию вместо 3, но хотя бы релевантную",
            "Turn 2: сделал вид 'проверки сайта', но на самом деле просто процитировал сниппет из карточки Biznesinfo без реального сканирования разделов"
          ]
        },
        {
          "judge": "minimax",
          "usefulness": 3,
          "verdict": "useful",
          "reasons": [
            "Actually checks website and honestly notes 'no manufacturer confirmation on homepage'",
            "Provides source URLs and contacts, correctly identifies shoesterra as online store not manufacturer"
          ]
        }
      ],
      "lastReply": "Принято. Отмечаю по правилу “нет подтверждения на главной → следующий кандидат”. - Главная: https://shoesterra.by/ - Статус проверки: ⚠️ на главной нет явного подтверждения, что это **производитель** (виден формат интернет-магазина/сети магазинов). - Что подтверждено: продажа обуви, бренды, контакты. - Контакты: +375 (29) 342-92-67, shoesterra@yandex.ru - Следующий шаг: перейти к следующему кандидату в Минске из карточек Biznesinfo. Сейчас в доступном срезе Biznesinfo у меня подтвержден только 1 релевантный кандид…",
      "lastUser": "Если на главной нет подтверждения, пометь это и предложи следующего кандидата для проверки."
    },
    {
      "id": "UV014",
      "title": "Reverse-buyer вариативный: пищевая тара -> целевые сегменты -> shortlist без общих советов",
      "tags": [
        "regression",
        "multi_turn",
        "variants",
        "reverse_buyer",
        "packaging",
        "strict_mode"
      ],
      "strictPass": true,
      "strictFailedCheckCount": 0,
      "avgUsefulness": 2.5,
      "usefulRate": 0.5,
      "hardError": null,
      "failedChecks": [],
      "judgeIssueHints": [
        "В turn 3 отсутствуют сами 3 вопроса для первого контакта — ассистент дал только кого звонить",
        "Ответ обрывается на 'Критерии отбора: релевантность профиля...' без завершения мысли",
        "Маркировка [проверьте данные] на всех компаниях снижает доверие, хотя это молочные гиганты",
        "Top-5 list degrades to '[check data]' placeholders with no real info"
      ],
      "judgeReasons": [
        {
          "judge": "kimi",
          "usefulness": 3,
          "verdict": "useful",
          "reasons": [
            "Turn 1: дал релевантные сегменты целевых клиентов для пищевой тары",
            "Turn 2: выдал 5 конкретных молочных комбинатов с ссылками на карточки — это реальный shortlist"
          ]
        },
        {
          "judge": "minimax",
          "usefulness": 2,
          "verdict": "not_useful",
          "reasons": [
            "Initially gives good dairy/food manufacturers list",
            "But then falls back to generic 'check data' markers and vague advice instead of concrete contacts"
          ]
        }
      ],
      "lastReply": "Shortlist по текущим данным каталога: 1. ⚠️ Минский молочный завод №1 ОАО — /company/belmilk (Минск, minsk) [проверьте данные] 2. ⚠️ Полоцкий молочный комбинат ОАО — /company/polotskmilk (Полоцк, vitebsk) [проверьте данные] 3. ⚠️ Лидский молочно-консервный комбинат ОАО — /company/moloko-lida (Лида, grodno) [проверьте данные] Кого прозвонить первым сегодня: 1) Минский молочный завод №1 ОАО, 2) Полоцкий молочный комбинат ОАО. Фокус: Нужны в Беларуси, приоритет: молочка, соусы, кулинария. Сделай top-5. Без общих сове…",
      "lastUser": "Без общих советов. Дай кого первым прозвонить и 3 вопроса для первого контакта."
    },
    {
      "id": "UV001",
      "title": "Производители обуви в Минске: уточнение типа + shortlist + шаблон контакта",
      "tags": [
        "regression",
        "multi_turn",
        "variants",
        "footwear",
        "minsk",
        "manufacturers",
        "template"
      ],
      "strictPass": true,
      "strictFailedCheckCount": 0,
      "avgUsefulness": 3,
      "usefulRate": 0.5,
      "hardError": null,
      "failedChecks": [],
      "judgeIssueHints": [
        "Генерация шаблонного ответа вместо реального поиска по каталогу",
        "Нарушение контекста: после уточнения 'производители, не магазины' ассистент всё равно показывает рубрики магазинов обуви"
      ],
      "judgeReasons": [
        {
          "judge": "kimi",
          "usefulness": 2,
          "verdict": "not_useful",
          "reasons": [
            "Ассистент повторяет одну и ту же компанию (Глобал Шуз) на всех ходах, игнорируя запрос на 3-5 кандидатов",
            "После уточнения про мужскую классическую обувь не происходит фильтрации — выдаётся тот же результат"
          ]
        },
        {
          "judge": "minimax",
          "usefulness": 4,
          "verdict": "useful",
          "reasons": [
            "Удерживает производственный фокус обуви на протяжении всех 4х turns",
            "Корректно переключился с розничных магазинов на производителей во 2м turn"
          ]
        }
      ],
      "lastReply": "Subject: Запрос по мужской классической обуви от потенциального партнёра (Минск) Body: Добрый день! Меня зовут [Ваше имя], компания [Название компании]. Рассматриваем сотрудничество с производителем мужской классической обуви в Минске. Интересует: 1. Ассортимент по мужской классической обуви (модели, материалы, размеры). 2. Оптовые условия: минимальная партия, цены, сроки производства/поставки. 3. Возможность выпуска под нашей ТМ (если есть), брендирование и упаковка. 4. Наличие сертификатов/деклараций и гарантийн…",
      "lastUser": "Сделай первое сообщение поставщику в блоках Subject/Body/WhatsApp."
    },
    {
      "id": "UV006",
      "title": "Лес на экспорт: условия качества + логистика + RFQ",
      "tags": [
        "regression",
        "multi_turn",
        "variants",
        "timber",
        "export",
        "rfq",
        "logistics"
      ],
      "strictPass": true,
      "strictFailedCheckCount": 0,
      "avgUsefulness": 3,
      "usefulRate": 0.5,
      "hardError": null,
      "failedChecks": [],
      "judgeIssueHints": [
        "Повторяет одни и те же 3-5 компаний без новых кандидатов после уточнения по FSC/сушке",
        "No filtering by quality/logistics constraints",
        "Assistant never confirms if any supplier can meet requirements",
        "Generic RFQ template without actionable specificity"
      ],
      "judgeReasons": [
        {
          "judge": "kimi",
          "usefulness": 4,
          "verdict": "useful",
          "reasons": [
            "Конкретные компании с карточками портала на каждом этапе",
            "RFQ структурирован по блокам Subject/Body/WhatsApp как запрошено"
          ]
        },
        {
          "judge": "minimax",
          "usefulness": 2,
          "verdict": "not_useful",
          "reasons": [
            "Constraints (FSC, dry, delivery) from turn 2 ignored in shortlist",
            "Shortlist same 5 companies regardless of constraints"
          ]
        }
      ],
      "lastReply": "Subject: RFQ: Сухая обрезная доска (экспорт) с FSC и доставкой до границы Body: Добрый день! Просим предоставить коммерческое предложение на поставку сухой обрезной доски для экспорта. 1. Товар: - Сухая обрезная доска (укажите доступные породы) - Размеры: укажите доступные сечения и длины - Сортность: укажите варианты - Влажность: просим указать фактический диапазон (и метод контроля) 2. Сертификация: - Наличие FSC (просьба указать тип сертификата: CoC/FM) - Номер сертификата и срок действия - Возможность оформлен…",
      "lastUser": "Сформируй RFQ в блоках Subject/Body/WhatsApp."
    },
    {
      "id": "UV009",
      "title": "Стоматология с микроскопом в Минске: сложный consumer кейс + полезный fallback",
      "tags": [
        "regression",
        "multi_turn",
        "variants",
        "dentistry",
        "minsk",
        "consumer",
        "fallback"
      ],
      "strictPass": true,
      "strictFailedCheckCount": 0,
      "avgUsefulness": 3,
      "usefulRate": 0.5,
      "hardError": null,
      "failedChecks": [],
      "judgeIssueHints": [
        "Turn 4: в конце скрипта вставлена нерелевантная компания (Сэльвин — бытовая химия)",
        "Не предупреждает о медицинских рисках явно",
        "No actual clinic recommendations provided",
        "Medical query outside Biznesinfo scope - should redirect earlier"
      ],
      "judgeReasons": [
        {
          "judge": "kimi",
          "usefulness": 4,
          "verdict": "useful",
          "reasons": [
            "При отсутствии данных даёт полезные критерии выбора клиники",
            "Чеклист из 7+ пунктов релевантен и практичен"
          ]
        },
        {
          "judge": "minimax",
          "usefulness": 2,
          "verdict": "not_useful",
          "reasons": [
            "Checklist and script are actually useful for consumer",
            "But no actual dental clinic recommendations given"
          ]
        }
      ],
      "lastReply": "Здравствуйте! Подскажите, пожалуйста, по лечению корневых каналов. Мне важно лечение **под микроскопом** — скажите, у вас это делается на всех этапах? Кто из врачей занимается эндодонтией и какой у него опыт? Делаете ли вы КЛКТ или контрольные снимки до и после лечения? И сориентируйте, пожалуйста, по стоимости: что входит в цену «под ключ», есть ли доплаты и какая гарантия. Если всё подходит, хотел(а) бы записаться на ближайшую консультацию. Быстрый first-pass по релевантным компаниям из каталога: 1. ✅ Сэльвин ОО…",
      "lastUser": "Сделай короткий скрипт звонка на 30-40 секунд."
    },
    {
      "id": "UV004",
      "title": "Белорусские соковыжималки: заводы -> OEM/ODM -> shortlist -> RFQ",
      "tags": [
        "regression",
        "multi_turn",
        "variants",
        "juicers",
        "manufacturing",
        "oem",
        "rfq"
      ],
      "strictPass": true,
      "strictFailedCheckCount": 0,
      "avgUsefulness": 3.5,
      "usefulRate": 1,
      "hardError": null,
      "failedChecks": [],
      "judgeIssueHints": [
        "Turn 3 — явный generic fallback: 'найдено 1 из 3' после просьбы shortlist",
        "Нет реального сравнения по надежности и сервису как запрошено",
        "Turn 3 немного повторяет информацию из предыдущих turns",
        "Не всегда понятно какие данные проверены а какие гипотетичны"
      ],
      "judgeReasons": [
        {
          "judge": "kimi",
          "usefulness": 3,
          "verdict": "useful",
          "reasons": [
            "Turn 1-2: честное признание ограниченности данных, но полезные гипотезы (Ареса-техно, HORIZONT)",
            "Turn 3: провал — вместо shortlist по надежности выдаётся 1 компания с 'проверьте данные'"
          ]
        },
        {
          "judge": "minimax",
          "usefulness": 4,
          "verdict": "useful",
          "reasons": [
            "Хорошо回应 OEM/ODM запрос во 2м turn",
            "3й turn дает shortlist с приоритетом контактов"
          ]
        }
      ],
      "lastReply": "Subject: Запрос OEM/ODM по соковыжималкам под нашим брендом (MOQ, сроки, гарантия) Body: Добрый день! Ищем производственного партнёра в Беларуси для контрактного выпуска соковыжималок под нашим брендом (OEM/ODM). Просим предоставить коммерческую информацию по следующим пунктам: 1. Формат сотрудничества - Поддерживаете ли OEM, ODM или private label? - Какие модели соковыжималок доступны для брендирования? 2. MOQ и партии - Минимальный объём заказа (MOQ) по каждой модели. - Цена при тиражах: MOQ / 500 / 1000+ шт (ес…",
      "lastUser": "Сделай RFQ в блоках Subject/Body/WhatsApp с запросом MOQ, сроков и гарантии."
    },
    {
      "id": "UV010",
      "title": "Не помню точный бренд молочной компании: гипотезы + проверка + уточнение",
      "tags": [
        "regression",
        "multi_turn",
        "variants",
        "dairy",
        "brand_recall",
        "hypotheses",
        "savushkin"
      ],
      "strictPass": true,
      "strictFailedCheckCount": 0,
      "avgUsefulness": 3.5,
      "usefulRate": 0.5,
      "hardError": null,
      "failedChecks": [],
      "judgeIssueHints": [
        "Algorithm too obvious - user knows brand already",
        "Queries don't leverage Biznesinfo specifics",
        "Could have provided direct company URL immediately"
      ],
      "judgeReasons": [
        {
          "judge": "kimi",
          "usefulness": 5,
          "verdict": "useful",
          "reasons": [
            "Корректно идентифицирует 'Савушкин продукт' по неполному описанию",
            "Даёт альтернативные гипотезы с конкретными карточками компаний"
          ]
        },
        {
          "judge": "minimax",
          "usefulness": 2,
          "verdict": "not_useful",
          "reasons": [
            "Correct identification of Savushkin Product",
            "Good alternative hypotheses provided"
          ]
        }
      ],
      "lastReply": "1. Запрос для портала: \"Савушкин продукт молоко творожки Беларусь производитель официальный сайт\". 2. Запрос для звонка поставщику: \"Подтвердите, пожалуйста, что это ОАО «Савушкин продукт» и что в линейке есть молоко и творожки; подскажите актуальный бренд/линейку.\"",
      "lastUser": "Сформируй один точный запрос для портала и один запрос для звонка поставщику."
    },
    {
      "id": "UV003",
      "title": "Где поблизости вкусно поесть: consumer запрос -> b2b переформулировка",
      "tags": [
        "regression",
        "multi_turn",
        "variants",
        "consumer_to_b2b",
        "restaurants",
        "reframing"
      ],
      "strictPass": true,
      "strictFailedCheckCount": 0,
      "avgUsefulness": 4,
      "usefulRate": 1,
      "hardError": null,
      "failedChecks": [],
      "judgeIssueHints": [
        "В turn 3 в конце странная вставка про 'Рыболов Магазин' — не релевантно запросу про кафе",
        "Turn 2: предложение 'САНТЕХНИКА ДЛЯ ВАННЫХ КОМНАТ' как 'локальная точка' выглядит нелепо"
      ],
      "judgeReasons": [
        {
          "judge": "kimi",
          "usefulness": 4,
          "verdict": "useful",
          "reasons": [
            "Ассистент корректно обработал consumer-запрос и предложил b2b-мост без ломки диалога",
            "Turn 2: честно признал отсутствие ресторанов в Уручье и предложил альтернативы (HoReCa-оборудование)"
          ]
        },
        {
          "judge": "minimax",
          "usefulness": 4,
          "verdict": "useful",
          "reasons": [
            "Отлично обработал consumer запрос и трансформировал в B2B формат",
            "Во 2м turn предложил альтернативный поиск когда ресторанов не нашлось"
          ]
        }
      ],
      "lastReply": "Subject: Запрос на поставку продуктов для кафе (Минск, Уручье) Body: Добрый день! Ищем поставщика продуктов для кафе в Минске (район Уручье). Интересуют регулярные поставки: бакалея, молочная продукция, мясо/птица, заморозка и сопутствующие позиции. Просьба направить прайс, минимальный заказ, условия доставки, сроки, возможность отсрочки платежа и пакет документов для юрлиц. Готовы обсудить тестовую поставку в ближайшие дни. WhatsApp: Здравствуйте! Нужен поставщик продуктов для кафе (Минск, Уручье): бакалея, молоч…",
      "lastUser": "Сформируй короткое сообщение поставщику продуктов в блоках Subject/Body/WhatsApp."
    },
    {
      "id": "UV005",
      "title": "Экспортеры пищевой промышленности: сегментация по рынкам и продукту",
      "tags": [
        "regression",
        "multi_turn",
        "variants",
        "food_export",
        "segmentation",
        "shortlist"
      ],
      "strictPass": true,
      "strictFailedCheckCount": 0,
      "avgUsefulness": 4,
      "usefulRate": 1,
      "hardError": null,
      "failedChecks": [],
      "judgeIssueHints": [
        "Turn 1 слишком generic (рубрики вместо конкретных компаний), но это приемлемо для старта",
        "Нет прямого подтверждения экспорта в ЕАЭС/СНГ в карточках — работа на доверии",
        "Пользователь просил молочную И кондитерскую, но ответил только по молочной",
        "Нет явного объяснения почему кондитерская не представлена в shortlist"
      ],
      "judgeReasons": [
        {
          "judge": "kimi",
          "usefulness": 4,
          "verdict": "useful",
          "reasons": [
            "Turn 1: полезная навигация по рубрикам портала для поиска экспортеров",
            "Turn 2: хорошая сегментация — нашел 4 молочных производителя, честно сказал про отсутствие кондитерских"
          ]
        },
        {
          "judge": "minimax",
          "usefulness": 4,
          "verdict": "useful",
          "reasons": [
            "Хорошо сегментирует по рынкам (ЕАЭС/СНГ) и продукту (молочная)",
            "3й turn дает shortlist top-5 с приоритетом по вероятности ответа"
          ]
        }
      ],
      "lastReply": "Subject: Запрос по поставкам молочной продукции в ЕАЭС/СНГ Body: Здравствуйте! Меня зовут [Ваше имя], компания [Название компании]. Рассматриваем долгосрочное сотрудничество по закупке молочной продукции для рынков ЕАЭС/СНГ. Интересуют позиции: [категории/SKU], плановый объем: [объем/мес], целевой старт поставок: [дата]. Просьба сообщить: 1) Какие страны ЕАЭС/СНГ вы сейчас покрываете по экспорту; 2) Доступный ассортимент и MOQ; 3) Условия поставки (Incoterms), сроки производства/отгрузки; 4) Базовые цены/прайс и у…",
      "lastUser": "Сделай короткий outreach шаблон (email + WhatsApp)."
    },
    {
      "id": "UV016",
      "title": "Вариативный экспорт муки: shortlist + документная проверка + шаблон запроса",
      "tags": [
        "regression",
        "multi_turn",
        "variants",
        "flour",
        "export",
        "documents",
        "template"
      ],
      "strictPass": true,
      "strictFailedCheckCount": 0,
      "avgUsefulness": 4.5,
      "usefulRate": 1,
      "hardError": null,
      "failedChecks": [],
      "judgeIssueHints": [
        "Turn 3: в списке документов для проверки не хватает конкретики — перечислены категории, но не детали"
      ],
      "judgeReasons": [
        {
          "judge": "kimi",
          "usefulness": 4,
          "verdict": "useful",
          "reasons": [
            "Turn 1: дал конкретный список из 5 производителей муки с карточками biznesinfo и обоснованием",
            "Turn 2: выполнил запрос top-4 с ранжированием по экспортной готовности, сохранил контекст"
          ]
        },
        {
          "judge": "minimax",
          "usefulness": 5,
          "verdict": "useful",
          "reasons": [
            "Maintained export context through all 3 turns",
            "Provided concrete top-4 ranking with export readiness assessment"
          ]
        }
      ],
      "lastReply": "Subject: Запрос на экспортную поставку муки пшеничной высшего сорта (RFQ) Body: Добрый день! Наша компания рассматривает закупку муки пшеничной высшего сорта для экспортных поставок и просит предоставить коммерческое предложение. Просим указать: 1) Доступные объемы (в месяц) и минимальную партию. 2) Фасовку и варианты отгрузки (мешки 25/50 кг, биг-бэг, bulk). 3) Цену и базис поставки (EXW/FCA/FOB/CIF — если применимо). 4) Сроки готовности партии и график отгрузок. 5) Показатели качества (белок, клейковина, влажнос…",
      "lastUser": "Дай шаблон письма (Subject/Body/WhatsApp) и отдельно 5 документов для первичной проверки."
    }
  ],
  "advice": [
    {
      "advisor": "kimi",
      "executiveSummary": "The QA results reveal a pattern of failures in an AI assistant that doesn't exist in the current codebase. The current project is a Meilisearch-based company search portal (Next.js + Meilisearch), but the QA tests an AI assistant with multi-turn conversations, context management, and LLM-based responses. The 2 strict failures (UV012, UV022) and low usefulness scores (avg 2.18/5) indicate the assistant lacks: (1) entity validation to prevent hallucinations (policlinics as shoe manufacturers), (2) context continuity across turns, (3) website verification capabilities, and (4) proper fallback handling. To implement this assistant, you need to build an LLM orchestration layer with explicit guardrails.",
      "priorityPlan": [
        {
          "priority": "P0",
          "title": "Add entity type validation before returning company results",
          "why": "UV012 failed catastrophically: assistant returned polyclinics and hospitals as 'shoe manufacturers'. This is a data validation bug that destroys user trust.",
          "expectedImpact": "Eliminates category hallucinations; prevents medical/cultural institutions appearing as manufacturers.",
          "validationScenarios": [
            "UV012",
            "UV011",
            "UV009"
          ]
        },
        {
          "priority": "P0",
          "title": "Implement conversation context memory (session state)",
          "why": "UV021, UV019, UV020 all show complete loss of company context between turns. Assistant forgets 'Ирис Интер групп' and hallucinates unrelated companies.",
          "expectedImpact": "Maintains entity continuity; enables multi-turn workflows like 'find company → check website → get news'.",
          "validationScenarios": [
            "UV021",
            "UV019",
            "UV020",
            "UV022"
          ]
        },
        {
          "priority": "P1",
          "title": "Build website verification tool with actual HTTP fetching",
          "why": "UV013 shows fake 'deep checks' - assistant claims to scan /contacts, /about but only quotes existing snippets. UV012 demands real website verification.",
          "expectedImpact": "Enables 'check website' requests; provides verified contact data; supports 'news from website' feature.",
          "validationScenarios": [
            "UV013",
            "UV012",
            "UV022"
          ]
        },
        {
          "priority": "P1",
          "title": "Add strict mode for 'no generic fallback' requests",
          "why": "UV007, UV011, UV002 all show assistant falling back to generic advice when user explicitly demands concrete companies or 'no generic advice'.",
          "expectedImpact": "Respects user constraints; reduces fallback rate from ~40% to <10%.",
          "validationScenarios": [
            "UV007",
            "UV011",
            "UV002",
            "UV014"
          ]
        },
        {
          "priority": "P2",
          "title": "Implement result count enforcement (3-5 candidates)",
          "why": "Multiple scenarios show 'found 1 of 3' or repeating the same single company instead of finding more candidates.",
          "expectedImpact": "Meets user quantity expectations; enables proper comparison workflows.",
          "validationScenarios": [
            "UV001",
            "UV008",
            "UV015",
            "UV002"
          ]
        }
      ],
      "recommendations": [
        {
          "id": "R1",
          "area": "guardrails",
          "title": "Add rubric-based entity validation layer",
          "action": "Before returning any company in results, verify its rubric/category matches the query intent. Query 'производители обуви' must filter by rubrics containing 'производство' AND 'обувь'. Reject companies with mismatched rubrics (e.g., medical institutions).",
          "implementationHint": "src/lib/validation/entityValidator.ts - create validateCompaniesAgainstIntent(companies, intent) function. Call in API route before returning results.",
          "expectedImpact": "Prevents UV012-type hallucinations where wrong-category companies appear.",
          "risk": "May reduce recall if rubric data is incomplete. Mitigate with rubric expansion mapping.",
          "effort": "M",
          "validationScenarios": [
            "UV012",
            "UV011"
          ]
        },
        {
          "id": "R2",
          "area": "retrieval",
          "title": "Implement session-based conversation memory",
          "action": "Store conversation turns in Redis/memory with session ID. Include last 3 turns in LLM context. Track mentioned entities (companies, locations) explicitly.",
          "implementationHint": "Add session middleware in src/app/api/chat/route.ts. Use conversationId from client or generate UUID. Store turns in simple in-memory Map (scale to Redis later).",
          "expectedImpact": "Fixes UV021/UV019/UV020 context loss issues.",
          "risk": "Memory growth - implement TTL (1 hour) and max turns (10).",
          "effort": "M",
          "validationScenarios": [
            "UV021",
            "UV019",
            "UV020",
            "UV022"
          ]
        },
        {
          "id": "R3",
          "area": "retrieval",
          "title": "Build website fetcher tool for LLM",
          "action": "Create tool that fetches company website, extracts contacts, about text, and news. Use cheerio or similar for parsing. Cache results 1 hour.",
          "implementationHint": "src/lib/tools/websiteFetcher.ts - export fetchWebsiteData(url): {contacts, about, news, products}. Add rate limiting (max 5 req/min per domain).",
          "expectedImpact": "Enables UV013 'deep scan' and UV012 'check website' features to actually work.",
          "risk": "Websites may block scraping. Implement fallback to cached Biznesinfo data with honest disclosure.",
          "effort": "L",
          "validationScenarios": [
            "UV013",
            "UV012",
            "UV022"
          ]
        },
        {
          "id": "R4",
          "area": "prompt",
          "title": "Add strict mode flag to system prompt",
          "action": "When user says 'без общих советов' or 'только конкретные компании', set strictMode=true. In prompt: 'STRICT MODE: Do not provide generic advice. If insufficient data, say \"Недостаточно данных\" and suggest specific next search query.'",
          "implementationHint": "Detect strict mode keywords in user message in src/app/api/chat/route.ts. Pass to LLM as system message modifier.",
          "expectedImpact": "Reduces generic fallback rate from ~40% to <10% for strict requests.",
          "risk": "May appear less helpful. Balance with explicit 'next step' suggestions.",
          "effort": "S",
          "validationScenarios": [
            "UV007",
            "UV011",
            "UV014"
          ]
        },
        {
          "id": "R5",
          "area": "ranking",
          "title": "Implement result aggregation to meet count requirements",
          "action": "When user asks for N companies but only M<N found: (1) expand search to related rubrics, (2) expand geo if applicable, (3) return M with explicit note + search suggestions for remaining N-M.",
          "implementationHint": "Modify search logic in src/lib/meilisearch/search.ts. If results.length < requestedCount, trigger secondary search with relaxed filters.",
          "expectedImpact": "Meets UV001/UV008/UV015 quantity expectations.",
          "risk": "Lower relevance with expanded search. Rank expanded results separately with confidence scores.",
          "effort": "M",
          "validationScenarios": [
            "UV001",
            "UV008",
            "UV015",
            "UV002"
          ]
        },
        {
          "id": "R6",
          "area": "template",
          "title": "Create template parser for Subject/Body/WhatsApp blocks",
          "action": "Build formatter that guarantees structured output for outreach templates. Use JSON mode or strict regex validation.",
          "implementationHint": "src/lib/formatters/outreachTemplate.ts - parse LLM output and enforce blocks. Fallback to manual formatting if LLM fails structure.",
          "expectedImpact": "Reliable template generation for UV001, UV003, UV004, UV016.",
          "risk": "LLM may resist structured output. Use function calling or JSON mode.",
          "effort": "S",
          "validationScenarios": [
            "UV001",
            "UV003",
            "UV004",
            "UV016"
          ]
        },
        {
          "id": "R7",
          "area": "guardrails",
          "title": "Add hallucination detection for company names",
          "action": "Validate that mentioned companies exist in catalog before including in response. If LLM hallucinates 'Деловые Медиа ООО' instead of 'Ирис Интер групп', reject and re-query.",
          "implementationHint": "Post-process LLM output: extract company mentions, verify against Meilisearch index. Flag mismatches for retry.",
          "expectedImpact": "Prevents UV021/UV019 entity confusion bugs.",
          "risk": "Adds latency. Run validation async or cache company list.",
          "effort": "M",
          "validationScenarios": [
            "UV021",
            "UV019",
            "UV020"
          ]
        },
        {
          "id": "R8",
          "area": "geo",
          "title": "Fix geo disambiguation for Minsk districts",
          "action": "When user specifies district (Уручье, Малиновка), ensure search filters by district or nearby radius. Currently ignored.",
          "implementationHint": "Enhance location.ts with district coordinates. Add geo filter to Meilisearch query when district detected.",
          "expectedImpact": "Improves UV003, UV001 relevance for location-specific queries.",
          "risk": "Limited district data in catalog. Fallback to 'nearby' with explicit note.",
          "effort": "S",
          "validationScenarios": [
            "UV003",
            "UV001"
          ]
        }
      ],
      "testPlan": {
        "mustPassScenarios": [
          "UV012",
          "UV022",
          "UV021",
          "UV007",
          "UV002"
        ],
        "regressionSuites": [
          "scenarios.regressions.user-ideas-multistep-variants.json",
          "scenarios.regressions.geo-ambiguity.json",
          "scenarios.regressions.guardrails-extensions.json"
        ],
        "successMetrics": [
          "strictPassRate >= 0.95 (currently 0.91)",
          "avgUsefulness >= 3.5 (currently 2.18)",
          "usefulRate >= 0.75 (currently 0.32)",
          "zero hallucination of wrong-category companies",
          "context continuity score >= 4 across multi-turn scenarios"
        ]
      }
    },
    {
      "advisor": "minimax",
      "executiveSummary": "Pass rate 90.9% (20/22) with avg usefulness 2.55-2.82 across judges. Two critical failure patterns dominate: (1) anti-noise filtering lets completely irrelevant entities (hospitals, military centers, cleaning product companies) leak into results across 5+ scenarios, and (2) multi-turn context is lost for entity-specific queries (all 4 Ирис Интер групп variants score ≤1 usefulness). A third systemic issue is generic fallback responses replacing actionable output when the catalog has sparse data. Fixing these three areas would lift ~10 scenarios from not_useful to useful.",
      "priorityPlan": [
        {
          "priority": "P0",
          "title": "Eliminate irrelevant-entity leakage in catalog search results",
          "why": "At least 5 scenarios (UV012, UV011, UV009, UV003, UV021) show completely unrelated companies injected into responses — polyclinics as shoe manufacturers, military cultural centers as cobblers, cleaning product companies in dental results. This destroys user t…",
          "expectedImpact": "UV012 strict pass (fixes the only remaining strict failure besides UV022), UV011/UV009/UV003 usefulness +1-2 points each",
          "validationScenarios": [
            "UV012",
            "UV011",
            "UV009",
            "UV003",
            "UV021"
          ]
        },
        {
          "priority": "P0",
          "title": "Fix multi-turn entity context carryover for company-specific queries",
          "why": "All 4 Ирис Интер групп scenarios (UV019-UV022) average usefulness 0.5-2.5 because the assistant loses track of which company the user is asking about, hallucinating 'Деловые Медиа ООО' or random catalog entries instead. UV022 also has the second strict failur…",
          "expectedImpact": "UV019-UV022 usefulness from avg 1.25 → 3+, UV022 strict pass fix",
          "validationScenarios": [
            "UV019",
            "UV020",
            "UV021",
            "UV022"
          ]
        },
        {
          "priority": "P1",
          "title": "Replace generic fallback with structured sparse-data responses",
          "why": "At least 8 scenarios trigger a 'generic fallback' pattern where the assistant gives vague advice ('расширьте поиск', 'обзвон по чеклисту') instead of (a) acknowledging what WAS found, (b) giving a concrete next step, (c) maintaining user criteria from prior t…",
          "expectedImpact": "UV002, UV007, UV008, UV011, UV014, UV015 usefulness +1 each",
          "validationScenarios": [
            "UV002",
            "UV007",
            "UV008",
            "UV011",
            "UV014",
            "UV015"
          ]
        },
        {
          "priority": "P2",
          "title": "Ensure multi-turn criteria persistence (quality, export, constraints)",
          "why": "UV002 turn 3 ignores белизна/клейковина criteria from turn 2. UV006 shortlist ignores FSC/drying constraints. UV008 ignores 30hp/attachment/service constraints. Users who invest 2-3 turns refining criteria expect them to persist.",
          "expectedImpact": "UV002, UV006, UV008 usefulness +1 each",
          "validationScenarios": [
            "UV002",
            "UV006",
            "UV008"
          ]
        }
      ],
      "recommendations": [
        {
          "id": "R1",
          "area": "retrieval",
          "title": "Add hard rubric-level anti-noise filter with category cross-validation",
          "action": "Before including any company in a response, validate that the company's rubric/category is semantically compatible with the user's query intent. Implement a blocklist-based filter: if user asks for 'производители обуви' and candidate rubric contains 'поликлиника|больница|курсы|бытовая химия|досуговое учреждение', hard-reject that candidate. This should be a post-retrieval filter applied BEFORE the LLM formats the re…",
          "implementationHint": "In the search/retrieval layer (likely src/ directory, look for the function that builds the company candidate list from Meilisearch/catalog results). Add a rubric-compatibility check using a negative-match list keyed by query intent catego…",
          "expectedImpact": "Eliminates hallucinated irrelevant companies in UV012, UV011, UV009, UV003, UV021",
          "risk": "Over-filtering could remove edge-case relevant companies. Mitigate by logging filtered candidates.",
          "effort": "S",
          "validationScenarios": [
            "UV012",
            "UV011",
            "UV009",
            "UV003"
          ]
        },
        {
          "id": "R2",
          "area": "prompt",
          "title": "Add explicit entity-tracking instruction in system prompt for multi-turn",
          "action": "Add to system prompt: 'ENTITY TRACKING: When a user has established a specific company name in conversation (e.g., by searching for it or referring to it), maintain that entity as the active subject for all subsequent turns until the user explicitly switches. Never substitute a different company name. If you cannot find the company, say so using the EXACT name the user provided — do not suggest a different company a…",
          "implementationHint": "Find the system prompt template (likely in src/ or app/ directory, search for systemPrompt or system_message). Add the entity-tracking rule near the top of the behavioral rules section.",
          "expectedImpact": "Fixes UV019 (hallucinated Деловые Медиа instead of Ирис Интер групп), UV021 (entity confusion), UV020 (context loss)",
          "risk": "Low — this is a behavioral guardrail, not a logic change",
          "effort": "S",
          "validationScenarios": [
            "UV019",
            "UV020",
            "UV021",
            "UV022"
          ]
        },
        {
          "id": "R3",
          "area": "prompt",
          "title": "Replace generic fallback template with structured sparse-data template",
          "action": "Replace the current generic fallback ('расширьте поиск на смежные рубрики/регионы') with a structured template: '1. ЧТО НАШЛОСЬ: [N confirmed candidates]. 2. ЧЕГО НЕ ХВАТАЕТ: [specific gap vs user request]. 3. КОНКРЕТНЫЙ СЛЕДУЮЩИЙ ШАГ: [one actionable step, not generic advice]. 4. СОХРАНЁННЫЕ КРИТЕРИИ: [list user criteria from all turns].' Add to system prompt: 'When results are fewer than requested, NEVER give gene…",
          "implementationHint": "Search for fallback or 'подтвержденных карточек меньше' pattern in the prompt/template files. This is the shortlist fallback template that triggers when confirmed_count < requested_count.",
          "expectedImpact": "Reduces generic fallback penalty across UV002, UV007, UV008, UV011, UV014, UV015",
          "risk": "Medium — needs testing to ensure the structured template doesn't cause verbosity issues",
          "effort": "S",
          "validationScenarios": [
            "UV002",
            "UV007",
            "UV011",
            "UV014"
          ]
        },
        {
          "id": "R4",
          "area": "prompt",
          "title": "Add multi-turn criteria persistence instruction",
          "action": "Add to system prompt: 'CRITERIA PERSISTENCE: Accumulate ALL user-specified criteria across turns (quality parameters, certifications, constraints, geographic filters). On every turn that produces a company list or shortlist, re-apply ALL accumulated criteria. If a criterion cannot be verified from catalog data, mark it as [не подтверждено в карточке — уточните у поставщика] but do NOT silently drop it.'",
          "implementationHint": "Same system prompt file as R2. Place after entity-tracking rule. Consider also adding a structured 'active_criteria' field to the conversation state if the architecture supports it.",
          "expectedImpact": "Fixes UV002 turn 3 (quality criteria dropped), UV006 (FSC/drying ignored), UV008 (30hp/attachments ignored)",
          "risk": "Low — additive instruction, unlikely to cause regression",
          "effort": "S",
          "validationScenarios": [
            "UV002",
            "UV006",
            "UV008"
          ]
        },
        {
          "id": "R5",
          "area": "retrieval",
          "title": "Implement company-name fuzzy search for unconfirmed entities",
          "action": "When a user asks about a specific company by name and no exact match exists, run a fuzzy/partial search across company names in the catalog (Levenshtein distance ≤ 3, or trigram similarity). Return top 3 candidates ranked by name similarity, instead of either (a) returning nothing, or (b) returning random catalog entries. If no candidates score above threshold, return 'company not found in catalog' with the EXACT us…",
          "implementationHint": "In the company search function (look for Meilisearch query builder or catalog search). Meilisearch supports typo tolerance natively — ensure it's enabled for company name field. Add a name-similarity reranking step.",
          "expectedImpact": "UV019-UV022 would find 'Ирис Интер групп' or honestly report not found, instead of returning random companies",
          "risk": "Medium — fuzzy search could surface false positives. Mitigate by requiring similarity > 0.6",
          "effort": "M",
          "validationScenarios": [
            "UV019",
            "UV020",
            "UV021",
            "UV022"
          ]
        },
        {
          "id": "R6",
          "area": "guardrails",
          "title": "Add tail-of-response noise guard to prevent random company injection",
          "action": "Multiple scenarios show irrelevant companies appended at the END of otherwise acceptable responses (UV003: Рыболов Магазин after café query, UV009: Сэльвин after dental query, UV011: military center). Add a post-generation check: if the last company mentioned in the response has a rubric that doesn't match the query intent, strip that trailing block. Alternatively, add prompt instruction: 'NEVER append a «Быстрый fi…",
          "implementationHint": "Search for 'first-pass' or 'Быстрый first-pass' in prompt templates. This appears to be an auto-appended catalog snippet. Either gate it behind a relevance check or remove the auto-append behavior entirely when the main response already co…",
          "expectedImpact": "Eliminates the 'random company at the end' pattern in UV003, UV009, UV011, UV021",
          "risk": "Low if prompt-based, medium if post-processing filter",
          "effort": "S",
          "validationScenarios": [
            "UV003",
            "UV009",
            "UV011"
          ]
        },
        {
          "id": "R7",
          "area": "retrieval",
          "title": "Expand candidate pool for sparse categories before giving up",
          "action": "For queries where confirmed candidates < requested count (UV001, UV008, UV015 with 1 candidate), automatically broaden the search in a structured way: (1) try parent rubric, (2) try adjacent regions, (3) try synonym rubrics. Present results with clear provenance labels: '[точное совпадение]' vs '[расширенный поиск: смежная рубрика]' vs '[расширенный поиск: соседний регион]'. This replaces the current behavior of rep…",
          "implementationHint": "In the search function, add a cascade: if results < requested_count, re-query with broader parameters. The rubric hierarchy likely exists in the catalog schema. Add region adjacency mapping (Минск → Минская область → вся Беларусь).",
          "expectedImpact": "UV001 (1 shoe manufacturer → potentially 3-5 with broader search), UV008/UV015 (1 tractor supplier → more with adjacent categories), UV007 (no buyers → some with broader rubrics)",
          "risk": "Medium — broader search may reduce precision. Mitigate with clear labeling.",
          "effort": "M",
          "validationScenarios": [
            "UV001",
            "UV008",
            "UV015",
            "UV007"
          ]
        },
        {
          "id": "R8",
          "area": "qa",
          "title": "Add anti-hallucination regression check for rubric-entity mismatch",
          "action": "Add a new QA check type 'rubric_relevance' that validates: for every /company/ link in the response, the company's actual rubric (from catalog) must be semantically related to the query topic. This catches the hospital-as-shoe-manufacturer and military-center-as-cobbler failures automatically.",
          "implementationHint": "In the QA check framework (app/qa/), add a new check that extracts /company/ slugs from responses, looks up their rubrics in the catalog, and validates relevance against the scenario's query intent tags.",
          "expectedImpact": "Automated detection of the most egregious failure mode, preventing regressions",
          "risk": "Low — read-only QA check, no production impact",
          "effort": "M",
          "validationScenarios": [
            "UV012",
            "UV011",
            "UV009",
            "UV003"
          ]
        }
      ],
      "testPlan": {
        "mustPassScenarios": [
          "UV012",
          "UV022",
          "UV019",
          "UV020",
          "UV021",
          "UV011",
          "UV007"
        ],
        "regressionSuites": [
          "scenarios.regressions.user-ideas-multistep-variants.json"
        ],
        "successMetrics": [
          "strict pass rate ≥ 100% (22/22) — currently 20/22",
          "kimi avg usefulness ≥ 3.2 — currently 2.818",
          "minimax avg usefulness ≥ 3.0 — currently 2.545",
          "kimi useful rate ≥ 0.7 — currently 0.5",
          "minimax useful rate ≥ 0.6 — currently 0.409",
          "zero scenarios with rubric-entity mismatch hallucinations",
          "zero scenarios with entity confusion (wrong company name in response)"
        ]
      }
    }
  ],
  "advisorWarnings": [],
  "consensus": {
    "topAreas": [
      {
        "area": "retrieval",
        "count": 5
      },
      {
        "area": "prompt",
        "count": 4
      },
      {
        "area": "guardrails",
        "count": 3
      },
      {
        "area": "ranking",
        "count": 1
      },
      {
        "area": "template",
        "count": 1
      },
      {
        "area": "geo",
        "count": 1
      },
      {
        "area": "qa",
        "count": 1
      }
    ],
    "recurringTitles": [
      {
        "title": "add rubric-based entity validation layer",
        "count": 1
      },
      {
        "title": "implement session-based conversation memory",
        "count": 1
      },
      {
        "title": "build website fetcher tool for llm",
        "count": 1
      },
      {
        "title": "add strict mode flag to system prompt",
        "count": 1
      },
      {
        "title": "implement result aggregation to meet count requirements",
        "count": 1
      },
      {
        "title": "create template parser for subject/body/whatsapp blocks",
        "count": 1
      },
      {
        "title": "add hallucination detection for company names",
        "count": 1
      },
      {
        "title": "fix geo disambiguation for minsk districts",
        "count": 1
      },
      {
        "title": "add hard rubric-level anti-noise filter with category cross-validation",
        "count": 1
      },
      {
        "title": "add explicit entity-tracking instruction in system prompt for multi-turn",
        "count": 1
      },
      {
        "title": "replace generic fallback template with structured sparse-data template",
        "count": 1
      },
      {
        "title": "add multi-turn criteria persistence instruction",
        "count": 1
      }
    ]
  }
}
