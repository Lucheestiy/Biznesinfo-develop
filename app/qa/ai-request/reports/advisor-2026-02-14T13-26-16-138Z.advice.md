# Advisor Report — advisor-2026-02-14T13-26-16-138Z

- Generated: 2026-02-14T13:27:39.699Z
- QA report: /home/mlweb/biznesinfo-develop.lucheestiy.com/app/qa/ai-request/reports/latest.json
- Judge report: /home/mlweb/biznesinfo-develop.lucheestiy.com/app/qa/ai-request/reports/latest.usefulness.json
- Focus scenarios: 20
- Advisors: kimi, minimax

## Focus Scenarios

- UV022 (fail, usefulness 0.5/5): Ирис Интер групп: явный поиск -> последние новости с сайта (без запроса URL)
- UV006 (fail, usefulness 2/5): Лес на экспорт: условия качества + логистика + RFQ
- UV017 (fail, usefulness 2/5): Свекла 500 кг в Минске: защита от нерелевантных "не-поставщиков"
- UV019 (pass, usefulness 0/5): Ирис Интер групп: запрос последних новостей без требования ссылки от пользователя
- UV020 (pass, usefulness 0/5): Ирис Интер групп: команда «Найди на карточке компании» без запроса ссылки у пользователя
- UV021 (pass, usefulness 0.5/5): Ирис Интер групп: консистентность между «нашел компанию» и «проверь на карточке»
- UV011 (pass, usefulness 1/5): No-results ветка: сверхузкий запрос на производителей обуви
- UV008 (pass, usefulness 1.5/5): Белорусский минитрактор: покупка + критерии + сравнение
- UV012 (pass, usefulness 1.5/5): Проверка по сайтам компаний: источник + контакты + честная пометка подтверждения
- UV001 (pass, usefulness 2/5): Производители обуви в Минске: уточнение типа + shortlist + шаблон контакта
- UV003 (pass, usefulness 2/5): Где поблизости вкусно поесть: consumer запрос -> b2b переформулировка
- UV004 (pass, usefulness 2.5/5): Белорусские соковыжималки: заводы -> OEM/ODM -> shortlist -> RFQ
- UV013 (pass, usefulness 2.5/5): Deep website-scan: внутренняя навигация сайта (контакты/о компании/продукция)
- UV014 (pass, usefulness 2.5/5): Reverse-buyer вариативный: пищевая тара -> целевые сегменты -> shortlist без общих советов
- UV015 (pass, usefulness 2.5/5): Вариант по минитракторам: покупка -> сравнение условий -> запрос для звонка
- UV002 (pass, usefulness 3/5): Заводы муки: Беларусь -> качество -> экспортные документы -> shortlist
- UV007 (pass, usefulness 3.5/5): Найти потенциальных заказчиков моей продукции: reverse поиск + shortlist
- UV009 (pass, usefulness 3.5/5): Стоматология с микроскопом в Минске: сложный consumer кейс + полезный fallback
- UV005 (pass, usefulness 4/5): Экспортеры пищевой промышленности: сегментация по рынкам и продукту
- UV010 (pass, usefulness 4.5/5): Не помню точный бренд молочной компании: гипотезы + проверка + уточнение

## Consensus

- Top areas:
  - prompt: 5
  - retrieval: 4
  - guardrails: 3
  - template: 1
  - ranking: 1
- Recurring recommendations:
  - inject company_id context anchor в system prompt (1)
  - add constraint-memory check before fallback questions (1)
  - implement fuzzy company name search with confirmation (1)
  - enforce shortlist count in output validation (1)
  - add anti-link-gate instruction for website lookups (1)
  - fix placeholder leakage in shortlist responses (1)
  - improve category filtering for b2b vs consumer (1)
  - add relevance scoring threshold for search results (1)
  - add explicit constraint echo in system prompt (1)
  - add entity confirmation gate before fallback (1)
  - remove placeholder generation from shortlist template (1)
  - implement verification commitment tracking (1)

## kimi

- Summary: QA показывает 86% pass rate по strict-checks, но критический провал по usefulness (средний 2.3/5). Главная проблема — «context amnesia» в multi-turn диалогах: ассистент теряет идентификацию компании (Ирис Интер групп → случайные компании), сбрасывается к generic fallback после конкретных уточнений (UV006, UV017), и не выполняет прямые команды «найди на карточке». Рекомендации фокусируются на: (1) hardening контекста компании, (2) anti-fallback guardrails, (3) исправлении retrieval для конкретных имён.

### Priority Plan

- P0 — Fix company context carryover in multi-turn
  why: UV019-UV022 (Ирис Интер групп) — полный провал: ассистент не находит компанию и выдаёт случайные кандидаты из каталога. Это критический UX failure.
  impact: Устранение 4 failed сценариев, повышение usefulRate с 0% до 80%+
  validate: UV019, UV020, UV021, UV022
- P0 — Add anti-fallback guardrails after user constraints
  why: UV006, UV017: после конкретных уточнений ассистент спрашивает «а что вы ищете?». Нарушает логику диалога.
  impact: Устранение context reset, повышение continuity score
  validate: UV006, UV017
- P1 — Implement company name resolution hardening
  why: UV019-022: «Ирис Интер групп» не резолвится в company_id. Нужен fuzzy search + confirmation flow.
  impact: Корректная идентификация компаний по нечётким названиям
  validate: UV019, UV020, UV021, UV022
- P1 — Enforce shortlist size constraints
  why: UV001, UV004, UV008: запрос 3-5 кандидатов → выдача 1 или generic fallback. Нужен strict output validation.
  impact: Соответствие explicit user constraints
  validate: UV001, UV004, UV008
- P2 — Add website verification promise tracking
  why: UV012, UV013: ассистент обещает «проверю сайт» но не делает. Нужен tool-use tracking.
  impact: Честная коммуникация о capabilities
  validate: UV012, UV013

### Recommendations

- [R1] (prompt, effort S) Inject company_id context anchor в system prompt
  action: Добавить в system prompt: «Если в предыдущих ходах была идентифицирована компания с company_id — ты ОБЯЗАН использовать эту компанию во всех последующих ходах. Запрещено переключаться на другие компании без explicit запроса пользователя.»
  hint: src/prompts/system.ts — добавить в COMPANY_CONTEXT_RULES
  impact: Устранение UV019-022 — полная потеря контекста компании
  risk: Минимальный — явное правило не создаёт ложных срабатываний
  validate: UV019, UV020, UV021, UV022
- [R2] (guardrails, effort M) Add constraint-memory check before fallback questions
  action: Добавить guardrail: перед тем как задать уточняющий вопрос «что вы ищете?», проверить conversation history на наличие constraints (продукт, регион, объём). Если constraints найдены — запрещено задавать generic вопросы.
  hint: src/guardrails/constraint-memory.ts + интеграция в message handler перед response generation
  impact: Устранение UV006.T3, UV017.T2 — context reset после конкретных уточнений
  risk: Может снизить «helpfulness» если constraints действительно недостаточны — нужен threshold
  validate: UV006, UV017
- [R3] (retrieval, effort M) Implement fuzzy company name search with confirmation
  action: Для запросов с названием компании (pattern: «[Название]» без /company/...): выполнять fuzzy search по company name index, возвращать top-3 candidates с confidence score, запрашивать explicit confirmation перед использованием.
  hint: src/retrieval/company-search.ts — добавить fuzzyMatching({ threshold: 0.7, maxCandidates: 3 })
  impact: Устранение UV019-022 — неверная идентификация «Ирис Интер групп»
  risk: Дополнительный latency на search + confirmation turn
  validate: UV019, UV020, UV021, UV022
- [R4] (guardrails, effort S) Enforce shortlist count in output validation
  action: Добавить post-generation validator: если user запросил «3-5 кандидатов» или «shortlist N» — проверить, что в ответе ровно N ссылок /company/... Если невозможно найти N — выдать честный fallback «Нашёл только X, вот они: ...» вместо generic advice.
  hint: src/validators/shortlist-validator.ts — regex count /company/ links, сравнить с requested count
  impact: Устранение UV001, UV004, UV008 — невыполнение explicit constraints
  risk: Минимальный — strict compliance с user request
  validate: UV001, UV004, UV008
- [R5] (prompt, effort S) Add anti-link-gate instruction for website lookups
  action: В system prompt добавить: «Если пользователь просит найти информацию на сайте компании — ты должен сам найти company card, извлечь website URL, и выполнить lookup. Запрещено просить пользователя 'пришлите ссылку'.»
  hint: src/prompts/system.ts — раздел WEBSITE_LOOKUP_RULES
  impact: Устранение UV022.T1, UV019.T1 — отказ от поиска с просьбой «пришлите ссылку»
  risk: Минимальный — соответствует ожиданиям пользователя
  validate: UV019, UV022
- [R6] (template, effort S) Fix placeholder leakage in shortlist responses
  action: Запретить использование placeholder'ов типа «[проверьте данные]» в финальных ответах. Если данных нет — явно написать «Данные о [X] отсутствуют в карточке».
  hint: src/templates/shortlist.ts — post-process: replace /\[.*проверьте.*\]/gi с флагом на review
  impact: Устранение UV002.T3, UV014.T3 — placeholder'ы вместо данных
  risk: Минимальный — улучшение UX
  validate: UV002, UV014
- [R7] (retrieval, effort M) Improve category filtering for B2B vs consumer
  action: Добавить category classifier: если запрос содержит consumer-паттерны («где поесть», «вкусно», «поблизости») — приоритизировать B2B reframe или честный fallback вместо случайных B2B результатов.
  hint: src/retrieval/query-rewriter.ts — добавить intent classifier (consumer|b2b|ambiguous)
  impact: Устранение UV003.T2 — нерелевантные B2B результаты на consumer запрос
  risk: Может переусложнить — нужен A/B
  validate: UV003
- [R8] (ranking, effort M) Add relevance scoring threshold for search results
  action: Ввести минимальный relevance score (например, 0.6) для включения результата в shortlist. Если ни один результат не проходит threshold — выдавать «no results» fallback вместо нерелевантных компаний.
  hint: src/ranking/relevance-filter.ts — интеграция с search pipeline
  impact: Устранение UV011.T3 — Центральный Дом офицеров как «производитель обуви»
  risk: Может снизить recall — нужен tuning threshold
  validate: UV011

## minimax

- Summary: The Biznesinfo assistant has three critical failure modes causing 86% pass rate but only 36% useful rate: (1) Context amnesia across turns where specific user constraints are ignored, (2) Generic fallback paralysis where the assistant asks users to repeat already-provided criteria instead of making sourcing decisions, and (3) Company identification failures where wrong entities are returned and hallucinated. Fix the context retention layer and add disambiguation guards for catalog navigation.

### Priority Plan

- P0 — Fix context retention across conversation turns
  why: Multiple scenarios fail because assistant loses user-provided constraints between turns (UV006, UV017, UV022). Users must not repeat criteria they've already given.
  impact: Eliminate 'generic fallback after specific constraints' pattern - affects 6 of 12 failed judge evaluations
  validate: UV006.T3, UV017.T2, UV022.T2
- P0 — Add company entity grounding guardrails
  why: Assistant returns wrong companies (UV019: Del Media instead of Iris Inter Group, UV012: Playmoda underwear instead of shoe manufacturer) - complete hallucination of target entity
  impact: Prevent hallucinated company matches in 4+ scenarios
  validate: UV019.T1, UV020.T1, UV021.T1, UV012.T1
- P1 — Replace [проверьте данные] placeholders with real data or explicit 'no data'
  why: Turn 3 responses contain placeholder text that signals low effort and fails user expectations (UV002, UV014)
  impact: Improve perceived helpfulness from generic to concrete in shortlist scenarios
  validate: UV002.T3, UV014.T3
- P1 — Enforce website verification commitment
  why: Assistant promises verification then deflects (UV012, UV013). Users explicitly request verification but receive templates instead of confirmed data
  impact: Eliminate 'verification promise without fulfillment' pattern
  validate: UV012.T2, UV013.T2

### Recommendations

- [R1] (prompt, effort S) Add explicit constraint echo in system prompt
  action: Add to assistant system prompt: 'Before responding in Turn N, explicitly echo the constraints the user provided in Turns 1..N-1. Never ask for criteria the user has already specified.'
  hint: app/src/prompts/assistant-system.md or similar - add constraint_carryover rule
  impact: Prevents amnesia pattern in UV006, UV017, UV022, UV003
  risk: Low - defensive behavior only
  validate: UV006.T3, UV017.T2
- [R2] (retrieval, effort M) Add entity confirmation gate before fallback
  action: Before generic catalog navigation fallback, require explicit entity confirmation: 'Before suggesting catalog categories, confirm: what exact company name did I find? If name mismatch, show top 3 candidates with names matching user's entity.'
  hint: app/src/app/api/ai/request/route.ts - add entity_match_validation in fallback logic
  impact: Prevents wrong company hallucinations in UV019, UV020, UV021
  risk: Low - adds safety check
  validate: UV019.T1, UV020.T1
- [R3] (prompt, effort S) Remove placeholder generation from shortlist template
  action: Replace shortlist template that generates [проверьте данные] with explicit 'Data unavailable in current catalog slice' plus actionable next step (e.g., 'Request data during call: price, MOQ, lead time')
  hint: app/src/templates/supplier-shortlist.md - replace placeholder with unavailable_data block
  impact: Eliminates placeholder spam in UV002, UV014
  risk: Low - improves clarity
  validate: UV002.T3, UV014.T3
- [R4] (retrieval, effort M) Implement verification commitment tracking
  action: Track verification promises to user. If verification was promised but not completed, surface as explicit TODO in next turn: 'Verification incomplete - continue or acknowledge limitation?'
  hint: AssistantClient.tsx - add verification_state tracking in conversation context
  impact: Prevents verification deferral in UV012, UV013
  risk: Medium - requires state tracking
  validate: UV012.T2, UV013.T2
- [R5] (prompt, effort M) Add rubric category vs product match validation
  action: When returning a company, include automatic relevance check: 'Company A returned from rubric X - does rubric X match user's product query? If no, flag as potential mismatch and ask user to confirm before presenting.'
  hint: app/src/retrieval/company-matcher.ts - add category_product_alignment_check
  impact: Prevents Playmoda (underwear) returned for shoe query, Central House of Officers as shoe manufacturer
  risk: Low - defensive filter
  validate: UV012.T1, UV011.T3
- [R6] (guardrails, effort M) Add consumer-to-b2b explicit escalation guard
  action: When user asks consumer query (restaurants, dentistry), before B2B pivot, explicitly surface: 'This appears to be a personal question. Convert to B2B context? (yes/no)'
  hint: app/src/intent/classifier.ts - add consumer_query_detection and b2b_escalation_gate
  impact: Prevents inappropriate B2B pivot in UV003 (restaurant → office suppliers)
  risk: Low - adds explicit confirmation
  validate: UV003.T2

