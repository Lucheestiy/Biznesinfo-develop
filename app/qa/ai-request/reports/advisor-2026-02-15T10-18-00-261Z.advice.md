# Advisor Report — advisor-2026-02-15T10-18-00-261Z

- Generated: 2026-02-15T10:22:23.675Z
- QA report: /home/mlweb/biznesinfo-develop.lucheestiy.com/app/qa/ai-request/reports/latest.json
- Judge report: /home/mlweb/biznesinfo-develop.lucheestiy.com/app/qa/ai-request/reports/latest.usefulness.json
- Focus scenarios: 20
- Advisors: kimi, minimax

## Focus Scenarios

- UV022 (fail, usefulness 0/5): Ирис Интер групп: явный поиск -> последние новости с сайта (без запроса URL)
- UV012 (fail, usefulness 0.5/5): Проверка по сайтам компаний: источник + контакты + честная пометка подтверждения
- UV003 (fail, usefulness 1/5): Где поблизости вкусно поесть: consumer запрос -> b2b переформулировка
- UV002 (fail, usefulness 2/5): Заводы муки: Беларусь -> качество -> экспортные документы -> shortlist
- UV009 (fail, usefulness 2/5): Стоматология с микроскопом в Минске: сложный consumer кейс + полезный fallback
- UV015 (fail, usefulness 2/5): Вариант по минитракторам: покупка -> сравнение условий -> запрос для звонка
- UV004 (fail, usefulness 2.5/5): Белорусские соковыжималки: заводы -> OEM/ODM -> shortlist -> RFQ
- UV014 (fail, usefulness 3/5): Reverse-buyer вариативный: пищевая тара -> целевые сегменты -> shortlist без общих советов
- UV019 (pass, usefulness 0/5): Ирис Интер групп: запрос последних новостей без требования ссылки от пользователя
- UV020 (pass, usefulness 0/5): Ирис Интер групп: команда «Найди на карточке компании» без запроса ссылки у пользователя
- UV021 (pass, usefulness 0.5/5): Ирис Интер групп: консистентность между «нашел компанию» и «проверь на карточке»
- UV001 (pass, usefulness 1/5): Производители обуви в Минске: уточнение типа + shortlist + шаблон контакта
- UV011 (pass, usefulness 1/5): No-results ветка: сверхузкий запрос на производителей обуви
- UV007 (pass, usefulness 1.5/5): Найти потенциальных заказчиков моей продукции: reverse поиск + shortlist
- UV008 (pass, usefulness 1.5/5): Белорусский минитрактор: покупка + критерии + сравнение
- UV017 (pass, usefulness 1.5/5): Свекла 500 кг в Минске: защита от нерелевантных "не-поставщиков"
- UV005 (pass, usefulness 2/5): Экспортеры пищевой промышленности: сегментация по рынкам и продукту
- UV006 (pass, usefulness 2/5): Лес на экспорт: условия качества + логистика + RFQ
- UV013 (pass, usefulness 2/5): Deep website-scan: внутренняя навигация сайта (контакты/о компании/продукция)
- UV016 (pass, usefulness 2/5): Вариативный экспорт муки: shortlist + документная проверка + шаблон запроса

## Consensus

- Top areas:
  - prompt: 6
  - retrieval: 5
  - guardrails: 3
  - template: 2
  - ranking: 1
  - ui: 1
- Recurring recommendations:
  - добавить explicit company name memory в system prompt (1)
  - запретить output с placeholder 'уточняется' (1)
  - улучшить exact name matching в company search (1)
  - добавить category relevance filter (1)
  - улучшить template generation prompt с explicit parameter extraction (1)
  - добавить diversification для multi-candidate requests (1)
  - добавить explicit format adherence instruction (1)
  - добавить self-correction loop для website lookups (1)
  - добавить explicit 'context lost' signal в ui (1)
  - добавить quality criteria extraction для специфических запросов (1)
  - add template slot validation pre-output gate (1)
  - add explicit company context carrier rules to system prompt (1)

## kimi

- Summary: Система Biznesinfo демонстрирует критическую неспособность сохранять контекст между ходами диалога (особенно UV019-UV022), шаблонный fallback вместо конкретных ответов (UV001, UV004, UV006, UV016), и галлюцинацию поисковых результатов (UV012, UV003). Основные проблемы: 1) Потеря контекста компании при переходе к веб-сканированию; 2) Заполнение шаблонов placeholder'ами вместо реальных данных из диалога; 3) Невозможность найти конкретную компанию по точному названию. Pass rate 63.6% ниже целевого 80%.

### Priority Plan

- P0 — Исправить context carryover для company lookups (UV019-UV022)
  why: Полная потеря контекста 'Ирис Интер групп' — 4 сценария с usefulness=0. Система не может сохранить название компании между ходами.
  impact: Поднимет usefulness с 0 до 3+ для 4 сценариев, устранит критические галлюцинации
  validate: UV019, UV020, UV021, UV022
- P0 — Запретить placeholder fallback в шаблонах (UV001, UV004, UV006, UV016)
  why: Шаблоны заполняются 'уточняется' вместо реальных параметров из диалога — делает вывод непригодным для использования
  impact: Устранит broken RFQ/outreach шаблоны, повысит usefulness на 1-2 пункта
  validate: UV001, UV004, UV006, UV016
- P1 — Улучшить strict company name search (UV012, UV022)
  why: Точное название 'Ирис Интер групп' не находится — система возвращает случайные компании вместо честного 'не найдено'
  impact: Устранит галлюцинации поиска, даст пользователю честный ответ
  validate: UV012, UV022
- P1 — Добавить guardrail против irrelevant category results (UV003, UV012, UV017)
  why: Детская поликлиника в выдаче обувных производителей, сантехника вместо ресторанов — критические ошибки релевантности
  impact: Снизит rate нерелевантных результатов, повысит доверие
  validate: UV003, UV012, UV017
- P2 — Улучшить multi-candidate retrieval (UV001, UV008, UV015)
  why: Повтор одной компании 3+ раза вместо поиска альтернатив — система не умеет добирать кандидатов
  impact: Увеличит diversity выдачи, позволит сравнения
  validate: UV001, UV008, UV015

### Recommendations

- [R1] (prompt, effort S) Добавить explicit company name memory в system prompt
  action: В system prompt добавить инструкцию: 'Если пользователь упоминает конкретное название компании — сохрани его в <current_company> и используй во всех последующих ходах. При запросе "новости на сайте" или "найди на карточке" — работай ТОЛЬКО с этой компанией.'
  hint: src/lib/ai/prompts/system-prompt.ts — добавить в baseSystemPrompt секцию CONTEXT_MEMORY
  impact: Устранит потерю контекста UV019-UV022, повысит usefulness с 0 до 3
  risk: Низкий — только добавление инструкции
  validate: UV019, UV020, UV021, UV022
- [R2] (guardrails, effort M) Запретить output с placeholder 'уточняется'
  action: Добавить post-processing guardrail: если ответ содержит 'уточняется' более 2 раз — reject и запросить re-generation с требованием использовать реальные данные из контекста или честно признать отсутствие данных
  hint: src/lib/ai/guardrails/template-validator.ts — новый guardrail на placeholder detection
  impact: Устранит broken шаблоны UV001/UV004/UV006/UV016
  risk: Может увеличить latency на re-generation
  validate: UV001, UV004, UV006, UV016
- [R3] (retrieval, effort M) Улучшить exact name matching в company search
  action: Добавить приоритет exact match по полю name в Meilisearch перед fuzzy search. Если exact match не дает результатов — явно сообщать 'Компания "X" не найдена в каталоге' вместо возврата случайных результатов
  hint: src/lib/search/company-search.ts — модифицировать buildSearchQuery для exact match boost
  impact: Устранит галлюцинации UV012/UV022, даст честный no-results
  risk: Может снизить recall для опечаток
  validate: UV012, UV022
- [R4] (ranking, effort M) Добавить category relevance filter
  action: При поиске по рубрике проверять соответствие найденных компаний запрошенной категории. Если рубрика компании не совпадает — отфильтровывать или помечать как 'возможно нерелевантно'
  hint: src/lib/search/ranking.ts — добавить category-mismatch penalty в scoring function
  impact: Устранит поликлиники в обуви (UV012), сантехнику в ресторанах (UV003)
  risk: Может отфильтровать legit multi-category компании
  validate: UV003, UV012, UV017
- [R5] (prompt, effort S) Улучшить template generation prompt с explicit parameter extraction
  action: В prompt для генерации шаблонов добавить: 'Извлеки из истории диалога: продукт, объем, локацию, срок. Если параметр не указан — используй [укажите X] вместо [уточняется]. НЕ используй placeholder если данные есть в контексте.'
  hint: src/lib/ai/prompts/template-prompt.ts — модифицировать TEMPLATE_GENERATION_PROMPT
  impact: Шаблоны будут содержать реальные данные из диалога
  risk: Низкий — улучшение существующего prompt
  validate: UV001, UV004, UV017
- [R6] (retrieval, effort M) Добавить diversification для multi-candidate requests
  action: При запросе 'дай 3-5 вариантов' — использовать diverse retrieval: после нахождения первого кандидата, искать следующего с исключением уже найденных (negative filtering по ID)
  hint: src/lib/search/company-search.ts — добавить excludeIds parameter и loop для N candidates
  impact: Устранит повтор одной компании UV001, даст реальные альтернативы
  risk: Может вернуть менее релевантных кандидатов ради diversity
  validate: UV001, UV008, UV015
- [R7] (prompt, effort S) Добавить explicit format adherence instruction
  action: В prompt добавить: 'Если пользователь просит чеклист — верни нумерованный список. Если shortlist — верни список компаний с /company ссылками. НЕ заменяй запрошенный формат на ranking компаний.'
  hint: src/lib/ai/prompts/system-prompt.ts — добавить FORMAT_ADHERENCE section
  impact: Устранит несоответствие формату UV002.T4 (чеклист вместо ranking)
  risk: Низкий — clarifying instruction
  validate: UV002, UV009
- [R8] (guardrails, effort M) Добавить self-correction loop для website lookups
  action: Если website lookup возвращает данные о другой компании (не той, что в контексте) — detect mismatch по названию и retry с explicit company name в query
  hint: src/lib/ai/tools/website-scanner.ts — добавить company name verification в результате
  impact: Устранит случайные компании в UV019-UV022 при website scan
  risk: Может увеличить latency
  validate: UV019, UV020, UV021, UV022
- [R9] (ui, effort M) Добавить explicit 'context lost' signal в UI
  action: Если система обнаруживает potential context loss (запрос про X, но в истории обсуждали Y) — показывать warning: 'Вы сейчас спрашиваете про [X], ранее обсуждали [Y]. Уточните, пожалуйста, о какой компании идет речь?'
  hint: src/components/chat/ContextWarning.tsx — новый компонент, интеграция в MessageList
  impact: Позволит пользователю корректировать до полной галлюцинации
  risk: Может раздражать при legit topic switch
  validate: UV019, UV020, UV021, UV022
- [R10] (retrieval, effort L) Добавить quality criteria extraction для специфических запросов
  action: Для запросов с критериями качества (белизна, клейковина, FSC, MOQ) — добавить explicit extraction в prompt и требовать ответа по каждому критерию или честного 'данные не найдены'
  hint: src/lib/ai/prompts/quality-analysis-prompt.ts — новый prompt для quality criteria
  impact: Устранит generic fallback UV002.T2 (качество муки), улучшит полезность
  risk: Требует поддержки новых критериев для каждой индустрии
  validate: UV002, UV006

## minimax

- Summary: Biznesinfo assistant has three critical failure patterns: (1) template generation outputs placeholder garbage ('уточняется') instead of real data, (2) company context loss in multi-turn conversations causing completely irrelevant results, and (3) generic fallback loops that never deliver requested comparisons/checklists. Fixing these requires: (a) mandatory slot validation before template output, (b) explicit context carrier rules for company names across turns, and (c) turn-level constraint delivery gates that fail fast when data is missing.

### Priority Plan

- P0 — Fix template placeholder garbage output
  why: 8+ scenarios fail because templates contain 'уточняется' instead of real data (UV001, UV004, UV006, UV016). This makes templates unusable and generates 'not_useful' verdicts.
  impact: Strict pass rate improvement from 64% to 80%+. Judge usefulness scores should increase by 0.5-1.0 per affected scenario.
  validate: UV001, UV004, UV006, UV016, UV002, UV007
- P0 — Add company context carrier rules
  why: Scenarios UV019-UV021 show complete context loss of 'Ирис Интер групп' across turns, resulting in 0 usefulness scores. Assistant returns random companies instead of requested one.
  impact: Eliminate 0-usefulness failures for company lookup scenarios. Restore context continuity for multi-turn company research.
  validate: UV019, UV020, UV021, UV022
- P1 — Implement comparison/checklist delivery gates
  why: UV002, UV015, UV009 fail to deliver requested formats (checklist, comparison table). Users get generic 'expand search' fallback instead of structured output.
  impact: Pass rate improvement for numbered_list_min and includes_any checks. Reduce generic fallback usage by 60%.
  validate: UV002, UV015, UV009, UV003
- P1 — Fix result count delivery for multi-candidate requests
  why: UV015, UV008, UV001 deliver 1 company when 3+ requested. Platform limitations exposed - no graceful degradation or honest fallback.
  impact: Honest handling of platform data gaps. Clearer communication when insufficient candidates exist.
  validate: UV015, UV008, UV001, UV011

### Recommendations

- [R1] (template, effort S) Add template slot validation pre-output gate
  action: Before outputting any template (Subject/Body/WhatsApp), validate that all placeholders are replaced with actual values. If any slot is empty, fail with explicit 'cannot generate template' message instead of outputting garbage.
  hint: app/src/app/api/ai/request/route.ts - Add template_slot_validator() function called before response generation. Check for patterns like 'уточняется', 'к с', 'к меньше', 'к основному' in output strings.
  impact: Eliminates placeholder garbage in UV001, UV004, UV006, UV007, UV016, UV017. Expected strict pass rate +15%.
  risk: Low - defensive validation, never reduces quality
  validate: UV001, UV004, UV006, UV016
- [R2] (prompt, effort S) Add explicit company context carrier rules to system prompt
  action: Add rule: 'When a company name is mentioned in ANY previous turn, it MUST appear in ALL subsequent responses unless user explicitly changes topic. If you cannot find data for that company, explicitly state: "I could not find data for [COMPANY] in the catalog" instead of returning unrelated companies.'
  hint: System prompt file - add CONTEXT_CARRIER_RULES section with company name carryover enforcement. Test by requiring [COMPANY] token in responses.
  impact: Fixes context loss in UV019-UV022 (0-usefulness scenarios). Expected improvement from 0 to 2+ usefulness.
  risk: Medium - changes response behavior, requires monitoring
  validate: UV019, UV020, UV021, UV022
- [R3] (guardrails, effort M) Implement 'irrelevant result detector' for category mismatches
  action: Add post-search validation: if search results contain companies from fundamentally wrong categories (e.g., dental search returns chemical company, shoe search returns polyclinic), trigger NO_RESULTS_FALLBACK instead of returning irrelevant results. Categories to check: footwear↔medical, dentistry↔chemicals, tractors↔spare_parts, food_packaging↔forklifts.
  hint: app/src/app/api/ai/request/route.ts - Add irrelevant_result_guard() function called after search. Check category names in results against user intent keywords.
  impact: Prevents embarrassing mismatches in UV009 (dental→chemicals), UV017 (beet→parts), UV007 (packaging→forklifts).
  risk: Medium - may reject valid results, requires tuning
  validate: UV009, UV017, UV007, UV008
- [R4] (prompt, effort S) Add checklist/document delivery turn gates
  action: Add rule: 'When user requests a checklist or numbered items (e.g., "чек из 6 пунктов", "сравни по 4 критериям"), you MUST deliver the format in the SAME turn. Generic fallback "expand search" or repeating shortlist violates this rule.'
  hint: system prompt - add FORMAT_DELIVERY_RULES section with specific attention to numbered_list_min checks. Map user intent patterns to required output format.
  impact: Fixes UV002.T4, UV009.T3, UV015.T2 checklist/comparison failures. Expected +20% pass rate for numbered checks.
  risk: Low - clarifies existing expectations
  validate: UV002, UV009, UV015, UV003
- [R5] (retrieval, effort S) Add candidate count delivery validation
  action: After search, validate: if user requests N candidates and you found < N/2, trigger explicit 'insufficient candidates' message instead of presenting inadequate list. Message should: (1) state found count vs requested, (2) explain why (catalog gaps, narrow criteria), (3) offer specific expansion paths.
  hint: app/src/app/api/ai/request/route.ts - Add candidate_count_validator() function after search. Use UV015, UV008, UV001 as test cases.
  impact: Honest handling of data gaps. Prevents presentation of 1 company as 'shortlist of 3'.
  risk: Low - improves transparency
  validate: UV015, UV008, UV001, UV011
- [R6] (prompt, effort S) Add OEM/ODM relevance checking
  action: When user asks about OEM/ODM capabilities for specific factories, system prompt should enforce: 'Only suggest companies that could plausibly offer OEM/ODM. Major consumer brands (Horizont, Atlant, Brestgazoapparat) are unlikely OEM suppliers - do not include them unless you have specific evidence.'
  hint: system prompt - Add OEM_ODM_GUIDANCE section. Cross-reference with UV004 judge feedback about irrelevant company suggestions.
  impact: Improves UV004 relevance and reduces generic fallback in OEM discussions.
  risk: Low - guidance clarification
  validate: UV004
- [R7] (template, effort S) Add document checklist template with fixed structure
  action: Create document_checklist_template() function that outputs numbered list in format: '1. [Document Name] - [Purpose] - [What to verify]'. Pre-populate with actual export documents (certificate of origin, phytosanitary, quality certificate, contract, invoice, packing list). Do not output if no companies selected.
  hint: app/src/app/api/ai/request/route.ts - Add document_checklist_template() with hardcoded BY export document list. Call when user requests 'документы' or 'чеклист' after company selection.
  impact: Fixes UV002.T4, UV012.T2 document checklist failures. Delivers 6+ items as requested.
  risk: Low - template improvement
  validate: UV002, UV012
- [R8] (retrieval, effort S) Add quality criteria extraction for commodity searches
  action: When user asks about commodity quality (flour whiteness, grain gluten, timber FSC), system should extract and acknowledge these criteria explicitly before search. If criteria cannot be matched to catalog fields, state: 'Catalog does not contain quality specifications for [COMMODITY]. Results are based on company profiles only.'
  hint: app/src/app/api/ai/request/route.ts - Add quality_criteria_extractor() function. Use UV002 (flour quality) and UV006 (timber FSC) as test patterns.
  impact: Honest handling of missing quality data. Reduces judge criticism for not addressing criteria.
  risk: Low - improves transparency
  validate: UV002, UV006

