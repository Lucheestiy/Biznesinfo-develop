```json
{
  "advisor": "gemini",
  "executiveSummary": "Ассистент Biznesinfo демонстрирует критические недочеты в обработке географических уточнений с отрицанием, что приводит к провалу в ключевых сценариях QA. Наблюдаются проблемы с консистентностью гео-фильтров, релевантностью начальных результатов и детализацией советов. Приоритетные меры включают улучшение логики гео-парсинга и явное подтверждение изменений фильтров.",
  "priorityPlan": [
    {
      "priority": "P0",
      "title": "Исправить конфликт регионального уточнения (GA002)",
      "why": "Сценарий GA002 провален из-за некорректной обработки уточнения 'Минская область, не сам город Минск', что приводит к неправильному гео-фильтру. Это прямая ошибка, влияющая на strictPass и показатель прохождения QA.",
      "expectedImpact": "Прямое решение проблемы GA002, повышение passRate QA, улучшение точности гео-фильтрации.",
      "validationScenarios": [
        "GA002"
      ]
    },
    {
      "priority": "P1",
      "title": "Улучшить адаптацию к гео-уточнениям и непрерывность диалога",
      "why": "Судья Kimi отмечает нарушения Continuity и generic fallback после уточнений гео, что снижает полезность. Ассистент не всегда корректно применяет новые гео-фильтры или возвращается к старым данным.",
      "expectedImpact": "Повышение полезности ответов (averageUsefulness), улучшение пользовательского опыта, более точные и релевантные ответы после гео-уточнений.",
      "validationScenarios": [
        "GA002"
      ]
    },
    {
      "priority": "P1",
      "title": "Повысить релевантность и полноту начальных шортлистов",
      "why": "Судья Kimi указывает на нерелевантные компании в первом шортлисте, а Minimax отмечает нехватку кандидатов. Это снижает доверие к ассистенту с первого взаимодействия.",
      "expectedImpact": "Увеличение usefulRate и averageUsefulness, улучшение качества первых предложений, более полное представление данных.",
      "validationScenarios": [
        "GA002",
        "GA001"
      ]
    }
  ],
  "recommendations": [
    {
      "id": "R1",
      "area": "retrieval",
      "title": "Улучшить логику гео-парсинга для исключающих условий",
      "action": "Пересмотреть и доработать модуль гео-парсинга для обработки уточнений, содержащих отрицания (например, 'не сам город N'). Необходимо обеспечить, чтобы при указании региона и исключении города в этом регионе, поисковый фильтр корректно отражал это исключение. Возможно, потребуется использовать более сложный NLP-подход для идентификации исключающих фраз и их применения к гео-фильтрам.",
      "implementationHint": "Проанализировать функцию, отвечающую за извлечение географических сущностей и применение фильтров. Возможно, в `app/src/lib/geo-utils.ts` или аналогичном файле. Необходимо отладить обработку 'не сам город N' так, чтобы 'N' исключался, но регион сохранялся.",
      "expectedImpact": "Прямое решение причины провала GA002, повышение точности гео-фильтрации, снижение ложноотрицательных результатов в strict-check.",
      "risk": "Medium (изменения в гео-парсинге могут повлиять на другие сценарии, требуются дополнительные регрессионные тесты).",
      "effort": "M",
      "validationScenarios": [
        "GA002"
      ]
    },
    {
      "id": "R2",
      "area": "prompt",
      "title": "Добавить явное подтверждение изменения гео-фильтра",
      "action": "После того как пользователь уточняет географический охват (например, меняет город на область или исключает город), ассистент должен явно подтвердить новый применяемый гео-фильтр перед представлением результатов. Это поможет пользователю убедиться, что его уточнение было понято правильно.",
      "implementationHint": "Модифицировать логику формирования ответа в файлах, отвечающих за генерацию сообщения после обновления контекста (например, `app/src/app/api/assistant/route.ts` или связанные с ним промпт-шаблоны). Добавить фразу вроде 'Принято, теперь ищу по [Новый Гео-фильтр]...' для улучшения прозрачности.",
      "expectedImpact": "Удовлетворение требования `GA002.T2.C4`, улучшение понимания пользователем действий ассистента, повышение полезности (Kimi judge: issue 'нарушение континuity').",
      "risk": "Low",
      "effort": "S",
      "validationScenarios": [
        "GA002"
      ]
    },
    {
      "id": "R3",
      "area": "ranking",
      "title": "Оптимизировать алгоритм ранжирования для стартового шортлиста",
      "action": "Пересмотреть алгоритм ранжирования, используемый для формирования первого 'first-pass' шортлиста компаний. Увеличить вес факторов, определяющих прямую релевантность к запросу пользователя и полноту контактных данных. Цель — минимизировать включение нерелевантных компаний, как отмечено судьей Kimi (issue 'turn 1: первый shortlist содержит нерелевантные компании').",
      "implementationHint": "Изучить логику функции, которая формирует initial shortlist (возможно, в `app/src/lib/company-search.ts` или аналогичном). Проверить используемые веса для критериев релевантности и гео-положения. Возможно, потребуется настройка параметров поиска Meilisearch, если он используется.",
      "expectedImpact": "Повышение averageUsefulness и usefulRate, улучшение качества первого взаимодействия с ассистентом, более точные начальные рекомендации.",
      "risk": "Medium (изменения в ранжировании могут потребовать тщательного тестирования на широком наборе сценариев).",
      "effort": "L",
      "validationScenarios": [
        "GA001",
        "GA002"
      ]
    },
    {
      "id": "R4",
      "area": "prompt",
      "title": "Повысить контекстную специфичность уточняющих вопросов и советов",
      "action": "Разработать механизмы для динамической адаптации уточняющих вопросов и общих советов (например, 'вопросы для звонка') к конкретному контексту запроса пользователя, включая отрасль и тип продукта. Это позволит избежать общих формулировок и предоставит более ценную информацию, как отмечено судьей Minimax (issue 'вопросы для звонка слишком общие', 'не адаптировала вопросы под молоко').",
      "implementationHint": "Внедрить условную логику в шаблоны промптов или расширить контекстные переменные, передаваемые в LLM. Это может включать извлечение ключевых слов из запроса пользователя и использование их для формирования более персонализированных вопросов/советов. Файлы в `app/src/app/api/assistant/` или `app/src/lib/prompt-templates/` могут быть точкой входа.",
      "expectedImpact": "Существенное повышение averageUsefulness, улучшение качества взаимодействия, ассистент будет восприниматься как более компетентный и полезный.",
      "risk": "Low",
      "effort": "M",
      "validationScenarios": [
        "minimax_judge_scenarios"
      ]
    },
    {
      "id": "R5",
      "area": "retrieval",
      "title": "Обеспечить минимальное количество релевантных кандидатов в шортлисте",
      "action": "Скорректировать логику извлечения или фильтрации данных так, чтобы при формировании шортлиста всегда (если это возможно) предлагалось минимум 3 релевантных кандидата. Если найдено меньше, ассистент должен явно это указать или применить стратегию расширенного поиска (например, немного расширить гео-фильтр, если это уместно).",
      "implementationHint": "Проверить параметры запроса к базе данных компаний или поисковому индексу (Meilisearch) на предмет ограничений по количеству результатов. Рассмотреть fallback-механизмы, если первичное количество кандидатов не достигает порогового значения. Может быть реализовано в `app/src/lib/company-search.ts`.",
      "expectedImpact": "Решение проблемы, отмеченной судьей Minimax ('не хватило 3-го кандидата'), улучшение полноты и ценности ответов ассистента.",
      "risk": "Medium (расширение поиска может привести к снижению релевантности, требует балансировки).",
      "effort": "M",
      "validationScenarios": [
        "GA001",
        "GA002"
      ]
    }
  ],
  "testPlan": {
    "mustPassScenarios": [
      "GA002"
    ],
    "regressionSuites": [
      "/home/mlweb/biznesinfo-develop.lucheestiy.com/app/qa/ai-request/scenarios.regressions.geo-ambiguity.json"
    ],
    "successMetrics": [
      "QA passRate > 0.8",
      "checkPassRate > 0.9",
      "Kimi judge averageUsefulness > 3.5",
      "Minimax judge averageUsefulness > 4.5"
    ]
  }
}
```