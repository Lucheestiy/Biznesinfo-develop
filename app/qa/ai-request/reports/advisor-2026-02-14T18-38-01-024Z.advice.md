# Advisor Report — advisor-2026-02-14T18-38-01-024Z

- Generated: 2026-02-14T18:40:31.259Z
- QA report: /home/mlweb/biznesinfo-develop.lucheestiy.com/app/qa/ai-request/reports/latest.json
- Judge report: /home/mlweb/biznesinfo-develop.lucheestiy.com/app/qa/ai-request/reports/latest.usefulness.json
- Focus scenarios: 1
- Advisors: kimi

## Advisor Warnings

- minimax: advisor minimax returned zero valid recommendations

## Focus Scenarios

- UV017 (fail, usefulness 0/5): Свекла 500 кг в Минске: защита от нерелевантных "не-поставщиков"

## Consensus

- Top areas:
  - prompt: 2
  - guardrails: 1
  - retrieval: 1
  - template: 1
  - qa: 1
- Recurring recommendations:
  - add container healthcheck and auto-restart policy (1)
  - inject conversation history into system prompt (1)
  - add explicit anti-fallback trigger for shortlist requests (1)
  - add rubric-based result filtering for education institutions (1)
  - create no-results fallback template with alternatives (1)
  - add pre-run healthcheck to qa runner (1)

## kimi

- Summary: Critical infrastructure failure: 502 Bad Gateway errors indicate the Next.js app container is crashing or unresponsive. The QA run failed not because of prompt quality, but because the assistant service was unavailable. Historical UV017 data shows usefulness=2 when service is stable - continuity issues exist but are secondary to uptime. Immediate fix required: container stability.

### Priority Plan

- P0 — Fix 502 Bad Gateway - Container Stability
  why: All QA scenarios fail with 502 errors. The app container restarted 2 minutes ago. Without stable service, no prompt improvements matter.
  impact: Restore basic service availability from 0% to functional baseline
  validate: UV017
- P1 — Fix Turn 2 Context Reset in UV017
  why: Historical UV017 data shows usefulness=2 because Turn 2 resets context - user asks for shortlist but assistant requests criteria again
  impact: Improve UV017 usefulness from 2 to 4, increase continuityScore from 2 to 4
  validate: UV017, UV005, UV012, UV013
- P2 — Add Graceful Degradation for No-Results
  why: UV011, UV012, UV013 show cyclic fallback patterns when data is scarce
  impact: Reduce generic fallback rate from 60% to <20% in no-results scenarios
  validate: UV011, UV012, UV013

### Recommendations

- [R1] (guardrails, effort S) Add container healthcheck and auto-restart policy
  action: Add docker-compose healthcheck with 30s interval and 3-retry failure threshold. Set restart policy to 'unless-stopped' with 5s delay.
  hint: docker-compose.yml: add healthcheck.test: ['CMD', 'curl', '-f', 'http://localhost:3000/api/health'] and restart policy
  impact: Eliminate 502 errors from container crashes, improve uptime from ~85% to >99%
  risk: Low - standard Docker practice
  validate: UV017
- [R2] (prompt, effort M) Inject conversation history into system prompt
  action: Modify the AI route handler to include previous turns summary in system prompt. Add explicit instruction: 'You are in a multi-turn conversation. Always reference previous context before responding.'
  hint: Find the API route handling /api/assistant or similar - likely in src/app/api/ - and modify the prompt construction to include history context
  impact: Fix continuityScore drops in Turn 2, reduce context reset errors by 80%
  risk: Medium - may increase token usage
  validate: UV017, UV005, UV014
- [R3] (prompt, effort S) Add explicit anti-fallback trigger for shortlist requests
  action: When user message contains 'shortlist', 'top-N', or 'список' + number, add system instruction: 'User explicitly requested a ranked list. Do NOT ask for criteria again. Use existing context or provide best-effort list with confidence markers.'
  hint: Add keyword detection in the API route before calling LLM, inject conditional system prompt
  impact: Eliminate UV017.T2 type failures where assistant asks for criteria after user provided them
  risk: Low - targeted fix
  validate: UV017, UV005, UV016
- [R4] (retrieval, effort S) Add rubric-based result filtering for education institutions
  action: When query contains product terms (буряк, свекла, овощи) + location, filter out rubrics containing 'образование', 'колледж', 'университет', 'школа' from search results
  hint: src/lib/meilisearch/search.ts - add negative filter for rubric names when product keywords detected
  impact: Fix UV017.T1.C3 check - prevent educational institutions in supplier results
  risk: Low - targeted noise reduction
  validate: UV017
- [R5] (template, effort M) Create no-results fallback template with alternatives
  action: When search returns <3 results, use template: 'Точных совпадений не найдено. Вот 3 рабочих альтернативы: 1) [broader search term] 2) [related category] 3) [suggested portal query]' instead of generic fallback
  hint: Modify the response generation logic to detect low-result scenarios and use structured template
  impact: Reduce UV012/UV013 cyclic fallback issues, improve user satisfaction in no-results cases
  risk: Low - improves UX
  validate: UV011, UV012, UV013
- [R6] (qa, effort S) Add pre-run healthcheck to QA runner
  action: Before executing scenarios, verify /api/health returns 200. If 502 detected, abort with clear error message instead of running against broken service.
  hint: Modify QA runner script to add healthcheck probe with 5s timeout before scenario execution
  impact: Prevent false-negative QA results, reduce debugging time for infrastructure issues
  risk: None
  validate: all

