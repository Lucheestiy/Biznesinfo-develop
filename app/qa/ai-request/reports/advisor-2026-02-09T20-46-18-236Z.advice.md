# Advisor Report — advisor-2026-02-09T20-46-18-236Z

- Generated: 2026-02-09T20:46:37.928Z
- QA report: /home/mlweb/biznesinfo-develop.lucheestiy.com/app/qa/ai-request/reports/latest.json
- Judge report: /home/mlweb/biznesinfo-develop.lucheestiy.com/app/qa/ai-request/reports/latest.usefulness.json
- Focus scenarios: 1
- Advisors: kimi

## Focus Scenarios

- UV001 (pass, usefulness 1/5): Производители обуви в Минске: уточнение типа + shortlist + шаблон контакта

## Consensus

- Top areas:
  - guardrails: 1
  - retrieval: 1
  - prompt: 1
  - template: 1
  - ranking: 1
- Recurring recommendations:
  - explicit 'no verified results' branch in shortlist generation (1)
  - expand footwear manufacturer query patterns (1)
  - clarification turn should surface concrete candidates or specific blockers (1)
  - template generation gate: validate candidate existence (1)
  - add 'manufacturer verification' boost in ranking (1)

## kimi

- Summary: Scenario UV001 passes strict checks (12/12) but receives usefulness score 1/5 from judge. Core issue: assistant fails to find actual shoe manufacturers in Minsk database and falls back to generic advice + irrelevant shortlist. This is a retrieval gap masked as a prompt/template problem. Fix requires: (1) explicit 'no results' handling in prompt to prevent hallucinated shortlists, (2) geo+industry query tuning for footwear manufacturers, (3) template generation validation to ensure only verified companies are included.

### Priority Plan

- P0 — Add guardrail: prohibit shortlist generation when no verified manufacturers found
  why: Current behavior hallucinates 3 irrelevant companies instead of admitting failure. This destroys user trust and wastes their time.
  impact: Eliminates false-positive shortlists; forces assistant to suggest alternative actions (broader geo, different category, contact methods)
  validate: UV001
- P1 — Tune retrieval query for footwear manufacturers in Minsk
  why: Database likely contains shoe producers but query construction fails to match them (possible NACE code mismatch, 'обувь' vs 'производство обуви' keyword gap)
  impact: Increases recall for actual manufacturers; reduces 'no results' cases
  validate: UV001
- P2 — Add usefulness self-check before template generation
  why: Template was generated despite no valid candidates, compounding the failure
  impact: Prevents sending contact templates for non-existent suppliers
  validate: UV001

### Recommendations

- [R1] (guardrails, effort S) Explicit 'no verified results' branch in shortlist generation
  action: Modify shortlist generation prompt: IF count(verified_manufacturers) < 1 THEN respond with explicit 'Не найдено производителей по вашему запросу' + suggest 2-3 alternatives (expand geography, similar categories, direct search methods). NEVER invent company names.
  hint: app/ai/prompts/shortlist.ts or similar - add conditional logic before company list rendering; add post-processing validator that checks each company NACE code against footwear manufacturing codes
  impact: Eliminates hallucinated shortlists; UV001 usefulness score improves to 3+
  risk: User may receive 'no results' more often until retrieval is fixed - acceptable tradeoff vs false info
  validate: UV001
- [R2] (retrieval, effort M) Expand footwear manufacturer query patterns
  action: Add synonyms and NACE codes: 'производство обуви' (NACE 15.20), 'обувная фабрика', 'швейно-обувное производство', 'кожаная обувь'. Include related keywords: 'ортопедическая обувь', 'рабочая обувь' as fallback. Test against Minsk geo filter.
  hint: src/search/queries/industryMappings.ts or retrieval config - add footwear expansion map; verify Meilisearch index has NACE codes indexed
  impact: Increases recall for UV001 from 0 to potentially 3-5 actual manufacturers
  risk: May introduce false positives if expansion too broad - test precision
  validate: UV001
- [R3] (prompt, effort S) Clarification turn should surface concrete candidates or specific blockers
  action: When user clarifies with 'мужская классическая обувь', prompt must require: (a) exact match count from DB, (b) if zero, explain WHY (no Minsk manufacturers in category vs filter too strict), (c) offer 2 concrete next steps with expected outcome
  hint: app/ai/prompts/conversation.ts - modify multi-turn context handling; add structured output requirement for 'result_status: found|not_found|partial' with reasoning
  impact: Turn 2-3 usefulness improves; user gets actionable guidance instead of generic tips
  risk: May increase response length - acceptable
  validate: UV001
- [R4] (template, effort S) Template generation gate: validate candidate existence
  action: Before generating Subject/Body/WhatsApp template, verify at least 1 candidate company exists in context with matching industry code. If none, respond: 'Для составления шаблона необходимо выбрать производителя из списка выше' and skip template generation.
  hint: app/ai/prompts/template.ts or template generation handler - add pre-condition check against context.companies array
  impact: Prevents useless template generation when no valid candidates exist
  risk: None - correct behavior
  validate: UV001
- [R5] (ranking, effort M) Add 'manufacturer verification' boost in ranking
  action: For 'производитель' queries, boost companies with: (a) NACE code matching manufacturing, (b) website with /production or /factory path, (c) 'производство' in description. Penalize trading companies.
  hint: src/search/ranking.ts - add industry-specific scoring function for manufacturing queries
  impact: Actual manufacturers appear in top-3 vs trading intermediaries
  risk: Requires labeled test set to validate - build from UV001 pattern
  validate: UV001

